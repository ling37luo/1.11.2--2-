ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"motor_control.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "App/Src/motor_control.c"
  20              		.section	.text.Motor_Process_Angle,"ax",%progbits
  21              		.align	1
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	Motor_Process_Angle:
  27              	.LVL0:
  28              	.LFB134:
   1:App/Src/motor_control.c **** #include "motor_control.h"
   2:App/Src/motor_control.c **** #include "can_bsp.h"
   3:App/Src/motor_control.c **** #include <math.h>
   4:App/Src/motor_control.c **** 
   5:App/Src/motor_control.c **** GM6020_TypeDef gm6020_motors[4];
   6:App/Src/motor_control.c **** //int16_t motor_current_send_buf[4]; // 添加发送缓冲区定义
   7:App/Src/motor_control.c **** 
   8:App/Src/motor_control.c **** #define PI 3.1415926535f
   9:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor);
  10:App/Src/motor_control.c **** static float Handle_Static_Motor(GM6020_TypeDef *motor);
  11:App/Src/motor_control.c **** /**
  12:App/Src/motor_control.c ****  * @brief 角度处理
  13:App/Src/motor_control.c ****  */
  14:App/Src/motor_control.c **** static void Motor_Process_Angle(GM6020_TypeDef *motor) {
  29              		.loc 1 14 56 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
  15:App/Src/motor_control.c ****     int diff = motor->ecd_raw - motor->last_ecd;
  34              		.loc 1 15 5 view .LVU1
  35              		.loc 1 15 21 is_stmt 0 view .LVU2
  36 0000 4288     		ldrh	r2, [r0, #2]
  37              		.loc 1 15 38 view .LVU3
  38 0002 8388     		ldrh	r3, [r0, #4]
  39              		.loc 1 15 9 view .LVU4
  40 0004 D31A     		subs	r3, r2, r3
  41              	.LVL1:
  16:App/Src/motor_control.c ****     if (diff > 4096) motor->round_cnt--;
  42              		.loc 1 16 5 is_stmt 1 view .LVU5
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 2


  43              		.loc 1 16 8 is_stmt 0 view .LVU6
  44 0006 B3F5805F 		cmp	r3, #4096
  45 000a 1ADD     		ble	.L2
  46              		.loc 1 16 22 is_stmt 1 discriminator 1 view .LVU7
  47              		.loc 1 16 27 is_stmt 0 discriminator 1 view .LVU8
  48 000c C368     		ldr	r3, [r0, #12]
  49              	.LVL2:
  50              		.loc 1 16 38 discriminator 1 view .LVU9
  51 000e 013B     		subs	r3, r3, #1
  52 0010 C360     		str	r3, [r0, #12]
  53              	.L3:
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  18:App/Src/motor_control.c ****     motor->total_angle = motor->round_cnt * 360.0f + (motor->ecd_raw / 8192.0f * 360.0f);
  54              		.loc 1 18 5 is_stmt 1 view .LVU10
  55              		.loc 1 18 43 is_stmt 0 view .LVU11
  56 0012 D0ED037A 		vldr.32	s15, [r0, #12]	@ int
  57 0016 F8EEE77A 		vcvt.f32.s32	s15, s15
  58 001a DFED0D6A 		vldr.32	s13, .L4
  59 001e 67EEA67A 		vmul.f32	s15, s15, s13
  60              		.loc 1 18 70 view .LVU12
  61 0022 07EE102A 		vmov	s14, r2	@ int
  62 0026 B8EEC77A 		vcvt.f32.s32	s14, s14
  63 002a 9FED0A6A 		vldr.32	s12, .L4+4
  64 002e 27EE067A 		vmul.f32	s14, s14, s12
  65              		.loc 1 18 80 view .LVU13
  66 0032 27EE267A 		vmul.f32	s14, s14, s13
  67              		.loc 1 18 52 view .LVU14
  68 0036 77EE877A 		vadd.f32	s15, s15, s14
  69              		.loc 1 18 24 view .LVU15
  70 003a C0ED047A 		vstr.32	s15, [r0, #16]
  19:App/Src/motor_control.c ****     motor->last_ecd = motor->ecd_raw;
  71              		.loc 1 19 5 is_stmt 1 view .LVU16
  72              		.loc 1 19 21 is_stmt 0 view .LVU17
  73 003e 8280     		strh	r2, [r0, #4]	@ movhi
  74              	.LVL3:
  20:App/Src/motor_control.c **** }
  75              		.loc 1 20 1 view .LVU18
  76 0040 7047     		bx	lr
  77              	.LVL4:
  78              	.L2:
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  79              		.loc 1 17 10 is_stmt 1 view .LVU19
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  80              		.loc 1 17 13 is_stmt 0 view .LVU20
  81 0042 13F5805F 		cmn	r3, #4096
  82 0046 E4DA     		bge	.L3
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  83              		.loc 1 17 28 is_stmt 1 discriminator 1 view .LVU21
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  84              		.loc 1 17 33 is_stmt 0 discriminator 1 view .LVU22
  85 0048 C368     		ldr	r3, [r0, #12]
  86              	.LVL5:
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  87              		.loc 1 17 44 discriminator 1 view .LVU23
  88 004a 0133     		adds	r3, r3, #1
  89 004c C360     		str	r3, [r0, #12]
  90 004e E0E7     		b	.L3
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 3


  91              	.L5:
  92              		.align	2
  93              	.L4:
  94 0050 0000B443 		.word	1135869952
  95 0054 00000039 		.word	956301312
  96              		.cfi_endproc
  97              	.LFE134:
  99              		.section	.text.limit_current,"ax",%progbits
 100              		.align	1
 101              		.syntax unified
 102              		.thumb
 103              		.thumb_func
 105              	limit_current:
 106              	.LVL6:
 107              	.LFB136:
  21:App/Src/motor_control.c **** 
  22:App/Src/motor_control.c **** /**
  23:App/Src/motor_control.c ****  * @brief 计算重力前馈
  24:App/Src/motor_control.c ****  */
  25:App/Src/motor_control.c **** static int16_t Motor_Calc_Gravity_FF(GM6020_TypeDef *motor) {
  26:App/Src/motor_control.c ****     if (motor->id == 4) {
  27:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
  28:App/Src/motor_control.c ****         return (int16_t)(PITCH_GRAVITY_GAIN * sinf(motor->total_angle * PI / 180.0f));
  29:App/Src/motor_control.c ****     }
  30:App/Src/motor_control.c ****      if (motor->id == 4) return 0;
  31:App/Src/motor_control.c ****     int32_t ecd_diff = motor->ecd_raw - motor->horizon_ecd;
  32:App/Src/motor_control.c ****     
  33:App/Src/motor_control.c ****     if (ecd_diff > 4096)  ecd_diff -= 8192;
  34:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
  35:App/Src/motor_control.c **** 
  36:App/Src/motor_control.c ****     float angle_rad = (float)ecd_diff * (2.0f * PI / 8192.0f);
  37:App/Src/motor_control.c ****     return (int16_t)(motor->gravity_gain * cosf(angle_rad));
  38:App/Src/motor_control.c **** }
  39:App/Src/motor_control.c **** 
  40:App/Src/motor_control.c **** // 辅助函数：限制电流范围
  41:App/Src/motor_control.c **** static int16_t limit_current(float val) {
 108              		.loc 1 41 41 is_stmt 1 view -0
 109              		.cfi_startproc
 110              		@ args = 0, pretend = 0, frame = 0
 111              		@ frame_needed = 0, uses_anonymous_args = 0
 112              		@ link register save eliminated.
  42:App/Src/motor_control.c ****     if (val > GM6020_MAX_CURRENT) return (int16_t)GM6020_MAX_CURRENT;
 113              		.loc 1 42 5 view .LVU25
 114              		.loc 1 42 8 is_stmt 0 view .LVU26
 115 0000 DFED0C7A 		vldr.32	s15, .L10
 116 0004 B4EEE70A 		vcmpe.f32	s0, s15
 117 0008 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 118 000c 0CDC     		bgt	.L8
  43:App/Src/motor_control.c ****     if (val < -GM6020_MAX_CURRENT) return (int16_t)-GM6020_MAX_CURRENT;
 119              		.loc 1 43 5 is_stmt 1 view .LVU27
 120              		.loc 1 43 8 is_stmt 0 view .LVU28
 121 000e DFED0A7A 		vldr.32	s15, .L10+4
 122 0012 B4EEE70A 		vcmpe.f32	s0, s15
 123 0016 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 124 001a 08D4     		bmi	.L9
  44:App/Src/motor_control.c ****     return (int16_t)val;
 125              		.loc 1 44 5 is_stmt 1 view .LVU29
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 4


 126              		.loc 1 44 12 is_stmt 0 view .LVU30
 127 001c BDEEC00A 		vcvt.s32.f32	s0, s0
 128              	.LVL7:
 129              		.loc 1 44 12 view .LVU31
 130 0020 10EE103A 		vmov	r3, s0	@ int
 131 0024 18B2     		sxth	r0, r3
 132 0026 7047     		bx	lr
 133              	.LVL8:
 134              	.L8:
  42:App/Src/motor_control.c ****     if (val > GM6020_MAX_CURRENT) return (int16_t)GM6020_MAX_CURRENT;
 135              		.loc 1 42 42 discriminator 1 view .LVU32
 136 0028 4FF48040 		mov	r0, #16384
 137 002c 7047     		bx	lr
 138              	.L9:
  43:App/Src/motor_control.c ****     if (val < -GM6020_MAX_CURRENT) return (int16_t)-GM6020_MAX_CURRENT;
 139              		.loc 1 43 43 discriminator 1 view .LVU33
 140 002e 0348     		ldr	r0, .L10+8
  45:App/Src/motor_control.c **** }
 141              		.loc 1 45 1 view .LVU34
 142 0030 7047     		bx	lr
 143              	.L11:
 144 0032 00BF     		.align	2
 145              	.L10:
 146 0034 00008046 		.word	1182793728
 147 0038 000080C6 		.word	-964689920
 148 003c 00C0FFFF 		.word	-16384
 149              		.cfi_endproc
 150              	.LFE136:
 152              		.section	.text.Motor_Check_Stall,"ax",%progbits
 153              		.align	1
 154              		.syntax unified
 155              		.thumb
 156              		.thumb_func
 158              	Motor_Check_Stall:
 159              	.LVL9:
 160              	.LFB137:
  46:App/Src/motor_control.c **** 
  47:App/Src/motor_control.c **** /**
  48:App/Src/motor_control.c ****  * @brief 堵转检测逻辑 (只保留一个定义)
  49:App/Src/motor_control.c ****  */
  50:App/Src/motor_control.c **** static void Motor_Check_Stall(GM6020_TypeDef *motor) {
 161              		.loc 1 50 54 is_stmt 1 view -0
 162              		.cfi_startproc
 163              		@ args = 0, pretend = 0, frame = 0
 164              		@ frame_needed = 0, uses_anonymous_args = 0
 165              		@ link register save eliminated.
  51:App/Src/motor_control.c ****     if (motor->mode == MOTOR_MODE_STOP || motor->is_stalled) return;
 166              		.loc 1 51 5 view .LVU36
 167              		.loc 1 51 14 is_stmt 0 view .LVU37
 168 0000 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
 169              		.loc 1 51 8 view .LVU38
 170 0002 032B     		cmp	r3, #3
 171 0004 32D0     		beq	.L12
 172              		.loc 1 51 48 discriminator 2 view .LVU39
 173 0006 90F8EC30 		ldrb	r3, [r0, #236]	@ zero_extendqisi2
 174              		.loc 1 51 40 discriminator 2 view .LVU40
 175 000a 7BBB     		cbnz	r3, .L12
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 5


  52:App/Src/motor_control.c **** 
  53:App/Src/motor_control.c ****     if (fabsf(motor->output_current) > STALL_CURRENT_THRESH && 
 176              		.loc 1 53 5 is_stmt 1 view .LVU41
 177              		.loc 1 53 20 is_stmt 0 view .LVU42
 178 000c B0F9E430 		ldrsh	r3, [r0, #228]
 179 0010 07EE903A 		vmov	s15, r3	@ int
 180              		.loc 1 53 9 view .LVU43
 181 0014 F8EEE77A 		vcvt.f32.s32	s15, s15
 182 0018 F0EEE77A 		vabs.f32	s15, s15
 183              		.loc 1 53 8 view .LVU44
 184 001c 9FED147A 		vldr.32	s14, .L19
 185 0020 F4EEC77A 		vcmpe.f32	s15, s14
 186 0024 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 187 0028 1DDD     		ble	.L14
  54:App/Src/motor_control.c ****         fabsf(motor->speed_rpm) < STALL_SPEED_THRESH) {
 188              		.loc 1 54 20 view .LVU45
 189 002a B0F90630 		ldrsh	r3, [r0, #6]
 190 002e 07EE903A 		vmov	s15, r3	@ int
 191              		.loc 1 54 9 view .LVU46
 192 0032 F8EEE77A 		vcvt.f32.s32	s15, s15
 193 0036 F0EEE77A 		vabs.f32	s15, s15
  53:App/Src/motor_control.c ****         fabsf(motor->speed_rpm) < STALL_SPEED_THRESH) {
 194              		.loc 1 53 61 discriminator 1 view .LVU47
 195 003a 9FED0E7A 		vldr.32	s14, .L19+4
 196 003e F4EEC77A 		vcmpe.f32	s15, s14
 197 0042 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 198 0046 0ED5     		bpl	.L14
  55:App/Src/motor_control.c ****         
  56:App/Src/motor_control.c ****         motor->stall_cnt++;
 199              		.loc 1 56 9 is_stmt 1 view .LVU48
 200              		.loc 1 56 14 is_stmt 0 view .LVU49
 201 0048 D0F8E830 		ldr	r3, [r0, #232]
 202              		.loc 1 56 25 view .LVU50
 203 004c 0133     		adds	r3, r3, #1
 204 004e C0F8E830 		str	r3, [r0, #232]
  57:App/Src/motor_control.c ****         if (motor->stall_cnt > STALL_TIME_MS) {
 205              		.loc 1 57 9 is_stmt 1 view .LVU51
 206              		.loc 1 57 12 is_stmt 0 view .LVU52
 207 0052 40F2DC52 		movw	r2, #1500
 208 0056 9342     		cmp	r3, r2
 209 0058 08D9     		bls	.L12
  58:App/Src/motor_control.c ****             motor->is_stalled = 1;
 210              		.loc 1 58 13 is_stmt 1 view .LVU53
 211              		.loc 1 58 31 is_stmt 0 view .LVU54
 212 005a 0123     		movs	r3, #1
 213 005c 80F8EC30 		strb	r3, [r0, #236]
  59:App/Src/motor_control.c ****             motor->mode = MOTOR_MODE_STOP;
 214              		.loc 1 59 13 is_stmt 1 view .LVU55
 215              		.loc 1 59 25 is_stmt 0 view .LVU56
 216 0060 0323     		movs	r3, #3
 217 0062 4370     		strb	r3, [r0, #1]
 218 0064 7047     		bx	lr
 219              	.L14:
  60:App/Src/motor_control.c ****         }
  61:App/Src/motor_control.c ****     } else {
  62:App/Src/motor_control.c ****         motor->stall_cnt = 0;
 220              		.loc 1 62 9 is_stmt 1 view .LVU57
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 6


 221              		.loc 1 62 26 is_stmt 0 view .LVU58
 222 0066 0023     		movs	r3, #0
 223 0068 C0F8E830 		str	r3, [r0, #232]
 224              	.L12:
  63:App/Src/motor_control.c ****     }
  64:App/Src/motor_control.c **** }
 225              		.loc 1 64 1 view .LVU59
 226 006c 7047     		bx	lr
 227              	.L20:
 228 006e 00BF     		.align	2
 229              	.L19:
 230 0070 00803B46 		.word	1178304512
 231 0074 0000C842 		.word	1120403456
 232              		.cfi_endproc
 233              	.LFE137:
 235              		.section	.text.Calculate_Static_Friction_Compensation,"ax",%progbits
 236              		.align	1
 237              		.syntax unified
 238              		.thumb
 239              		.thumb_func
 241              	Calculate_Static_Friction_Compensation:
 242              	.LVL10:
 243              	.LFB143:
  65:App/Src/motor_control.c **** 
  66:App/Src/motor_control.c **** // 清除堵转状态 (修复未使用变量警告)
  67:App/Src/motor_control.c **** void Motor_Clear_Stall(uint8_t id) {
  68:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
  69:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
  70:App/Src/motor_control.c ****     gm6020_motors[id-1].is_stalled = 0;
  71:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
  72:App/Src/motor_control.c ****     gm6020_motors[id-1].mode = MOTOR_MODE_CURRENT_SPEED;
  73:App/Src/motor_control.c ****     gm6020_motors[id-1].target_val = 0;
  74:App/Src/motor_control.c **** }
  75:App/Src/motor_control.c **** 
  76:App/Src/motor_control.c **** void Motor_Init_All(void) {
  77:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
  78:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
  79:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
  80:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
  81:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
  82:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
  83:App/Src/motor_control.c ****         gm6020_motors[i].last_ecd = 0;
  84:App/Src/motor_control.c ****         gm6020_motors[i].feedforward = 0;
  85:App/Src/motor_control.c ****         gm6020_motors[i].horizon_ecd = 4096;
  86:App/Src/motor_control.c ****         
  87:App/Src/motor_control.c ****         // 上电机特殊处理
  88:App/Src/motor_control.c ****         if (i == 3) { // ID=4
  89:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
  90:App/Src/motor_control.c ****         } else {
  91:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
  92:App/Src/motor_control.c ****         }
  93:App/Src/motor_control.c ****         
  94:App/Src/motor_control.c ****         float speed_dead_zone = 1.0f;
  95:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
  96:App/Src/motor_control.c ****         
  97:App/Src/motor_control.c ****         // 优化PID参数（上电机）
  98:App/Src/motor_control.c ****         if (i == 3) { // ID=4
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 7


  99:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 100:App/Src/motor_control.c ****                      140.0f,   // Kp
 101:App/Src/motor_control.c ****                      5.0f,     // Ki
 102:App/Src/motor_control.c ****                      0.2f,     // Kd
 103:App/Src/motor_control.c ****                      GM6020_MAX_CURRENT,
 104:App/Src/motor_control.c ****                      5000.0f,  // 积分限幅
 105:App/Src/motor_control.c ****                      speed_dead_zone);
 106:App/Src/motor_control.c ****             
 107:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].angle_pid, 
 108:App/Src/motor_control.c ****                      7.0f,     // Kp
 109:App/Src/motor_control.c ****                      0.003f,     
 110:App/Src/motor_control.c ****                      0.002f,
 111:App/Src/motor_control.c ****                      150.0f,   // MaxOut: 限制最大速度
 112:App/Src/motor_control.c ****                      10.0f,
 113:App/Src/motor_control.c ****                      angle_dead_zone);
 114:App/Src/motor_control.c ****         } 
 115:App/Src/motor_control.c ****         // 下电机参数
 116:App/Src/motor_control.c ****         else {
 117:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 118:App/Src/motor_control.c ****                      45.0f,    // Kp
 119:App/Src/motor_control.c ****                      2.0f,     // Ki
 120:App/Src/motor_control.c ****                      0.15f,   // Kd
 121:App/Src/motor_control.c ****                      GM6020_MAX_CURRENT, 
 122:App/Src/motor_control.c ****                      3000.0f,  // 积分限幅
 123:App/Src/motor_control.c ****                      5.0f);    // 无死区
 124:App/Src/motor_control.c ****             
 125:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].angle_pid, 
 126:App/Src/motor_control.c ****                      3.0f,     // Kp
 127:App/Src/motor_control.c ****                      0.005f,     // Ki
 128:App/Src/motor_control.c ****                      0.004f,     // Kd
 129:App/Src/motor_control.c ****                      GM6020_MAX_SPEED, 
 130:App/Src/motor_control.c ****                      20.0f,     // MaxIOut
 131:App/Src/motor_control.c ****                      5.0f);    // 无死区
 132:App/Src/motor_control.c ****         }
 133:App/Src/motor_control.c ****         
 134:App/Src/motor_control.c ****         // 清除PID状态
 135:App/Src/motor_control.c ****         PID_Clear(&gm6020_motors[i].speed_pid);
 136:App/Src/motor_control.c ****         PID_Clear(&gm6020_motors[i].angle_pid);
 137:App/Src/motor_control.c ****     }
 138:App/Src/motor_control.c **** }
 139:App/Src/motor_control.c **** 
 140:App/Src/motor_control.c **** void Motor_Update_Feedback(uint8_t id, uint8_t *rx_data) {
 141:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 142:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 143:App/Src/motor_control.c ****     
 144:App/Src/motor_control.c ****     motor->ecd_raw = (rx_data[0] << 8) | rx_data[1];
 145:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 146:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 147:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 148:App/Src/motor_control.c ****     
 149:App/Src/motor_control.c ****     Motor_Process_Angle(motor);
 150:App/Src/motor_control.c **** }
 151:App/Src/motor_control.c **** 
 152:App/Src/motor_control.c **** void Motor_Set_Target(uint8_t id, Motor_Mode_e mode, float target) {
 153:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 154:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 155:App/Src/motor_control.c ****     
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 8


 156:App/Src/motor_control.c ****     // 启用堵转保护
 157:App/Src/motor_control.c ****     if (motor->is_stalled) {
 158:App/Src/motor_control.c ****         return;
 159:App/Src/motor_control.c ****     }
 160:App/Src/motor_control.c ****     
 161:App/Src/motor_control.c ****     Motor_Mode_e old_mode = motor->mode;
 162:App/Src/motor_control.c ****     motor->mode = mode;
 163:App/Src/motor_control.c ****     motor->target_val = target;
 164:App/Src/motor_control.c ****     
 165:App/Src/motor_control.c ****     // 切换模式时清除 PID 积分
 166:App/Src/motor_control.c ****     if (old_mode != mode) {
 167:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 168:App/Src/motor_control.c ****         PID_Clear(&motor->angle_pid);
 169:App/Src/motor_control.c ****     }
 170:App/Src/motor_control.c **** }
 171:App/Src/motor_control.c **** 
 172:App/Src/motor_control.c **** void Motor_Control_Loop(void) {
 173:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 174:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 175:App/Src/motor_control.c ****         float speed_target = 0;
 176:App/Src/motor_control.c ****         float current_target = 0;
 177:App/Src/motor_control.c ****         
 178:App/Src/motor_control.c ****         // 堵转保护
 179:App/Src/motor_control.c ****         if (motor->is_stalled || motor->mode == MOTOR_MODE_STOP) {
 180:App/Src/motor_control.c ****             motor->output_current = 0;
 181:App/Src/motor_control.c ****             motor_current_send_buf[i] = 0;
 182:App/Src/motor_control.c ****             continue;
 183:App/Src/motor_control.c ****         }
 184:App/Src/motor_control.c **** 
 185:App/Src/motor_control.c ****          if (fabsf(motor->target_val) < 1.0f && 
 186:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 187:App/Src/motor_control.c ****             Handle_Static_Motor(motor);
 188:App/Src/motor_control.c ****         } else {
 189:App/Src/motor_control.c ****             switch (motor->mode) {
 190:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_OPEN:
 191:App/Src/motor_control.c ****                     current_target = motor->target_val;
 192:App/Src/motor_control.c ****                     break;   
 193:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_SPEED:
 194:App/Src/motor_control.c ****                     current_target = PID_Calc(&motor->speed_pid, motor->target_val, motor->speed_rp
 195:App/Src/motor_control.c ****                     break;
 196:App/Src/motor_control.c ****                     
 197:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_POS_CASCADE:{
 198:App/Src/motor_control.c ****                     // ✅ 位置环死区处理
 199:App/Src/motor_control.c ****                     float angle_error = motor->target_val - motor->total_angle;
 200:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 201:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 202:App/Src/motor_control.c ****                         float speed_target = 0.0f;
 203:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 204:App/Src/motor_control.c ****                     } else {
 205:App/Src/motor_control.c ****                         float speed_target = PID_Calc(&motor->angle_pid, motor->target_val, motor->
 206:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 207:App/Src/motor_control.c ****                     }
 208:App/Src/motor_control.c ****                 }
 209:App/Src/motor_control.c ****                     break;
 210:App/Src/motor_control.c ****                     
 211:App/Src/motor_control.c ****                 default:
 212:App/Src/motor_control.c ****                     current_target = 0;
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 9


 213:App/Src/motor_control.c ****                     break;
 214:App/Src/motor_control.c ****             }
 215:App/Src/motor_control.c ****         }
 216:App/Src/motor_control.c **** 
 217:App/Src/motor_control.c ****         if (motor->id != 4 && (motor->mode == MOTOR_MODE_CURRENT_SPEED || 
 218:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 219:App/Src/motor_control.c ****             
 220:App/Src/motor_control.c ****             motor->feedforward = Motor_Calc_Gravity_FF(motor);
 221:App/Src/motor_control.c ****             current_target += motor->feedforward;
 222:App/Src/motor_control.c ****         }
 223:App/Src/motor_control.c ****         if (i == 3) { // 上电机
 224:App/Src/motor_control.c ****             current_target += Calculate_Static_Friction_Compensation(motor);
 225:App/Src/motor_control.c ****         }
 226:App/Src/motor_control.c **** 
 227:App/Src/motor_control.c ****         // 限制电流范围
 228:App/Src/motor_control.c ****         motor->output_current = limit_current(current_target);
 229:App/Src/motor_control.c ****         
 230:App/Src/motor_control.c ****         // 执行堵转检测
 231:App/Src/motor_control.c ****         Motor_Check_Stall(motor);
 232:App/Src/motor_control.c ****         
 233:App/Src/motor_control.c ****         // 填入发送缓冲区
 234:App/Src/motor_control.c ****         motor_current_send_buf[i] = motor->output_current;
 235:App/Src/motor_control.c ****     }
 236:App/Src/motor_control.c ****     
 237:App/Src/motor_control.c ****     // ✅ 修复函数名拼写错误
 238:App/Src/motor_control.c ****     BSP_CAN_Send_Current_Cmd(); // 注意是 'Sned' 不是 'Send'
 239:App/Src/motor_control.c **** }
 240:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor) {
 244              		.loc 1 240 76 is_stmt 1 view -0
 245              		.cfi_startproc
 246              		@ args = 0, pretend = 0, frame = 0
 247              		@ frame_needed = 0, uses_anonymous_args = 0
 248              		@ link register save eliminated.
 241:App/Src/motor_control.c ****     // 静摩擦补偿：当速度接近0时，添加小的补偿电流
 242:App/Src/motor_control.c ****     if (fabsf(motor->speed_rpm) < 0.5f) {
 249              		.loc 1 242 5 view .LVU61
 250              		.loc 1 242 20 is_stmt 0 view .LVU62
 251 0000 B0F90630 		ldrsh	r3, [r0, #6]
 252 0004 07EE903A 		vmov	s15, r3	@ int
 253              		.loc 1 242 9 view .LVU63
 254 0008 F8EEE77A 		vcvt.f32.s32	s15, s15
 255 000c F0EEE77A 		vabs.f32	s15, s15
 256              		.loc 1 242 8 view .LVU64
 257 0010 B6EE007A 		vmov.f32	s14, #5.0e-1
 258 0014 F4EEC77A 		vcmpe.f32	s15, s14
 259 0018 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 260 001c 02D4     		bmi	.L32
 243:App/Src/motor_control.c ****         // 根据角度位置计算补偿（上电机需要）
 244:App/Src/motor_control.c ****         float static_friction = 150.0f; // 150mA静摩擦补偿
 245:App/Src/motor_control.c ****         return (motor->total_angle > 0) ? static_friction : -static_friction;
 246:App/Src/motor_control.c ****     }
 247:App/Src/motor_control.c ****     return 0.0f;
 261              		.loc 1 247 12 view .LVU65
 262 001e 9FED080A 		vldr.32	s0, .L33
 248:App/Src/motor_control.c **** }
 263              		.loc 1 248 1 view .LVU66
 264 0022 7047     		bx	lr
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 10


 265              	.L32:
 266              	.LBB2:
 244:App/Src/motor_control.c ****         return (motor->total_angle > 0) ? static_friction : -static_friction;
 267              		.loc 1 244 9 is_stmt 1 view .LVU67
 268              	.LVL11:
 245:App/Src/motor_control.c ****     }
 269              		.loc 1 245 9 view .LVU68
 245:App/Src/motor_control.c ****     }
 270              		.loc 1 245 22 is_stmt 0 view .LVU69
 271 0024 D0ED047A 		vldr.32	s15, [r0, #16]
 245:App/Src/motor_control.c ****     }
 272              		.loc 1 245 59 view .LVU70
 273 0028 F5EEC07A 		vcmpe.f32	s15, #0
 274 002c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 275 0030 02DD     		ble	.L31
 245:App/Src/motor_control.c ****     }
 276              		.loc 1 245 59 discriminator 1 view .LVU71
 277 0032 9FED040A 		vldr.32	s0, .L33+4
 278 0036 7047     		bx	lr
 279              	.L31:
 245:App/Src/motor_control.c ****     }
 280              		.loc 1 245 59 discriminator 2 view .LVU72
 281 0038 9FED030A 		vldr.32	s0, .L33+8
 245:App/Src/motor_control.c ****     }
 282              		.loc 1 245 59 view .LVU73
 283 003c 7047     		bx	lr
 284              	.L34:
 285 003e 00BF     		.align	2
 286              	.L33:
 287 0040 00000000 		.word	0
 288 0044 00001643 		.word	1125515264
 289 0048 000016C3 		.word	-1021968384
 290              	.LBE2:
 291              		.cfi_endproc
 292              	.LFE143:
 294              		.section	.text.Motor_Calc_Gravity_FF,"ax",%progbits
 295              		.align	1
 296              		.syntax unified
 297              		.thumb
 298              		.thumb_func
 300              	Motor_Calc_Gravity_FF:
 301              	.LVL12:
 302              	.LFB135:
  25:App/Src/motor_control.c ****     if (motor->id == 4) {
 303              		.loc 1 25 61 is_stmt 1 view -0
 304              		.cfi_startproc
 305              		@ args = 0, pretend = 0, frame = 0
 306              		@ frame_needed = 0, uses_anonymous_args = 0
  25:App/Src/motor_control.c ****     if (motor->id == 4) {
 307              		.loc 1 25 61 is_stmt 0 view .LVU75
 308 0000 08B5     		push	{r3, lr}
 309              	.LCFI0:
 310              		.cfi_def_cfa_offset 8
 311              		.cfi_offset 3, -8
 312              		.cfi_offset 14, -4
 313 0002 2DED028B 		vpush.64	{d8}
 314              	.LCFI1:
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 11


 315              		.cfi_def_cfa_offset 16
 316              		.cfi_offset 80, -16
 317              		.cfi_offset 81, -12
  26:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
 318              		.loc 1 26 5 is_stmt 1 view .LVU76
  26:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
 319              		.loc 1 26 14 is_stmt 0 view .LVU77
 320 0006 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
  26:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
 321              		.loc 1 26 8 view .LVU78
 322 0008 042B     		cmp	r3, #4
 323 000a 1ED0     		beq	.L41
  30:App/Src/motor_control.c ****     int32_t ecd_diff = motor->ecd_raw - motor->horizon_ecd;
 324              		.loc 1 30 6 is_stmt 1 view .LVU79
  31:App/Src/motor_control.c ****     
 325              		.loc 1 31 5 view .LVU80
  31:App/Src/motor_control.c ****     
 326              		.loc 1 31 29 is_stmt 0 view .LVU81
 327 000c 4388     		ldrh	r3, [r0, #2]
  31:App/Src/motor_control.c ****     
 328              		.loc 1 31 46 view .LVU82
 329 000e B0F8EE20 		ldrh	r2, [r0, #238]
  31:App/Src/motor_control.c ****     
 330              		.loc 1 31 13 view .LVU83
 331 0012 9B1A     		subs	r3, r3, r2
 332              	.LVL13:
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 333              		.loc 1 33 5 is_stmt 1 view .LVU84
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 334              		.loc 1 33 8 is_stmt 0 view .LVU85
 335 0014 B3F5805F 		cmp	r3, #4096
 336 0018 2DDD     		ble	.L38
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 337              		.loc 1 33 27 is_stmt 1 discriminator 1 view .LVU86
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 338              		.loc 1 33 36 is_stmt 0 discriminator 1 view .LVU87
 339 001a A3F50053 		sub	r3, r3, #8192
 340              	.LVL14:
  34:App/Src/motor_control.c **** 
 341              		.loc 1 34 5 is_stmt 1 view .LVU88
 342              	.L39:
  36:App/Src/motor_control.c ****     return (int16_t)(motor->gravity_gain * cosf(angle_rad));
 343              		.loc 1 36 5 view .LVU89
  36:App/Src/motor_control.c ****     return (int16_t)(motor->gravity_gain * cosf(angle_rad));
 344              		.loc 1 36 23 is_stmt 0 view .LVU90
 345 001e 07EE903A 		vmov	s15, r3	@ int
 346 0022 F8EEE77A 		vcvt.f32.s32	s15, s15
 347              	.LVL15:
  37:App/Src/motor_control.c **** }
 348              		.loc 1 37 5 is_stmt 1 view .LVU91
  37:App/Src/motor_control.c **** }
 349              		.loc 1 37 27 is_stmt 0 view .LVU92
 350 0026 90ED3C8A 		vldr.32	s16, [r0, #240]
  37:App/Src/motor_control.c **** }
 351              		.loc 1 37 44 view .LVU93
 352 002a 9FED160A 		vldr.32	s0, .L42
 353 002e 27EE800A 		vmul.f32	s0, s15, s0
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 12


 354              	.LVL16:
  37:App/Src/motor_control.c **** }
 355              		.loc 1 37 44 view .LVU94
 356 0032 FFF7FEFF 		bl	cosf
 357              	.LVL17:
  37:App/Src/motor_control.c **** }
 358              		.loc 1 37 42 discriminator 1 view .LVU95
 359 0036 28EE008A 		vmul.f32	s16, s16, s0
  37:App/Src/motor_control.c **** }
 360              		.loc 1 37 12 discriminator 1 view .LVU96
 361 003a BDEEC88A 		vcvt.s32.f32	s16, s16
 362 003e 18EE103A 		vmov	r3, s16	@ int
 363 0042 18B2     		sxth	r0, r3
 364              	.LVL18:
 365              	.L37:
  38:App/Src/motor_control.c **** 
 366              		.loc 1 38 1 view .LVU97
 367 0044 BDEC028B 		vldm	sp!, {d8}
 368              	.LCFI2:
 369              		.cfi_remember_state
 370              		.cfi_restore 80
 371              		.cfi_restore 81
 372              		.cfi_def_cfa_offset 8
 373 0048 08BD     		pop	{r3, pc}
 374              	.LVL19:
 375              	.L41:
 376              	.LCFI3:
 377              		.cfi_restore_state
 378              	.LBB3:
  27:App/Src/motor_control.c ****         return (int16_t)(PITCH_GRAVITY_GAIN * sinf(motor->total_angle * PI / 180.0f));
 379              		.loc 1 27 9 is_stmt 1 view .LVU98
  28:App/Src/motor_control.c ****     }
 380              		.loc 1 28 9 view .LVU99
  28:App/Src/motor_control.c ****     }
 381              		.loc 1 28 57 is_stmt 0 view .LVU100
 382 004a D0ED047A 		vldr.32	s15, [r0, #16]
  28:App/Src/motor_control.c ****     }
 383              		.loc 1 28 71 view .LVU101
 384 004e 9FED0E7A 		vldr.32	s14, .L42+4
 385 0052 67EE877A 		vmul.f32	s15, s15, s14
  28:App/Src/motor_control.c ****     }
 386              		.loc 1 28 47 view .LVU102
 387 0056 9FED0D0A 		vldr.32	s0, .L42+8
 388 005a 87EE800A 		vdiv.f32	s0, s15, s0
 389 005e FFF7FEFF 		bl	sinf
 390              	.LVL20:
  28:App/Src/motor_control.c ****     }
 391              		.loc 1 28 45 discriminator 1 view .LVU103
 392 0062 DFED0B7A 		vldr.32	s15, .L42+12
 393 0066 20EE270A 		vmul.f32	s0, s0, s15
  28:App/Src/motor_control.c ****     }
 394              		.loc 1 28 16 discriminator 1 view .LVU104
 395 006a BDEEC00A 		vcvt.s32.f32	s0, s0
 396 006e 10EE103A 		vmov	r3, s0	@ int
 397 0072 18B2     		sxth	r0, r3
  28:App/Src/motor_control.c ****     }
 398              		.loc 1 28 16 view .LVU105
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 13


 399 0074 E6E7     		b	.L37
 400              	.LVL21:
 401              	.L38:
  28:App/Src/motor_control.c ****     }
 402              		.loc 1 28 16 view .LVU106
 403              	.LBE3:
  34:App/Src/motor_control.c **** 
 404              		.loc 1 34 5 is_stmt 1 view .LVU107
  34:App/Src/motor_control.c **** 
 405              		.loc 1 34 8 is_stmt 0 view .LVU108
 406 0076 13F5805F 		cmn	r3, #4096
 407 007a D0DA     		bge	.L39
  34:App/Src/motor_control.c **** 
 408              		.loc 1 34 27 is_stmt 1 discriminator 1 view .LVU109
  34:App/Src/motor_control.c **** 
 409              		.loc 1 34 36 is_stmt 0 discriminator 1 view .LVU110
 410 007c 03F50053 		add	r3, r3, #8192
 411              	.LVL22:
  34:App/Src/motor_control.c **** 
 412              		.loc 1 34 36 discriminator 1 view .LVU111
 413 0080 CDE7     		b	.L39
 414              	.L43:
 415 0082 00BF     		.align	2
 416              	.L42:
 417 0084 DB0F493A 		.word	977866715
 418 0088 DB0F4940 		.word	1078530011
 419 008c 00003443 		.word	1127481344
 420 0090 00004844 		.word	1145569280
 421              		.cfi_endproc
 422              	.LFE135:
 424              		.section	.text.Motor_Clear_Stall,"ax",%progbits
 425              		.align	1
 426              		.global	Motor_Clear_Stall
 427              		.syntax unified
 428              		.thumb
 429              		.thumb_func
 431              	Motor_Clear_Stall:
 432              	.LVL23:
 433              	.LFB138:
  67:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 434              		.loc 1 67 36 is_stmt 1 view -0
 435              		.cfi_startproc
 436              		@ args = 0, pretend = 0, frame = 0
 437              		@ frame_needed = 0, uses_anonymous_args = 0
 438              		@ link register save eliminated.
  68:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
 439              		.loc 1 68 5 view .LVU113
  68:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
 440              		.loc 1 68 16 is_stmt 0 view .LVU114
 441 0000 431E     		subs	r3, r0, #1
 442 0002 DBB2     		uxtb	r3, r3
  68:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
 443              		.loc 1 68 8 view .LVU115
 444 0004 032B     		cmp	r3, #3
 445 0006 0FD8     		bhi	.L44
  70:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
 446              		.loc 1 70 5 is_stmt 1 view .LVU116
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 14


  70:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
 447              		.loc 1 70 21 is_stmt 0 view .LVU117
 448 0008 0138     		subs	r0, r0, #1
 449              	.LVL24:
  70:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
 450              		.loc 1 70 36 view .LVU118
 451 000a 084A     		ldr	r2, .L46
 452 000c C0EB4013 		rsb	r3, r0, r0, lsl #5
 453 0010 02EBC303 		add	r3, r2, r3, lsl #3
 454 0014 0021     		movs	r1, #0
 455 0016 83F8EC10 		strb	r1, [r3, #236]
  71:App/Src/motor_control.c ****     gm6020_motors[id-1].mode = MOTOR_MODE_CURRENT_SPEED;
 456              		.loc 1 71 5 is_stmt 1 view .LVU119
  71:App/Src/motor_control.c ****     gm6020_motors[id-1].mode = MOTOR_MODE_CURRENT_SPEED;
 457              		.loc 1 71 35 is_stmt 0 view .LVU120
 458 001a C3F8E810 		str	r1, [r3, #232]
  72:App/Src/motor_control.c ****     gm6020_motors[id-1].target_val = 0;
 459              		.loc 1 72 5 is_stmt 1 view .LVU121
  72:App/Src/motor_control.c ****     gm6020_motors[id-1].target_val = 0;
 460              		.loc 1 72 30 is_stmt 0 view .LVU122
 461 001e 0121     		movs	r1, #1
 462 0020 5970     		strb	r1, [r3, #1]
  73:App/Src/motor_control.c **** }
 463              		.loc 1 73 5 is_stmt 1 view .LVU123
  73:App/Src/motor_control.c **** }
 464              		.loc 1 73 36 is_stmt 0 view .LVU124
 465 0022 1A46     		mov	r2, r3
 466 0024 0023     		movs	r3, #0
 467 0026 5361     		str	r3, [r2, #20]	@ float
 468              	.LVL25:
 469              	.L44:
  74:App/Src/motor_control.c **** 
 470              		.loc 1 74 1 view .LVU125
 471 0028 7047     		bx	lr
 472              	.L47:
 473 002a 00BF     		.align	2
 474              	.L46:
 475 002c 00000000 		.word	gm6020_motors
 476              		.cfi_endproc
 477              	.LFE138:
 479              		.section	.text.Motor_Init_All,"ax",%progbits
 480              		.align	1
 481              		.global	Motor_Init_All
 482              		.syntax unified
 483              		.thumb
 484              		.thumb_func
 486              	Motor_Init_All:
 487              	.LFB139:
  76:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 488              		.loc 1 76 27 is_stmt 1 view -0
 489              		.cfi_startproc
 490              		@ args = 0, pretend = 0, frame = 0
 491              		@ frame_needed = 0, uses_anonymous_args = 0
 492 0000 70B5     		push	{r4, r5, r6, lr}
 493              	.LCFI4:
 494              		.cfi_def_cfa_offset 16
 495              		.cfi_offset 4, -16
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 15


 496              		.cfi_offset 5, -12
 497              		.cfi_offset 6, -8
 498              		.cfi_offset 14, -4
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 499              		.loc 1 77 5 view .LVU127
 500              	.LBB4:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 501              		.loc 1 77 10 view .LVU128
 502              	.LVL26:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 503              		.loc 1 77 14 is_stmt 0 view .LVU129
 504 0002 0024     		movs	r4, #0
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 505              		.loc 1 77 5 view .LVU130
 506 0004 3FE0     		b	.L49
 507              	.LVL27:
 508              	.L55:
 509              	.LBB5:
  89:App/Src/motor_control.c ****         } else {
 510              		.loc 1 89 13 is_stmt 1 view .LVU131
  89:App/Src/motor_control.c ****         } else {
 511              		.loc 1 89 43 is_stmt 0 view .LVU132
 512 0006 0646     		mov	r6, r0
 513 0008 6501     		lsls	r5, r4, #5
 514 000a C4EB4412 		rsb	r2, r4, r4, lsl #5
 515 000e D300     		lsls	r3, r2, #3
 516 0010 0344     		add	r3, r3, r0
 517 0012 0022     		movs	r2, #0
 518 0014 C3F8F020 		str	r2, [r3, #240]	@ float
  94:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
 519              		.loc 1 94 9 is_stmt 1 view .LVU133
 520              	.LVL28:
  95:App/Src/motor_control.c ****         
 521              		.loc 1 95 9 view .LVU134
  98:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 522              		.loc 1 98 9 view .LVU135
  99:App/Src/motor_control.c ****                      140.0f,   // Kp
 523              		.loc 1 99 13 view .LVU136
 524 0018 C4EB4413 		rsb	r3, r4, r4, lsl #5
 525 001c D800     		lsls	r0, r3, #3
 526 001e 1830     		adds	r0, r0, #24
 527 0020 F7EE002A 		vmov.f32	s5, #1.0e+0
 528 0024 9FED3D2A 		vldr.32	s4, .L56
 529 0028 DFED3D1A 		vldr.32	s3, .L56+4
 530 002c 9FED3D1A 		vldr.32	s2, .L56+8
 531 0030 F1EE040A 		vmov.f32	s1, #5.0e+0
 532 0034 9FED3C0A 		vldr.32	s0, .L56+12
 533 0038 3044     		add	r0, r0, r6
 534 003a FFF7FEFF 		bl	PID_Init
 535              	.LVL29:
 107:App/Src/motor_control.c ****                      7.0f,     // Kp
 536              		.loc 1 107 13 view .LVU137
 537 003e 2B1B     		subs	r3, r5, r4
 538 0040 D800     		lsls	r0, r3, #3
 539 0042 5830     		adds	r0, r0, #88
 540 0044 3044     		add	r0, r0, r6
 541 0046 F6EE002A 		vmov.f32	s5, #5.0e-1
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 16


 542 004a B2EE042A 		vmov.f32	s4, #1.0e+1
 543 004e DFED371A 		vldr.32	s3, .L56+16
 544 0052 9FED371A 		vldr.32	s2, .L56+20
 545 0056 DFED370A 		vldr.32	s1, .L56+24
 546 005a B1EE0C0A 		vmov.f32	s0, #7.0e+0
 547 005e 0430     		adds	r0, r0, #4
 548 0060 FFF7FEFF 		bl	PID_Init
 549              	.LVL30:
 550              	.L51:
 135:App/Src/motor_control.c ****         PID_Clear(&gm6020_motors[i].angle_pid);
 551              		.loc 1 135 9 view .LVU138
 552 0064 6501     		lsls	r5, r4, #5
 553 0066 C4EB4413 		rsb	r3, r4, r4, lsl #5
 554 006a D800     		lsls	r0, r3, #3
 555 006c 1830     		adds	r0, r0, #24
 556 006e 324E     		ldr	r6, .L56+28
 557 0070 3044     		add	r0, r0, r6
 558 0072 FFF7FEFF 		bl	PID_Clear
 559              	.LVL31:
 136:App/Src/motor_control.c ****     }
 560              		.loc 1 136 9 view .LVU139
 561 0076 2B1B     		subs	r3, r5, r4
 562 0078 D800     		lsls	r0, r3, #3
 563 007a 5830     		adds	r0, r0, #88
 564 007c 3044     		add	r0, r0, r6
 565 007e 0430     		adds	r0, r0, #4
 566 0080 FFF7FEFF 		bl	PID_Clear
 567              	.LVL32:
 568              	.LBE5:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 569              		.loc 1 77 29 discriminator 2 view .LVU140
 570 0084 0134     		adds	r4, r4, #1
 571              	.LVL33:
 572              	.L49:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 573              		.loc 1 77 23 discriminator 1 view .LVU141
 574 0086 032C     		cmp	r4, #3
 575 0088 47DC     		bgt	.L54
 576              	.LBB6:
  78:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 577              		.loc 1 78 9 view .LVU142
  78:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 578              		.loc 1 78 33 is_stmt 0 view .LVU143
 579 008a 611C     		adds	r1, r4, #1
  78:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 580              		.loc 1 78 29 view .LVU144
 581 008c 2A48     		ldr	r0, .L56+28
 582 008e C4EB4413 		rsb	r3, r4, r4, lsl #5
 583 0092 DA00     		lsls	r2, r3, #3
 584 0094 8318     		adds	r3, r0, r2
 585 0096 8154     		strb	r1, [r0, r2]
  79:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
 586              		.loc 1 79 9 is_stmt 1 view .LVU145
  79:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
 587              		.loc 1 79 31 is_stmt 0 view .LVU146
 588 0098 0122     		movs	r2, #1
 589 009a 5A70     		strb	r2, [r3, #1]
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 17


  80:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
 590              		.loc 1 80 9 is_stmt 1 view .LVU147
  80:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
 591              		.loc 1 80 37 is_stmt 0 view .LVU148
 592 009c 0022     		movs	r2, #0
 593 009e 5A61     		str	r2, [r3, #20]	@ float
  81:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
 594              		.loc 1 81 9 is_stmt 1 view .LVU149
  81:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
 595              		.loc 1 81 36 is_stmt 0 view .LVU150
 596 00a0 0022     		movs	r2, #0
 597 00a2 DA60     		str	r2, [r3, #12]
  82:App/Src/motor_control.c ****         gm6020_motors[i].last_ecd = 0;
 598              		.loc 1 82 9 is_stmt 1 view .LVU151
  82:App/Src/motor_control.c ****         gm6020_motors[i].last_ecd = 0;
 599              		.loc 1 82 37 is_stmt 0 view .LVU152
 600 00a4 83F8EC20 		strb	r2, [r3, #236]
  83:App/Src/motor_control.c ****         gm6020_motors[i].feedforward = 0;
 601              		.loc 1 83 9 is_stmt 1 view .LVU153
  83:App/Src/motor_control.c ****         gm6020_motors[i].feedforward = 0;
 602              		.loc 1 83 35 is_stmt 0 view .LVU154
 603 00a8 9A80     		strh	r2, [r3, #4]	@ movhi
  84:App/Src/motor_control.c ****         gm6020_motors[i].horizon_ecd = 4096;
 604              		.loc 1 84 9 is_stmt 1 view .LVU155
  84:App/Src/motor_control.c ****         gm6020_motors[i].horizon_ecd = 4096;
 605              		.loc 1 84 38 is_stmt 0 view .LVU156
 606 00aa A3F8F420 		strh	r2, [r3, #244]	@ movhi
  85:App/Src/motor_control.c ****         
 607              		.loc 1 85 9 is_stmt 1 view .LVU157
  85:App/Src/motor_control.c ****         
 608              		.loc 1 85 38 is_stmt 0 view .LVU158
 609 00ae 4FF48052 		mov	r2, #4096
 610 00b2 A3F8EE20 		strh	r2, [r3, #238]	@ movhi
  88:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
 611              		.loc 1 88 9 is_stmt 1 view .LVU159
  88:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
 612              		.loc 1 88 12 is_stmt 0 view .LVU160
 613 00b6 032C     		cmp	r4, #3
 614 00b8 A5D0     		beq	.L55
  91:App/Src/motor_control.c ****         }
 615              		.loc 1 91 13 is_stmt 1 view .LVU161
  91:App/Src/motor_control.c ****         }
 616              		.loc 1 91 43 is_stmt 0 view .LVU162
 617 00ba 1F4E     		ldr	r6, .L56+28
 618 00bc 6501     		lsls	r5, r4, #5
 619 00be C4EB4412 		rsb	r2, r4, r4, lsl #5
 620 00c2 D300     		lsls	r3, r2, #3
 621 00c4 3344     		add	r3, r3, r6
 622 00c6 0022     		movs	r2, #0
 623 00c8 C3F8F020 		str	r2, [r3, #240]	@ float
  94:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
 624              		.loc 1 94 9 is_stmt 1 view .LVU163
 625              	.LVL34:
  95:App/Src/motor_control.c ****         
 626              		.loc 1 95 9 view .LVU164
  98:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 627              		.loc 1 98 9 view .LVU165
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 18


 117:App/Src/motor_control.c ****                      45.0f,    // Kp
 628              		.loc 1 117 13 view .LVU166
 629 00cc C4EB4413 		rsb	r3, r4, r4, lsl #5
 630 00d0 D800     		lsls	r0, r3, #3
 631 00d2 1830     		adds	r0, r0, #24
 632 00d4 F1EE042A 		vmov.f32	s5, #5.0e+0
 633 00d8 9FED182A 		vldr.32	s4, .L56+32
 634 00dc DFED101A 		vldr.32	s3, .L56+4
 635 00e0 9FED171A 		vldr.32	s2, .L56+36
 636 00e4 F0EE000A 		vmov.f32	s1, #2.0e+0
 637 00e8 9FED160A 		vldr.32	s0, .L56+40
 638 00ec 3044     		add	r0, r0, r6
 639 00ee FFF7FEFF 		bl	PID_Init
 640              	.LVL35:
 125:App/Src/motor_control.c ****                      3.0f,     // Kp
 641              		.loc 1 125 13 view .LVU167
 642 00f2 2B1B     		subs	r3, r5, r4
 643 00f4 D800     		lsls	r0, r3, #3
 644 00f6 5830     		adds	r0, r0, #88
 645 00f8 3044     		add	r0, r0, r6
 646 00fa F1EE042A 		vmov.f32	s5, #5.0e+0
 647 00fe B3EE042A 		vmov.f32	s4, #2.0e+1
 648 0102 DFED111A 		vldr.32	s3, .L56+44
 649 0106 9FED111A 		vldr.32	s2, .L56+48
 650 010a DFED110A 		vldr.32	s1, .L56+52
 651 010e B0EE080A 		vmov.f32	s0, #3.0e+0
 652 0112 0430     		adds	r0, r0, #4
 653 0114 FFF7FEFF 		bl	PID_Init
 654              	.LVL36:
 655 0118 A4E7     		b	.L51
 656              	.LVL37:
 657              	.L54:
 125:App/Src/motor_control.c ****                      3.0f,     // Kp
 658              		.loc 1 125 13 is_stmt 0 view .LVU168
 659              	.LBE6:
 660              	.LBE4:
 138:App/Src/motor_control.c **** 
 661              		.loc 1 138 1 view .LVU169
 662 011a 70BD     		pop	{r4, r5, r6, pc}
 663              	.LVL38:
 664              	.L57:
 138:App/Src/motor_control.c **** 
 665              		.loc 1 138 1 view .LVU170
 666              		.align	2
 667              	.L56:
 668 011c 00409C45 		.word	1167867904
 669 0120 00008046 		.word	1182793728
 670 0124 CDCC4C3E 		.word	1045220557
 671 0128 00000C43 		.word	1124859904
 672 012c 00001643 		.word	1125515264
 673 0130 6F12033B 		.word	990057071
 674 0134 A69B443B 		.word	994352038
 675 0138 00000000 		.word	gm6020_motors
 676 013c 00803B45 		.word	1161527296
 677 0140 9A99193E 		.word	1041865114
 678 0144 00003442 		.word	1110704128
 679 0148 0000A043 		.word	1134559232
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 19


 680 014c 6F12833B 		.word	998445679
 681 0150 0AD7A33B 		.word	1000593162
 682              		.cfi_endproc
 683              	.LFE139:
 685              		.section	.text.Motor_Update_Feedback,"ax",%progbits
 686              		.align	1
 687              		.global	Motor_Update_Feedback
 688              		.syntax unified
 689              		.thumb
 690              		.thumb_func
 692              	Motor_Update_Feedback:
 693              	.LVL39:
 694              	.LFB140:
 140:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 695              		.loc 1 140 58 is_stmt 1 view -0
 696              		.cfi_startproc
 697              		@ args = 0, pretend = 0, frame = 0
 698              		@ frame_needed = 0, uses_anonymous_args = 0
 140:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 699              		.loc 1 140 58 is_stmt 0 view .LVU172
 700 0000 08B5     		push	{r3, lr}
 701              	.LCFI5:
 702              		.cfi_def_cfa_offset 8
 703              		.cfi_offset 3, -8
 704              		.cfi_offset 14, -4
 141:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 705              		.loc 1 141 5 is_stmt 1 view .LVU173
 141:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 706              		.loc 1 141 16 is_stmt 0 view .LVU174
 707 0002 431E     		subs	r3, r0, #1
 708 0004 DBB2     		uxtb	r3, r3
 141:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 709              		.loc 1 141 8 view .LVU175
 710 0006 032B     		cmp	r3, #3
 711 0008 00D9     		bls	.L61
 712              	.LVL40:
 713              	.L58:
 150:App/Src/motor_control.c **** 
 714              		.loc 1 150 1 view .LVU176
 715 000a 08BD     		pop	{r3, pc}
 716              	.LVL41:
 717              	.L61:
 142:App/Src/motor_control.c ****     
 718              		.loc 1 142 5 is_stmt 1 view .LVU177
 142:App/Src/motor_control.c ****     
 719              		.loc 1 142 47 is_stmt 0 view .LVU178
 720 000c 431E     		subs	r3, r0, #1
 142:App/Src/motor_control.c ****     
 721              		.loc 1 142 21 view .LVU179
 722 000e C3EB4310 		rsb	r0, r3, r3, lsl #5
 723              	.LVL42:
 142:App/Src/motor_control.c ****     
 724              		.loc 1 142 21 view .LVU180
 725 0012 104A     		ldr	r2, .L62
 726 0014 02EBC000 		add	r0, r2, r0, lsl #3
 727              	.LVL43:
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 20


 728              		.loc 1 144 5 is_stmt 1 view .LVU181
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 729              		.loc 1 144 30 is_stmt 0 view .LVU182
 730 0018 91F800E0 		ldrb	lr, [r1]	@ zero_extendqisi2
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 731              		.loc 1 144 49 view .LVU183
 732 001c 91F801C0 		ldrb	ip, [r1, #1]	@ zero_extendqisi2
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 733              		.loc 1 144 40 view .LVU184
 734 0020 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 735              		.loc 1 144 20 view .LVU185
 736 0024 A0F802C0 		strh	ip, [r0, #2]	@ movhi
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 737              		.loc 1 145 5 is_stmt 1 view .LVU186
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 738              		.loc 1 145 42 is_stmt 0 view .LVU187
 739 0028 91F802E0 		ldrb	lr, [r1, #2]	@ zero_extendqisi2
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 740              		.loc 1 145 61 view .LVU188
 741 002c 91F803C0 		ldrb	ip, [r1, #3]	@ zero_extendqisi2
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 742              		.loc 1 145 24 view .LVU189
 743 0030 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 744              		.loc 1 145 22 view .LVU190
 745 0034 A0F806C0 		strh	ip, [r0, #6]	@ movhi
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 746              		.loc 1 146 5 is_stmt 1 view .LVU191
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 747              		.loc 1 146 44 is_stmt 0 view .LVU192
 748 0038 91F804E0 		ldrb	lr, [r1, #4]	@ zero_extendqisi2
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 749              		.loc 1 146 63 view .LVU193
 750 003c 91F805C0 		ldrb	ip, [r1, #5]	@ zero_extendqisi2
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 751              		.loc 1 146 26 view .LVU194
 752 0040 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 753              		.loc 1 146 24 view .LVU195
 754 0044 A0F808C0 		strh	ip, [r0, #8]	@ movhi
 147:App/Src/motor_control.c ****     
 755              		.loc 1 147 5 is_stmt 1 view .LVU196
 147:App/Src/motor_control.c ****     
 756              		.loc 1 147 17 is_stmt 0 view .LVU197
 757 0048 8979     		ldrb	r1, [r1, #6]	@ zero_extendqisi2
 758              	.LVL44:
 147:App/Src/motor_control.c ****     
 759              		.loc 1 147 17 view .LVU198
 760 004a 8172     		strb	r1, [r0, #10]
 149:App/Src/motor_control.c **** }
 761              		.loc 1 149 5 is_stmt 1 view .LVU199
 762 004c FFF7FEFF 		bl	Motor_Process_Angle
 763              	.LVL45:
 149:App/Src/motor_control.c **** }
 764              		.loc 1 149 5 is_stmt 0 view .LVU200
 765 0050 DBE7     		b	.L58
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 21


 766              	.L63:
 767 0052 00BF     		.align	2
 768              	.L62:
 769 0054 00000000 		.word	gm6020_motors
 770              		.cfi_endproc
 771              	.LFE140:
 773              		.section	.text.Motor_Set_Target,"ax",%progbits
 774              		.align	1
 775              		.global	Motor_Set_Target
 776              		.syntax unified
 777              		.thumb
 778              		.thumb_func
 780              	Motor_Set_Target:
 781              	.LVL46:
 782              	.LFB141:
 152:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 783              		.loc 1 152 68 is_stmt 1 view -0
 784              		.cfi_startproc
 785              		@ args = 0, pretend = 0, frame = 0
 786              		@ frame_needed = 0, uses_anonymous_args = 0
 153:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 787              		.loc 1 153 5 view .LVU202
 153:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 788              		.loc 1 153 16 is_stmt 0 view .LVU203
 789 0000 431E     		subs	r3, r0, #1
 790 0002 DBB2     		uxtb	r3, r3
 153:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 791              		.loc 1 153 8 view .LVU204
 792 0004 032B     		cmp	r3, #3
 793 0006 24D8     		bhi	.L67
 152:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 794              		.loc 1 152 68 view .LVU205
 795 0008 70B5     		push	{r4, r5, r6, lr}
 796              	.LCFI6:
 797              		.cfi_def_cfa_offset 16
 798              		.cfi_offset 4, -16
 799              		.cfi_offset 5, -12
 800              		.cfi_offset 6, -8
 801              		.cfi_offset 14, -4
 154:App/Src/motor_control.c ****     
 802              		.loc 1 154 5 is_stmt 1 view .LVU206
 154:App/Src/motor_control.c ****     
 803              		.loc 1 154 47 is_stmt 0 view .LVU207
 804 000a 441E     		subs	r4, r0, #1
 805              	.LVL47:
 157:App/Src/motor_control.c ****         return;
 806              		.loc 1 157 5 is_stmt 1 view .LVU208
 157:App/Src/motor_control.c ****         return;
 807              		.loc 1 157 14 is_stmt 0 view .LVU209
 808 000c C4EB4412 		rsb	r2, r4, r4, lsl #5
 809 0010 104B     		ldr	r3, .L71
 810 0012 03EBC203 		add	r3, r3, r2, lsl #3
 811 0016 93F8EC30 		ldrb	r3, [r3, #236]	@ zero_extendqisi2
 157:App/Src/motor_control.c ****         return;
 812              		.loc 1 157 8 view .LVU210
 813 001a 43B9     		cbnz	r3, .L64
 161:App/Src/motor_control.c ****     motor->mode = mode;
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 22


 814              		.loc 1 161 5 is_stmt 1 view .LVU211
 161:App/Src/motor_control.c ****     motor->mode = mode;
 815              		.loc 1 161 18 is_stmt 0 view .LVU212
 816 001c 0D4B     		ldr	r3, .L71
 817 001e 03EBC203 		add	r3, r3, r2, lsl #3
 818 0022 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 819              	.LVL48:
 162:App/Src/motor_control.c ****     motor->target_val = target;
 820              		.loc 1 162 5 is_stmt 1 view .LVU213
 162:App/Src/motor_control.c ****     motor->target_val = target;
 821              		.loc 1 162 17 is_stmt 0 view .LVU214
 822 0024 5970     		strb	r1, [r3, #1]
 823              	.LVL49:
 163:App/Src/motor_control.c ****     
 824              		.loc 1 163 5 is_stmt 1 view .LVU215
 163:App/Src/motor_control.c ****     
 825              		.loc 1 163 23 is_stmt 0 view .LVU216
 826 0026 83ED050A 		vstr.32	s0, [r3, #20]
 166:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 827              		.loc 1 166 5 is_stmt 1 view .LVU217
 166:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 828              		.loc 1 166 8 is_stmt 0 view .LVU218
 829 002a 8A42     		cmp	r2, r1
 830 002c 00D1     		bne	.L70
 831              	.LVL50:
 832              	.L64:
 170:App/Src/motor_control.c **** 
 833              		.loc 1 170 1 view .LVU219
 834 002e 70BD     		pop	{r4, r5, r6, pc}
 835              	.LVL51:
 836              	.L70:
 167:App/Src/motor_control.c ****         PID_Clear(&motor->angle_pid);
 837              		.loc 1 167 9 is_stmt 1 view .LVU220
 838 0030 6501     		lsls	r5, r4, #5
 839 0032 C4EB4410 		rsb	r0, r4, r4, lsl #5
 840              	.LVL52:
 167:App/Src/motor_control.c ****         PID_Clear(&motor->angle_pid);
 841              		.loc 1 167 9 is_stmt 0 view .LVU221
 842 0036 C000     		lsls	r0, r0, #3
 843 0038 1830     		adds	r0, r0, #24
 844 003a 064E     		ldr	r6, .L71
 845 003c 3044     		add	r0, r0, r6
 846 003e FFF7FEFF 		bl	PID_Clear
 847              	.LVL53:
 168:App/Src/motor_control.c ****     }
 848              		.loc 1 168 9 is_stmt 1 view .LVU222
 849 0042 281B     		subs	r0, r5, r4
 850 0044 C000     		lsls	r0, r0, #3
 851 0046 5830     		adds	r0, r0, #88
 852 0048 3044     		add	r0, r0, r6
 853 004a 0430     		adds	r0, r0, #4
 854 004c FFF7FEFF 		bl	PID_Clear
 855              	.LVL54:
 856 0050 EDE7     		b	.L64
 857              	.LVL55:
 858              	.L67:
 859              	.LCFI7:
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 23


 860              		.cfi_def_cfa_offset 0
 861              		.cfi_restore 4
 862              		.cfi_restore 5
 863              		.cfi_restore 6
 864              		.cfi_restore 14
 168:App/Src/motor_control.c ****     }
 865              		.loc 1 168 9 is_stmt 0 view .LVU223
 866 0052 7047     		bx	lr
 867              	.L72:
 868              		.align	2
 869              	.L71:
 870 0054 00000000 		.word	gm6020_motors
 871              		.cfi_endproc
 872              	.LFE141:
 874              		.section	.text.Motor_Control_Loop,"ax",%progbits
 875              		.align	1
 876              		.global	Motor_Control_Loop
 877              		.syntax unified
 878              		.thumb
 879              		.thumb_func
 881              	Motor_Control_Loop:
 882              	.LFB142:
 172:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 883              		.loc 1 172 31 is_stmt 1 view -0
 884              		.cfi_startproc
 885              		@ args = 0, pretend = 0, frame = 0
 886              		@ frame_needed = 0, uses_anonymous_args = 0
 887 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 888              	.LCFI8:
 889              		.cfi_def_cfa_offset 24
 890              		.cfi_offset 3, -24
 891              		.cfi_offset 4, -20
 892              		.cfi_offset 5, -16
 893              		.cfi_offset 6, -12
 894              		.cfi_offset 7, -8
 895              		.cfi_offset 14, -4
 896 0002 2DED028B 		vpush.64	{d8}
 897              	.LCFI9:
 898              		.cfi_def_cfa_offset 32
 899              		.cfi_offset 80, -32
 900              		.cfi_offset 81, -28
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 901              		.loc 1 173 5 view .LVU225
 902              	.LBB7:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 903              		.loc 1 173 10 view .LVU226
 904              	.LVL56:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 905              		.loc 1 173 14 is_stmt 0 view .LVU227
 906 0006 0024     		movs	r4, #0
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 907              		.loc 1 173 5 view .LVU228
 908 0008 4FE0     		b	.L74
 909              	.LVL57:
 910              	.L75:
 911              	.LBB8:
 180:App/Src/motor_control.c ****             motor_current_send_buf[i] = 0;
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 24


 912              		.loc 1 180 13 is_stmt 1 view .LVU229
 180:App/Src/motor_control.c ****             motor_current_send_buf[i] = 0;
 913              		.loc 1 180 35 is_stmt 0 view .LVU230
 914 000a C4EB4412 		rsb	r2, r4, r4, lsl #5
 915 000e 6A4B     		ldr	r3, .L99
 916 0010 03EBC203 		add	r3, r3, r2, lsl #3
 917 0014 0022     		movs	r2, #0
 918 0016 A3F8E420 		strh	r2, [r3, #228]	@ movhi
 181:App/Src/motor_control.c ****             continue;
 919              		.loc 1 181 13 is_stmt 1 view .LVU231
 181:App/Src/motor_control.c ****             continue;
 920              		.loc 1 181 39 is_stmt 0 view .LVU232
 921 001a 684B     		ldr	r3, .L99+4
 922 001c 23F81420 		strh	r2, [r3, r4, lsl #1]	@ movhi
 182:App/Src/motor_control.c ****         }
 923              		.loc 1 182 13 is_stmt 1 view .LVU233
 924 0020 42E0     		b	.L77
 925              	.LVL58:
 926              	.L97:
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 927              		.loc 1 185 46 is_stmt 0 discriminator 1 view .LVU234
 928 0022 012B     		cmp	r3, #1
 929 0024 5FD1     		bne	.L78
 176:App/Src/motor_control.c ****         
 930              		.loc 1 176 15 view .LVU235
 931 0026 9FED668A 		vldr.32	s16, .L99+8
 932 002a 15E0     		b	.L80
 933              	.L81:
 194:App/Src/motor_control.c ****                     break;
 934              		.loc 1 194 21 is_stmt 1 view .LVU236
 194:App/Src/motor_control.c ****                     break;
 935              		.loc 1 194 90 is_stmt 0 view .LVU237
 936 002c 6248     		ldr	r0, .L99
 937 002e C4EB4413 		rsb	r3, r4, r4, lsl #5
 938 0032 00EBC303 		add	r3, r0, r3, lsl #3
 939 0036 B3F90630 		ldrsh	r3, [r3, #6]
 940 003a 00EE903A 		vmov	s1, r3	@ int
 194:App/Src/motor_control.c ****                     break;
 941              		.loc 1 194 38 view .LVU238
 942 003e C4EB4413 		rsb	r3, r4, r4, lsl #5
 943 0042 DB00     		lsls	r3, r3, #3
 944 0044 1833     		adds	r3, r3, #24
 945 0046 F8EEE00A 		vcvt.f32.s32	s1, s1
 946 004a B0EE480A 		vmov.f32	s0, s16
 947 004e 1844     		add	r0, r0, r3
 948 0050 FFF7FEFF 		bl	PID_Calc
 949              	.LVL59:
 194:App/Src/motor_control.c ****                     break;
 950              		.loc 1 194 38 view .LVU239
 951 0054 B0EE408A 		vmov.f32	s16, s0
 952              	.LVL60:
 195:App/Src/motor_control.c ****                     
 953              		.loc 1 195 21 is_stmt 1 view .LVU240
 954              	.L80:
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 955              		.loc 1 217 9 view .LVU241
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 25


 956              		.loc 1 217 18 is_stmt 0 view .LVU242
 957 0058 C4EB4413 		rsb	r3, r4, r4, lsl #5
 958 005c 564A     		ldr	r2, .L99
 959 005e 12F83330 		ldrb	r3, [r2, r3, lsl #3]	@ zero_extendqisi2
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 960              		.loc 1 217 12 view .LVU243
 961 0062 042B     		cmp	r3, #4
 962 0064 0AD0     		beq	.L85
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 963              		.loc 1 217 37 discriminator 1 view .LVU244
 964 0066 C4EB4412 		rsb	r2, r4, r4, lsl #5
 965 006a 534B     		ldr	r3, .L99
 966 006c 03EBC203 		add	r3, r3, r2, lsl #3
 967 0070 5B78     		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 968              		.loc 1 217 72 discriminator 1 view .LVU245
 969 0072 013B     		subs	r3, r3, #1
 970 0074 DBB2     		uxtb	r3, r3
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 971              		.loc 1 217 28 discriminator 1 view .LVU246
 972 0076 012B     		cmp	r3, #1
 973 0078 40F28180 		bls	.L94
 974              	.L85:
 223:App/Src/motor_control.c ****             current_target += Calculate_Static_Friction_Compensation(motor);
 975              		.loc 1 223 9 is_stmt 1 view .LVU247
 223:App/Src/motor_control.c ****             current_target += Calculate_Static_Friction_Compensation(motor);
 976              		.loc 1 223 12 is_stmt 0 view .LVU248
 977 007c 032C     		cmp	r4, #3
 978 007e 00F08F80 		beq	.L95
 979              	.L86:
 228:App/Src/motor_control.c ****         
 980              		.loc 1 228 9 is_stmt 1 view .LVU249
 228:App/Src/motor_control.c ****         
 981              		.loc 1 228 33 is_stmt 0 view .LVU250
 982 0082 B0EE480A 		vmov.f32	s0, s16
 983 0086 FFF7FEFF 		bl	limit_current
 984              	.LVL61:
 228:App/Src/motor_control.c ****         
 985              		.loc 1 228 31 discriminator 1 view .LVU251
 986 008a C4EB4413 		rsb	r3, r4, r4, lsl #5
 987 008e 4A4E     		ldr	r6, .L99
 988 0090 06EBC306 		add	r6, r6, r3, lsl #3
 989 0094 A6F8E400 		strh	r0, [r6, #228]	@ movhi
 231:App/Src/motor_control.c ****         
 990              		.loc 1 231 9 is_stmt 1 view .LVU252
 991 0098 2846     		mov	r0, r5
 992 009a FFF7FEFF 		bl	Motor_Check_Stall
 993              	.LVL62:
 234:App/Src/motor_control.c ****     }
 994              		.loc 1 234 9 view .LVU253
 234:App/Src/motor_control.c ****     }
 995              		.loc 1 234 42 is_stmt 0 view .LVU254
 996 009e B6F9E420 		ldrsh	r2, [r6, #228]
 234:App/Src/motor_control.c ****     }
 997              		.loc 1 234 35 view .LVU255
 998 00a2 464B     		ldr	r3, .L99+4
 999 00a4 23F81420 		strh	r2, [r3, r4, lsl #1]	@ movhi
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 26


 1000              	.LVL63:
 1001              	.L77:
 234:App/Src/motor_control.c ****     }
 1002              		.loc 1 234 35 view .LVU256
 1003              	.LBE8:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 1004              		.loc 1 173 29 is_stmt 1 discriminator 2 view .LVU257
 1005 00a8 0134     		adds	r4, r4, #1
 1006              	.LVL64:
 1007              	.L74:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 1008              		.loc 1 173 23 discriminator 1 view .LVU258
 1009 00aa 032C     		cmp	r4, #3
 1010 00ac 7EDC     		bgt	.L96
 1011              	.LBB12:
 174:App/Src/motor_control.c ****         float speed_target = 0;
 1012              		.loc 1 174 9 view .LVU259
 174:App/Src/motor_control.c ****         float speed_target = 0;
 1013              		.loc 1 174 25 is_stmt 0 view .LVU260
 1014 00ae C4EB4413 		rsb	r3, r4, r4, lsl #5
 1015 00b2 414D     		ldr	r5, .L99
 1016 00b4 05EBC305 		add	r5, r5, r3, lsl #3
 1017              	.LVL65:
 175:App/Src/motor_control.c ****         float current_target = 0;
 1018              		.loc 1 175 9 is_stmt 1 view .LVU261
 176:App/Src/motor_control.c ****         
 1019              		.loc 1 176 9 view .LVU262
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1020              		.loc 1 179 9 view .LVU263
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1021              		.loc 1 179 18 is_stmt 0 view .LVU264
 1022 00b8 95F8EC30 		ldrb	r3, [r5, #236]	@ zero_extendqisi2
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1023              		.loc 1 179 12 view .LVU265
 1024 00bc 002B     		cmp	r3, #0
 1025 00be A4D1     		bne	.L75
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1026              		.loc 1 179 39 discriminator 2 view .LVU266
 1027 00c0 6B78     		ldrb	r3, [r5, #1]	@ zero_extendqisi2
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1028              		.loc 1 179 31 discriminator 2 view .LVU267
 1029 00c2 032B     		cmp	r3, #3
 1030 00c4 A1D0     		beq	.L75
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1031              		.loc 1 185 10 is_stmt 1 view .LVU268
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1032              		.loc 1 185 25 is_stmt 0 view .LVU269
 1033 00c6 C4EB4411 		rsb	r1, r4, r4, lsl #5
 1034 00ca 3B4A     		ldr	r2, .L99
 1035 00cc 02EBC102 		add	r2, r2, r1, lsl #3
 1036 00d0 92ED058A 		vldr.32	s16, [r2, #20]
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1037              		.loc 1 185 14 view .LVU270
 1038 00d4 B0EEC87A 		vabs.f32	s14, s16
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1039              		.loc 1 185 13 view .LVU271
 1040 00d8 F7EE007A 		vmov.f32	s15, #1.0e+0
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 27


 1041 00dc B4EEE77A 		vcmpe.f32	s14, s15
 1042 00e0 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1043 00e4 9DD4     		bmi	.L97
 1044              	.L78:
 189:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_OPEN:
 1045              		.loc 1 189 13 is_stmt 1 view .LVU272
 1046 00e6 012B     		cmp	r3, #1
 1047 00e8 A0D0     		beq	.L81
 1048 00ea 022B     		cmp	r3, #2
 1049 00ec 04D0     		beq	.L82
 1050 00ee 002B     		cmp	r3, #0
 1051 00f0 B2D0     		beq	.L80
 1052 00f2 9FED338A 		vldr.32	s16, .L99+8
 1053 00f6 AFE7     		b	.L80
 1054              	.L82:
 1055              	.LBB9:
 199:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 1056              		.loc 1 199 21 view .LVU273
 199:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 1057              		.loc 1 199 66 is_stmt 0 view .LVU274
 1058 00f8 C4EB4412 		rsb	r2, r4, r4, lsl #5
 1059 00fc 2E4B     		ldr	r3, .L99
 1060 00fe 03EBC203 		add	r3, r3, r2, lsl #3
 1061 0102 D3ED040A 		vldr.32	s1, [r3, #16]
 199:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 1062              		.loc 1 199 27 view .LVU275
 1063 0106 78EE607A 		vsub.f32	s15, s16, s1
 1064              	.LVL66:
 200:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 1065              		.loc 1 200 21 is_stmt 1 view .LVU276
 200:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 1066              		.loc 1 200 25 is_stmt 0 view .LVU277
 1067 010a F0EEE77A 		vabs.f32	s15, s15
 1068              	.LVL67:
 200:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 1069              		.loc 1 200 24 view .LVU278
 1070 010e B7EE007A 		vmov.f32	s14, #1.0e+0
 1071 0112 F4EEC77A 		vcmpe.f32	s15, s14
 1072 0116 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1073 011a 1DD4     		bmi	.L98
 1074              	.LBB10:
 205:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 1075              		.loc 1 205 25 is_stmt 1 view .LVU279
 205:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 1076              		.loc 1 205 46 is_stmt 0 view .LVU280
 1077 011c 6601     		lsls	r6, r4, #5
 1078 011e C4EB4410 		rsb	r0, r4, r4, lsl #5
 1079 0122 C000     		lsls	r0, r0, #3
 1080 0124 5830     		adds	r0, r0, #88
 1081 0126 244F     		ldr	r7, .L99
 1082 0128 3844     		add	r0, r0, r7
 1083 012a B0EE480A 		vmov.f32	s0, s16
 1084 012e 0430     		adds	r0, r0, #4
 1085 0130 FFF7FEFF 		bl	PID_Calc
 1086              	.LVL68:
 206:App/Src/motor_control.c ****                     }
 1087              		.loc 1 206 25 is_stmt 1 view .LVU281
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 28


 206:App/Src/motor_control.c ****                     }
 1088              		.loc 1 206 89 is_stmt 0 view .LVU282
 1089 0134 321B     		subs	r2, r6, r4
 1090 0136 07EBC202 		add	r2, r7, r2, lsl #3
 1091 013a B2F90620 		ldrsh	r2, [r2, #6]
 1092 013e 00EE902A 		vmov	s1, r2	@ int
 206:App/Src/motor_control.c ****                     }
 1093              		.loc 1 206 42 view .LVU283
 1094 0142 301B     		subs	r0, r6, r4
 1095 0144 C000     		lsls	r0, r0, #3
 1096 0146 1830     		adds	r0, r0, #24
 1097 0148 F8EEE00A 		vcvt.f32.s32	s1, s1
 1098 014c 3844     		add	r0, r0, r7
 1099 014e FFF7FEFF 		bl	PID_Calc
 1100              	.LVL69:
 206:App/Src/motor_control.c ****                     }
 1101              		.loc 1 206 42 view .LVU284
 1102 0152 B0EE408A 		vmov.f32	s16, s0
 1103              	.LVL70:
 206:App/Src/motor_control.c ****                     }
 1104              		.loc 1 206 42 view .LVU285
 1105 0156 7FE7     		b	.L80
 1106              	.LVL71:
 1107              	.L98:
 206:App/Src/motor_control.c ****                     }
 1108              		.loc 1 206 42 view .LVU286
 1109              	.LBE10:
 1110              	.LBB11:
 202:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 1111              		.loc 1 202 25 is_stmt 1 view .LVU287
 203:App/Src/motor_control.c ****                     } else {
 1112              		.loc 1 203 25 view .LVU288
 203:App/Src/motor_control.c ****                     } else {
 1113              		.loc 1 203 89 is_stmt 0 view .LVU289
 1114 0158 1748     		ldr	r0, .L99
 1115 015a 00EBC203 		add	r3, r0, r2, lsl #3
 1116 015e B3F90630 		ldrsh	r3, [r3, #6]
 1117 0162 00EE903A 		vmov	s1, r3	@ int
 1118              	.LVL72:
 203:App/Src/motor_control.c ****                     } else {
 1119              		.loc 1 203 42 view .LVU290
 1120 0166 D300     		lsls	r3, r2, #3
 1121 0168 1833     		adds	r3, r3, #24
 1122 016a F8EEE00A 		vcvt.f32.s32	s1, s1
 1123 016e 9FED140A 		vldr.32	s0, .L99+8
 1124 0172 1844     		add	r0, r0, r3
 1125              	.LVL73:
 203:App/Src/motor_control.c ****                     } else {
 1126              		.loc 1 203 42 view .LVU291
 1127 0174 FFF7FEFF 		bl	PID_Calc
 1128              	.LVL74:
 203:App/Src/motor_control.c ****                     } else {
 1129              		.loc 1 203 42 view .LVU292
 1130 0178 B0EE408A 		vmov.f32	s16, s0
 1131              	.LVL75:
 203:App/Src/motor_control.c ****                     } else {
 1132              		.loc 1 203 42 view .LVU293
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 29


 1133              	.LBE11:
 1134 017c 6CE7     		b	.L80
 1135              	.LVL76:
 1136              	.L94:
 203:App/Src/motor_control.c ****                     } else {
 1137              		.loc 1 203 42 view .LVU294
 1138              	.LBE9:
 220:App/Src/motor_control.c ****             current_target += motor->feedforward;
 1139              		.loc 1 220 13 is_stmt 1 view .LVU295
 220:App/Src/motor_control.c ****             current_target += motor->feedforward;
 1140              		.loc 1 220 34 is_stmt 0 view .LVU296
 1141 017e 2846     		mov	r0, r5
 1142 0180 FFF7FEFF 		bl	Motor_Calc_Gravity_FF
 1143              	.LVL77:
 220:App/Src/motor_control.c ****             current_target += motor->feedforward;
 1144              		.loc 1 220 32 discriminator 1 view .LVU297
 1145 0184 C4EB4412 		rsb	r2, r4, r4, lsl #5
 1146 0188 0B4B     		ldr	r3, .L99
 1147 018a 03EBC203 		add	r3, r3, r2, lsl #3
 1148 018e A3F8F400 		strh	r0, [r3, #244]	@ movhi
 221:App/Src/motor_control.c ****         }
 1149              		.loc 1 221 13 is_stmt 1 view .LVU298
 221:App/Src/motor_control.c ****         }
 1150              		.loc 1 221 28 is_stmt 0 view .LVU299
 1151 0192 07EE900A 		vmov	s15, r0	@ int
 1152 0196 F8EEE77A 		vcvt.f32.s32	s15, s15
 1153 019a 38EE278A 		vadd.f32	s16, s16, s15
 1154              	.LVL78:
 221:App/Src/motor_control.c ****         }
 1155              		.loc 1 221 28 view .LVU300
 1156 019e 6DE7     		b	.L85
 1157              	.L95:
 224:App/Src/motor_control.c ****         }
 1158              		.loc 1 224 13 is_stmt 1 view .LVU301
 224:App/Src/motor_control.c ****         }
 1159              		.loc 1 224 31 is_stmt 0 view .LVU302
 1160 01a0 2846     		mov	r0, r5
 1161 01a2 FFF7FEFF 		bl	Calculate_Static_Friction_Compensation
 1162              	.LVL79:
 224:App/Src/motor_control.c ****         }
 1163              		.loc 1 224 28 discriminator 1 view .LVU303
 1164 01a6 38EE008A 		vadd.f32	s16, s16, s0
 1165              	.LVL80:
 224:App/Src/motor_control.c ****         }
 1166              		.loc 1 224 28 discriminator 1 view .LVU304
 1167 01aa 6AE7     		b	.L86
 1168              	.LVL81:
 1169              	.L96:
 224:App/Src/motor_control.c ****         }
 1170              		.loc 1 224 28 discriminator 1 view .LVU305
 1171              	.LBE12:
 1172              	.LBE7:
 238:App/Src/motor_control.c **** }
 1173              		.loc 1 238 5 is_stmt 1 view .LVU306
 1174 01ac FFF7FEFF 		bl	BSP_CAN_Send_Current_Cmd
 1175              	.LVL82:
 239:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor) {
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 30


 1176              		.loc 1 239 1 is_stmt 0 view .LVU307
 1177 01b0 BDEC028B 		vldm	sp!, {d8}
 1178              	.LCFI10:
 1179              		.cfi_restore 80
 1180              		.cfi_restore 81
 1181              		.cfi_def_cfa_offset 24
 1182 01b4 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1183              	.LVL83:
 1184              	.L100:
 239:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor) {
 1185              		.loc 1 239 1 view .LVU308
 1186 01b6 00BF     		.align	2
 1187              	.L99:
 1188 01b8 00000000 		.word	gm6020_motors
 1189 01bc 00000000 		.word	motor_current_send_buf
 1190 01c0 00000000 		.word	0
 1191              		.cfi_endproc
 1192              	.LFE142:
 1194              		.section	.text.Motor_Set_Dual_Target,"ax",%progbits
 1195              		.align	1
 1196              		.global	Motor_Set_Dual_Target
 1197              		.syntax unified
 1198              		.thumb
 1199              		.thumb_func
 1201              	Motor_Set_Dual_Target:
 1202              	.LVL84:
 1203              	.LFB145:
 249:App/Src/motor_control.c **** 
 250:App/Src/motor_control.c **** // ✅ 新增：静止电机处理
 251:App/Src/motor_control.c **** static float Handle_Static_Motor(GM6020_TypeDef *motor) {
 252:App/Src/motor_control.c ****     // 智能静止保持：根据历史电流调整
 253:App/Src/motor_control.c ****     static float last_current[4] = {0};
 254:App/Src/motor_control.c ****     uint8_t idx = motor->id - 1;
 255:App/Src/motor_control.c ****     
 256:App/Src/motor_control.c ****     if (fabsf(motor->speed_rpm) < 0.3f) {
 257:App/Src/motor_control.c ****         // 保持之前的电流，但逐渐衰减
 258:App/Src/motor_control.c ****         return last_current[idx] * 0.98f;
 259:App/Src/motor_control.c ****     } else {
 260:App/Src/motor_control.c ****         // 有微小速度，使用小比例控制
 261:App/Src/motor_control.c ****         float small_kp = 20.0f; // 小比例系数
 262:App/Src/motor_control.c ****         return small_kp * (-motor->speed_rpm);
 263:App/Src/motor_control.c ****     }
 264:App/Src/motor_control.c **** }
 265:App/Src/motor_control.c **** void Motor_Set_Dual_Target(uint8_t id1, Motor_Mode_e mode1, float target1,
 266:App/Src/motor_control.c ****                            uint8_t id2, Motor_Mode_e mode2, float target2) {
 1204              		.loc 1 266 76 is_stmt 1 view -0
 1205              		.cfi_startproc
 1206              		@ args = 0, pretend = 0, frame = 0
 1207              		@ frame_needed = 0, uses_anonymous_args = 0
 1208              		.loc 1 266 76 is_stmt 0 view .LVU310
 1209 0000 38B5     		push	{r3, r4, r5, lr}
 1210              	.LCFI11:
 1211              		.cfi_def_cfa_offset 16
 1212              		.cfi_offset 3, -16
 1213              		.cfi_offset 4, -12
 1214              		.cfi_offset 5, -8
 1215              		.cfi_offset 14, -4
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 31


 1216 0002 2DED028B 		vpush.64	{d8}
 1217              	.LCFI12:
 1218              		.cfi_def_cfa_offset 24
 1219              		.cfi_offset 80, -24
 1220              		.cfi_offset 81, -20
 1221 0006 1446     		mov	r4, r2
 1222 0008 1D46     		mov	r5, r3
 1223 000a B0EE608A 		vmov.f32	s16, s1
 267:App/Src/motor_control.c ****     Motor_Set_Target(id1, mode1, target1);
 1224              		.loc 1 267 5 is_stmt 1 view .LVU311
 1225 000e FFF7FEFF 		bl	Motor_Set_Target
 1226              	.LVL85:
 268:App/Src/motor_control.c ****     Motor_Set_Target(id2, mode2, target2);
 1227              		.loc 1 268 5 view .LVU312
 1228 0012 B0EE480A 		vmov.f32	s0, s16
 1229 0016 2946     		mov	r1, r5
 1230 0018 2046     		mov	r0, r4
 1231 001a FFF7FEFF 		bl	Motor_Set_Target
 1232              	.LVL86:
 269:App/Src/motor_control.c **** }...
 1233              		.loc 1 269 1 is_stmt 0 view .LVU313
 1234 001e BDEC028B 		vldm	sp!, {d8}
 1235              	.LCFI13:
 1236              		.cfi_restore 80
 1237              		.cfi_restore 81
 1238              		.cfi_def_cfa_offset 16
 1239              	.LVL87:
 1240              		.loc 1 269 1 view .LVU314
 1241 0022 38BD     		pop	{r3, r4, r5, pc}
 1242              		.loc 1 269 1 view .LVU315
 1243              		.cfi_endproc
 1244              	.LFE145:
 1246              		.global	gm6020_motors
 1247              		.section	.bss.gm6020_motors,"aw",%nobits
 1248              		.align	2
 1251              	gm6020_motors:
 1252 0000 00000000 		.space	992
 1252      00000000 
 1252      00000000 
 1252      00000000 
 1252      00000000 
 1253              		.text
 1254              	.Letext0:
 1255              		.file 2 "C:/msys64/mingw64/arm-none-eabi/include/machine/_default_types.h"
 1256              		.file 3 "C:/msys64/mingw64/arm-none-eabi/include/sys/_stdint.h"
 1257              		.file 4 "App/Inc/pid.h"
 1258              		.file 5 "App/Inc/motor_control.h"
 1259              		.file 6 "C:/msys64/mingw64/arm-none-eabi/include/math.h"
 1260              		.file 7 "App/Inc/can_bsp.h"
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s 			page 32


DEFINED SYMBOLS
                            *ABS*:00000000 motor_control.c
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:21     .text.Motor_Process_Angle:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:26     .text.Motor_Process_Angle:00000000 Motor_Process_Angle
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:94     .text.Motor_Process_Angle:00000050 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:100    .text.limit_current:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:105    .text.limit_current:00000000 limit_current
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:146    .text.limit_current:00000034 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:153    .text.Motor_Check_Stall:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:158    .text.Motor_Check_Stall:00000000 Motor_Check_Stall
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:230    .text.Motor_Check_Stall:00000070 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:236    .text.Calculate_Static_Friction_Compensation:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:241    .text.Calculate_Static_Friction_Compensation:00000000 Calculate_Static_Friction_Compensation
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:287    .text.Calculate_Static_Friction_Compensation:00000040 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:295    .text.Motor_Calc_Gravity_FF:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:300    .text.Motor_Calc_Gravity_FF:00000000 Motor_Calc_Gravity_FF
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:417    .text.Motor_Calc_Gravity_FF:00000084 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:425    .text.Motor_Clear_Stall:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:431    .text.Motor_Clear_Stall:00000000 Motor_Clear_Stall
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:475    .text.Motor_Clear_Stall:0000002c $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:1251   .bss.gm6020_motors:00000000 gm6020_motors
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:480    .text.Motor_Init_All:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:486    .text.Motor_Init_All:00000000 Motor_Init_All
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:668    .text.Motor_Init_All:0000011c $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:686    .text.Motor_Update_Feedback:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:692    .text.Motor_Update_Feedback:00000000 Motor_Update_Feedback
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:769    .text.Motor_Update_Feedback:00000054 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:774    .text.Motor_Set_Target:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:780    .text.Motor_Set_Target:00000000 Motor_Set_Target
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:870    .text.Motor_Set_Target:00000054 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:875    .text.Motor_Control_Loop:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:881    .text.Motor_Control_Loop:00000000 Motor_Control_Loop
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:1188   .text.Motor_Control_Loop:000001b8 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:1195   .text.Motor_Set_Dual_Target:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:1201   .text.Motor_Set_Dual_Target:00000000 Motor_Set_Dual_Target
C:\Users\wxwsyzh\AppData\Local\Temp\ccv8PjuC.s:1248   .bss.gm6020_motors:00000000 $d

UNDEFINED SYMBOLS
cosf
sinf
PID_Init
PID_Clear
PID_Calc
BSP_CAN_Send_Current_Cmd
motor_current_send_buf
