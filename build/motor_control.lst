ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"motor_control.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "App/Src/motor_control.c"
  20              		.section	.text.Motor_Process_Angle,"ax",%progbits
  21              		.align	1
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	Motor_Process_Angle:
  27              	.LVL0:
  28              	.LFB134:
   1:App/Src/motor_control.c **** #include "motor_control.h"
   2:App/Src/motor_control.c **** #include "can_bsp.h"
   3:App/Src/motor_control.c **** #include <math.h>
   4:App/Src/motor_control.c **** 
   5:App/Src/motor_control.c **** GM6020_TypeDef gm6020_motors[4];
   6:App/Src/motor_control.c **** //int16_t motor_current_send_buf[4]; // 添加发送缓冲区定义
   7:App/Src/motor_control.c **** 
   8:App/Src/motor_control.c **** #define PI 3.1415926535f
   9:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor);
  10:App/Src/motor_control.c **** static float Handle_Static_Motor(GM6020_TypeDef *motor);
  11:App/Src/motor_control.c **** /**
  12:App/Src/motor_control.c ****  * @brief 角度处理
  13:App/Src/motor_control.c ****  */
  14:App/Src/motor_control.c **** static void Motor_Process_Angle(GM6020_TypeDef *motor) {
  29              		.loc 1 14 56 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
  15:App/Src/motor_control.c ****     int diff = motor->ecd_raw - motor->last_ecd;
  34              		.loc 1 15 5 view .LVU1
  35              		.loc 1 15 21 is_stmt 0 view .LVU2
  36 0000 4288     		ldrh	r2, [r0, #2]
  37              		.loc 1 15 38 view .LVU3
  38 0002 8388     		ldrh	r3, [r0, #4]
  39              		.loc 1 15 9 view .LVU4
  40 0004 D31A     		subs	r3, r2, r3
  41              	.LVL1:
  16:App/Src/motor_control.c ****     if (diff > 4096) motor->round_cnt--;
  42              		.loc 1 16 5 is_stmt 1 view .LVU5
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 2


  43              		.loc 1 16 8 is_stmt 0 view .LVU6
  44 0006 B3F5805F 		cmp	r3, #4096
  45 000a 1ADD     		ble	.L2
  46              		.loc 1 16 22 is_stmt 1 discriminator 1 view .LVU7
  47              		.loc 1 16 27 is_stmt 0 discriminator 1 view .LVU8
  48 000c C368     		ldr	r3, [r0, #12]
  49              	.LVL2:
  50              		.loc 1 16 38 discriminator 1 view .LVU9
  51 000e 013B     		subs	r3, r3, #1
  52 0010 C360     		str	r3, [r0, #12]
  53              	.L3:
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  18:App/Src/motor_control.c ****     motor->total_angle = motor->round_cnt * 360.0f + (motor->ecd_raw / 8192.0f * 360.0f);
  54              		.loc 1 18 5 is_stmt 1 view .LVU10
  55              		.loc 1 18 43 is_stmt 0 view .LVU11
  56 0012 D0ED037A 		vldr.32	s15, [r0, #12]	@ int
  57 0016 F8EEE77A 		vcvt.f32.s32	s15, s15
  58 001a DFED0D6A 		vldr.32	s13, .L4
  59 001e 67EEA67A 		vmul.f32	s15, s15, s13
  60              		.loc 1 18 70 view .LVU12
  61 0022 07EE102A 		vmov	s14, r2	@ int
  62 0026 B8EEC77A 		vcvt.f32.s32	s14, s14
  63 002a 9FED0A6A 		vldr.32	s12, .L4+4
  64 002e 27EE067A 		vmul.f32	s14, s14, s12
  65              		.loc 1 18 80 view .LVU13
  66 0032 27EE267A 		vmul.f32	s14, s14, s13
  67              		.loc 1 18 52 view .LVU14
  68 0036 77EE877A 		vadd.f32	s15, s15, s14
  69              		.loc 1 18 24 view .LVU15
  70 003a C0ED047A 		vstr.32	s15, [r0, #16]
  19:App/Src/motor_control.c ****     motor->last_ecd = motor->ecd_raw;
  71              		.loc 1 19 5 is_stmt 1 view .LVU16
  72              		.loc 1 19 21 is_stmt 0 view .LVU17
  73 003e 8280     		strh	r2, [r0, #4]	@ movhi
  74              	.LVL3:
  20:App/Src/motor_control.c **** }
  75              		.loc 1 20 1 view .LVU18
  76 0040 7047     		bx	lr
  77              	.LVL4:
  78              	.L2:
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  79              		.loc 1 17 10 is_stmt 1 view .LVU19
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  80              		.loc 1 17 13 is_stmt 0 view .LVU20
  81 0042 13F5805F 		cmn	r3, #4096
  82 0046 E4DA     		bge	.L3
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  83              		.loc 1 17 28 is_stmt 1 discriminator 1 view .LVU21
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  84              		.loc 1 17 33 is_stmt 0 discriminator 1 view .LVU22
  85 0048 C368     		ldr	r3, [r0, #12]
  86              	.LVL5:
  17:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  87              		.loc 1 17 44 discriminator 1 view .LVU23
  88 004a 0133     		adds	r3, r3, #1
  89 004c C360     		str	r3, [r0, #12]
  90 004e E0E7     		b	.L3
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 3


  91              	.L5:
  92              		.align	2
  93              	.L4:
  94 0050 0000B443 		.word	1135869952
  95 0054 00000039 		.word	956301312
  96              		.cfi_endproc
  97              	.LFE134:
  99              		.section	.text.limit_current,"ax",%progbits
 100              		.align	1
 101              		.syntax unified
 102              		.thumb
 103              		.thumb_func
 105              	limit_current:
 106              	.LVL6:
 107              	.LFB136:
  21:App/Src/motor_control.c **** 
  22:App/Src/motor_control.c **** /**
  23:App/Src/motor_control.c ****  * @brief 计算重力前馈
  24:App/Src/motor_control.c ****  */
  25:App/Src/motor_control.c **** static int16_t Motor_Calc_Gravity_FF(GM6020_TypeDef *motor) {
  26:App/Src/motor_control.c ****     if (motor->id == 4) {
  27:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
  28:App/Src/motor_control.c ****         return (int16_t)(PITCH_GRAVITY_GAIN * sinf(motor->total_angle * PI / 180.0f));
  29:App/Src/motor_control.c ****     }
  30:App/Src/motor_control.c ****      if (motor->id == 4) return 0;
  31:App/Src/motor_control.c ****     int32_t ecd_diff = motor->ecd_raw - motor->horizon_ecd;
  32:App/Src/motor_control.c ****     
  33:App/Src/motor_control.c ****     if (ecd_diff > 4096)  ecd_diff -= 8192;
  34:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
  35:App/Src/motor_control.c **** 
  36:App/Src/motor_control.c ****     float angle_rad = (float)ecd_diff * (2.0f * PI / 8192.0f);
  37:App/Src/motor_control.c ****     return (int16_t)(motor->gravity_gain * cosf(angle_rad));
  38:App/Src/motor_control.c **** }
  39:App/Src/motor_control.c **** 
  40:App/Src/motor_control.c **** // 辅助函数：限制电流范围
  41:App/Src/motor_control.c **** static int16_t limit_current(float val) {
 108              		.loc 1 41 41 is_stmt 1 view -0
 109              		.cfi_startproc
 110              		@ args = 0, pretend = 0, frame = 0
 111              		@ frame_needed = 0, uses_anonymous_args = 0
 112              		@ link register save eliminated.
  42:App/Src/motor_control.c ****     if (val > GM6020_MAX_CURRENT) return (int16_t)GM6020_MAX_CURRENT;
 113              		.loc 1 42 5 view .LVU25
 114              		.loc 1 42 8 is_stmt 0 view .LVU26
 115 0000 DFED0C7A 		vldr.32	s15, .L10
 116 0004 B4EEE70A 		vcmpe.f32	s0, s15
 117 0008 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 118 000c 0CDC     		bgt	.L8
  43:App/Src/motor_control.c ****     if (val < -GM6020_MAX_CURRENT) return (int16_t)-GM6020_MAX_CURRENT;
 119              		.loc 1 43 5 is_stmt 1 view .LVU27
 120              		.loc 1 43 8 is_stmt 0 view .LVU28
 121 000e DFED0A7A 		vldr.32	s15, .L10+4
 122 0012 B4EEE70A 		vcmpe.f32	s0, s15
 123 0016 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 124 001a 08D4     		bmi	.L9
  44:App/Src/motor_control.c ****     return (int16_t)val;
 125              		.loc 1 44 5 is_stmt 1 view .LVU29
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 4


 126              		.loc 1 44 12 is_stmt 0 view .LVU30
 127 001c BDEEC00A 		vcvt.s32.f32	s0, s0
 128              	.LVL7:
 129              		.loc 1 44 12 view .LVU31
 130 0020 10EE103A 		vmov	r3, s0	@ int
 131 0024 18B2     		sxth	r0, r3
 132 0026 7047     		bx	lr
 133              	.LVL8:
 134              	.L8:
  42:App/Src/motor_control.c ****     if (val > GM6020_MAX_CURRENT) return (int16_t)GM6020_MAX_CURRENT;
 135              		.loc 1 42 42 discriminator 1 view .LVU32
 136 0028 4FF48040 		mov	r0, #16384
 137 002c 7047     		bx	lr
 138              	.L9:
  43:App/Src/motor_control.c ****     if (val < -GM6020_MAX_CURRENT) return (int16_t)-GM6020_MAX_CURRENT;
 139              		.loc 1 43 43 discriminator 1 view .LVU33
 140 002e 0348     		ldr	r0, .L10+8
  45:App/Src/motor_control.c **** }
 141              		.loc 1 45 1 view .LVU34
 142 0030 7047     		bx	lr
 143              	.L11:
 144 0032 00BF     		.align	2
 145              	.L10:
 146 0034 00008046 		.word	1182793728
 147 0038 000080C6 		.word	-964689920
 148 003c 00C0FFFF 		.word	-16384
 149              		.cfi_endproc
 150              	.LFE136:
 152              		.section	.text.Motor_Check_Stall,"ax",%progbits
 153              		.align	1
 154              		.syntax unified
 155              		.thumb
 156              		.thumb_func
 158              	Motor_Check_Stall:
 159              	.LVL9:
 160              	.LFB137:
  46:App/Src/motor_control.c **** 
  47:App/Src/motor_control.c **** /**
  48:App/Src/motor_control.c ****  * @brief 堵转检测逻辑 (只保留一个定义)
  49:App/Src/motor_control.c ****  */
  50:App/Src/motor_control.c **** static void Motor_Check_Stall(GM6020_TypeDef *motor) {
 161              		.loc 1 50 54 is_stmt 1 view -0
 162              		.cfi_startproc
 163              		@ args = 0, pretend = 0, frame = 0
 164              		@ frame_needed = 0, uses_anonymous_args = 0
 165              		@ link register save eliminated.
  51:App/Src/motor_control.c ****     if (motor->mode == MOTOR_MODE_STOP || motor->is_stalled) return;
 166              		.loc 1 51 5 view .LVU36
 167              		.loc 1 51 14 is_stmt 0 view .LVU37
 168 0000 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
 169              		.loc 1 51 8 view .LVU38
 170 0002 032B     		cmp	r3, #3
 171 0004 32D0     		beq	.L12
 172              		.loc 1 51 48 discriminator 2 view .LVU39
 173 0006 90F8EC30 		ldrb	r3, [r0, #236]	@ zero_extendqisi2
 174              		.loc 1 51 40 discriminator 2 view .LVU40
 175 000a 7BBB     		cbnz	r3, .L12
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 5


  52:App/Src/motor_control.c **** 
  53:App/Src/motor_control.c ****     if (fabsf(motor->output_current) > STALL_CURRENT_THRESH && 
 176              		.loc 1 53 5 is_stmt 1 view .LVU41
 177              		.loc 1 53 20 is_stmt 0 view .LVU42
 178 000c B0F9E430 		ldrsh	r3, [r0, #228]
 179 0010 07EE903A 		vmov	s15, r3	@ int
 180              		.loc 1 53 9 view .LVU43
 181 0014 F8EEE77A 		vcvt.f32.s32	s15, s15
 182 0018 F0EEE77A 		vabs.f32	s15, s15
 183              		.loc 1 53 8 view .LVU44
 184 001c 9FED147A 		vldr.32	s14, .L19
 185 0020 F4EEC77A 		vcmpe.f32	s15, s14
 186 0024 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 187 0028 1DDD     		ble	.L14
  54:App/Src/motor_control.c ****         fabsf(motor->speed_rpm) < STALL_SPEED_THRESH) {
 188              		.loc 1 54 20 view .LVU45
 189 002a B0F90630 		ldrsh	r3, [r0, #6]
 190 002e 07EE903A 		vmov	s15, r3	@ int
 191              		.loc 1 54 9 view .LVU46
 192 0032 F8EEE77A 		vcvt.f32.s32	s15, s15
 193 0036 F0EEE77A 		vabs.f32	s15, s15
  53:App/Src/motor_control.c ****         fabsf(motor->speed_rpm) < STALL_SPEED_THRESH) {
 194              		.loc 1 53 61 discriminator 1 view .LVU47
 195 003a 9FED0E7A 		vldr.32	s14, .L19+4
 196 003e F4EEC77A 		vcmpe.f32	s15, s14
 197 0042 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 198 0046 0ED5     		bpl	.L14
  55:App/Src/motor_control.c ****         
  56:App/Src/motor_control.c ****         motor->stall_cnt++;
 199              		.loc 1 56 9 is_stmt 1 view .LVU48
 200              		.loc 1 56 14 is_stmt 0 view .LVU49
 201 0048 D0F8E830 		ldr	r3, [r0, #232]
 202              		.loc 1 56 25 view .LVU50
 203 004c 0133     		adds	r3, r3, #1
 204 004e C0F8E830 		str	r3, [r0, #232]
  57:App/Src/motor_control.c ****         if (motor->stall_cnt > STALL_TIME_MS) {
 205              		.loc 1 57 9 is_stmt 1 view .LVU51
 206              		.loc 1 57 12 is_stmt 0 view .LVU52
 207 0052 40F2DC52 		movw	r2, #1500
 208 0056 9342     		cmp	r3, r2
 209 0058 08D9     		bls	.L12
  58:App/Src/motor_control.c ****             motor->is_stalled = 1;
 210              		.loc 1 58 13 is_stmt 1 view .LVU53
 211              		.loc 1 58 31 is_stmt 0 view .LVU54
 212 005a 0123     		movs	r3, #1
 213 005c 80F8EC30 		strb	r3, [r0, #236]
  59:App/Src/motor_control.c ****             motor->mode = MOTOR_MODE_STOP;
 214              		.loc 1 59 13 is_stmt 1 view .LVU55
 215              		.loc 1 59 25 is_stmt 0 view .LVU56
 216 0060 0323     		movs	r3, #3
 217 0062 4370     		strb	r3, [r0, #1]
 218 0064 7047     		bx	lr
 219              	.L14:
  60:App/Src/motor_control.c ****         }
  61:App/Src/motor_control.c ****     } else {
  62:App/Src/motor_control.c ****         motor->stall_cnt = 0;
 220              		.loc 1 62 9 is_stmt 1 view .LVU57
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 6


 221              		.loc 1 62 26 is_stmt 0 view .LVU58
 222 0066 0023     		movs	r3, #0
 223 0068 C0F8E830 		str	r3, [r0, #232]
 224              	.L12:
  63:App/Src/motor_control.c ****     }
  64:App/Src/motor_control.c **** }
 225              		.loc 1 64 1 view .LVU59
 226 006c 7047     		bx	lr
 227              	.L20:
 228 006e 00BF     		.align	2
 229              	.L19:
 230 0070 00803B46 		.word	1178304512
 231 0074 0000C842 		.word	1120403456
 232              		.cfi_endproc
 233              	.LFE137:
 235              		.section	.text.Calculate_Static_Friction_Compensation,"ax",%progbits
 236              		.align	1
 237              		.syntax unified
 238              		.thumb
 239              		.thumb_func
 241              	Calculate_Static_Friction_Compensation:
 242              	.LVL10:
 243              	.LFB143:
  65:App/Src/motor_control.c **** 
  66:App/Src/motor_control.c **** // 清除堵转状态 (修复未使用变量警告)
  67:App/Src/motor_control.c **** void Motor_Clear_Stall(uint8_t id) {
  68:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
  69:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
  70:App/Src/motor_control.c ****     gm6020_motors[id-1].is_stalled = 0;
  71:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
  72:App/Src/motor_control.c ****     gm6020_motors[id-1].mode = MOTOR_MODE_CURRENT_SPEED;
  73:App/Src/motor_control.c ****     gm6020_motors[id-1].target_val = 0;
  74:App/Src/motor_control.c **** }
  75:App/Src/motor_control.c **** 
  76:App/Src/motor_control.c **** void Motor_Init_All(void) {
  77:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
  78:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
  79:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
  80:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
  81:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
  82:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
  83:App/Src/motor_control.c ****         gm6020_motors[i].last_ecd = 0;
  84:App/Src/motor_control.c ****         gm6020_motors[i].feedforward = 0;
  85:App/Src/motor_control.c ****         gm6020_motors[i].horizon_ecd = 4096;
  86:App/Src/motor_control.c ****         
  87:App/Src/motor_control.c ****         // 上电机特殊处理
  88:App/Src/motor_control.c ****         if (i == 3) { // ID=4
  89:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
  90:App/Src/motor_control.c ****         } else {
  91:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
  92:App/Src/motor_control.c ****         }
  93:App/Src/motor_control.c ****         
  94:App/Src/motor_control.c ****         float speed_dead_zone = 1.0f;
  95:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
  96:App/Src/motor_control.c ****         
  97:App/Src/motor_control.c ****         // 优化PID参数（上电机）
  98:App/Src/motor_control.c ****         if (i == 3) { // ID=4
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 7


  99:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 100:App/Src/motor_control.c ****                      140.0f,   // Kp
 101:App/Src/motor_control.c ****                      5.0f,     // Ki
 102:App/Src/motor_control.c ****                      0.1f,     // Kd
 103:App/Src/motor_control.c ****                      GM6020_MAX_CURRENT,
 104:App/Src/motor_control.c ****                      5000.0f,  // 积分限幅
 105:App/Src/motor_control.c ****                      speed_dead_zone);
 106:App/Src/motor_control.c ****             
 107:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].angle_pid, 
 108:App/Src/motor_control.c ****                      7.0f,     // Kp
 109:App/Src/motor_control.c ****                      0.0f,     
 110:App/Src/motor_control.c ****                      0.0f,
 111:App/Src/motor_control.c ****                      100.0f,   // MaxOut: 限制最大速度
 112:App/Src/motor_control.c ****                      0.0f,
 113:App/Src/motor_control.c ****                      angle_dead_zone);
 114:App/Src/motor_control.c ****         } 
 115:App/Src/motor_control.c ****         // 下电机参数
 116:App/Src/motor_control.c ****         else {
 117:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 118:App/Src/motor_control.c ****                      60.0f,    // Kp
 119:App/Src/motor_control.c ****                      2.3f,     // Ki
 120:App/Src/motor_control.c ****                      0.02f,   // Kd
 121:App/Src/motor_control.c ****                      GM6020_MAX_CURRENT, 
 122:App/Src/motor_control.c ****                      5000.0f,  // 积分限幅
 123:App/Src/motor_control.c ****                      1.5f);    // 无死区
 124:App/Src/motor_control.c ****             
 125:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].angle_pid, 
 126:App/Src/motor_control.c ****                      5.0f,     // Kp
 127:App/Src/motor_control.c ****                      0.02f,     // Ki
 128:App/Src/motor_control.c ****                      0.002f,     // Kd
 129:App/Src/motor_control.c ****                      GM6020_MAX_SPEED, 
 130:App/Src/motor_control.c ****                      0.0f,     // MaxIOut
 131:App/Src/motor_control.c ****                      1.5f);    // 无死区
 132:App/Src/motor_control.c ****         }
 133:App/Src/motor_control.c ****         
 134:App/Src/motor_control.c ****         // 清除PID状态
 135:App/Src/motor_control.c ****         PID_Clear(&gm6020_motors[i].speed_pid);
 136:App/Src/motor_control.c ****         PID_Clear(&gm6020_motors[i].angle_pid);
 137:App/Src/motor_control.c ****     }
 138:App/Src/motor_control.c **** }
 139:App/Src/motor_control.c **** 
 140:App/Src/motor_control.c **** void Motor_Update_Feedback(uint8_t id, uint8_t *rx_data) {
 141:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 142:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 143:App/Src/motor_control.c ****     
 144:App/Src/motor_control.c ****     motor->ecd_raw = (rx_data[0] << 8) | rx_data[1];
 145:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 146:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 147:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 148:App/Src/motor_control.c ****     
 149:App/Src/motor_control.c ****     Motor_Process_Angle(motor);
 150:App/Src/motor_control.c **** }
 151:App/Src/motor_control.c **** 
 152:App/Src/motor_control.c **** void Motor_Set_Target(uint8_t id, Motor_Mode_e mode, float target) {
 153:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 154:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 155:App/Src/motor_control.c ****     
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 8


 156:App/Src/motor_control.c ****     // 启用堵转保护
 157:App/Src/motor_control.c ****     if (motor->is_stalled) {
 158:App/Src/motor_control.c ****         return;
 159:App/Src/motor_control.c ****     }
 160:App/Src/motor_control.c ****     
 161:App/Src/motor_control.c ****     Motor_Mode_e old_mode = motor->mode;
 162:App/Src/motor_control.c ****     motor->mode = mode;
 163:App/Src/motor_control.c ****     motor->target_val = target;
 164:App/Src/motor_control.c ****     
 165:App/Src/motor_control.c ****     // 切换模式时清除 PID 积分
 166:App/Src/motor_control.c ****     if (old_mode != mode) {
 167:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 168:App/Src/motor_control.c ****         PID_Clear(&motor->angle_pid);
 169:App/Src/motor_control.c ****     }
 170:App/Src/motor_control.c **** }
 171:App/Src/motor_control.c **** 
 172:App/Src/motor_control.c **** void Motor_Control_Loop(void) {
 173:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 174:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 175:App/Src/motor_control.c ****         float speed_target = 0;
 176:App/Src/motor_control.c ****         float current_target = 0;
 177:App/Src/motor_control.c ****         
 178:App/Src/motor_control.c ****         // 堵转保护
 179:App/Src/motor_control.c ****         if (motor->is_stalled || motor->mode == MOTOR_MODE_STOP) {
 180:App/Src/motor_control.c ****             motor->output_current = 0;
 181:App/Src/motor_control.c ****             motor_current_send_buf[i] = 0;
 182:App/Src/motor_control.c ****             continue;
 183:App/Src/motor_control.c ****         }
 184:App/Src/motor_control.c **** 
 185:App/Src/motor_control.c ****          if (fabsf(motor->target_val) < 1.0f && 
 186:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 187:App/Src/motor_control.c ****             Handle_Static_Motor(motor);
 188:App/Src/motor_control.c ****         } else {
 189:App/Src/motor_control.c ****             switch (motor->mode) {
 190:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_OPEN:
 191:App/Src/motor_control.c ****                     current_target = motor->target_val;
 192:App/Src/motor_control.c ****                     break;   
 193:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_SPEED:
 194:App/Src/motor_control.c ****                     current_target = PID_Calc(&motor->speed_pid, motor->target_val, motor->speed_rp
 195:App/Src/motor_control.c ****                     break;
 196:App/Src/motor_control.c ****                     
 197:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_POS_CASCADE:{
 198:App/Src/motor_control.c ****                     // ✅ 位置环死区处理
 199:App/Src/motor_control.c ****                     float angle_error = motor->target_val - motor->total_angle;
 200:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 201:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 202:App/Src/motor_control.c ****                         float speed_target = 0.0f;
 203:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 204:App/Src/motor_control.c ****                     } else {
 205:App/Src/motor_control.c ****                         float speed_target = PID_Calc(&motor->angle_pid, motor->target_val, motor->
 206:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 207:App/Src/motor_control.c ****                     }
 208:App/Src/motor_control.c ****                 }
 209:App/Src/motor_control.c ****                     break;
 210:App/Src/motor_control.c ****                     
 211:App/Src/motor_control.c ****                 default:
 212:App/Src/motor_control.c ****                     current_target = 0;
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 9


 213:App/Src/motor_control.c ****                     break;
 214:App/Src/motor_control.c ****             }
 215:App/Src/motor_control.c ****         }
 216:App/Src/motor_control.c **** 
 217:App/Src/motor_control.c ****         if (motor->id != 4 && (motor->mode == MOTOR_MODE_CURRENT_SPEED || 
 218:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 219:App/Src/motor_control.c ****             
 220:App/Src/motor_control.c ****             motor->feedforward = Motor_Calc_Gravity_FF(motor);
 221:App/Src/motor_control.c ****             current_target += motor->feedforward;
 222:App/Src/motor_control.c ****         }
 223:App/Src/motor_control.c ****         if (i == 3) { // 上电机
 224:App/Src/motor_control.c ****             current_target += Calculate_Static_Friction_Compensation(motor);
 225:App/Src/motor_control.c ****         }
 226:App/Src/motor_control.c **** 
 227:App/Src/motor_control.c ****         // 限制电流范围
 228:App/Src/motor_control.c ****         motor->output_current = limit_current(current_target);
 229:App/Src/motor_control.c ****         
 230:App/Src/motor_control.c ****         // 执行堵转检测
 231:App/Src/motor_control.c ****         Motor_Check_Stall(motor);
 232:App/Src/motor_control.c ****         
 233:App/Src/motor_control.c ****         // 填入发送缓冲区
 234:App/Src/motor_control.c ****         motor_current_send_buf[i] = motor->output_current;
 235:App/Src/motor_control.c ****     }
 236:App/Src/motor_control.c ****     
 237:App/Src/motor_control.c ****     // ✅ 修复函数名拼写错误
 238:App/Src/motor_control.c ****     BSP_CAN_Send_Current_Cmd(); // 注意是 'Sned' 不是 'Send'
 239:App/Src/motor_control.c **** }
 240:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor) {
 244              		.loc 1 240 76 is_stmt 1 view -0
 245              		.cfi_startproc
 246              		@ args = 0, pretend = 0, frame = 0
 247              		@ frame_needed = 0, uses_anonymous_args = 0
 248              		@ link register save eliminated.
 241:App/Src/motor_control.c ****     // 静摩擦补偿：当速度接近0时，添加小的补偿电流
 242:App/Src/motor_control.c ****     if (fabsf(motor->speed_rpm) < 0.5f) {
 249              		.loc 1 242 5 view .LVU61
 250              		.loc 1 242 20 is_stmt 0 view .LVU62
 251 0000 B0F90630 		ldrsh	r3, [r0, #6]
 252 0004 07EE903A 		vmov	s15, r3	@ int
 253              		.loc 1 242 9 view .LVU63
 254 0008 F8EEE77A 		vcvt.f32.s32	s15, s15
 255 000c F0EEE77A 		vabs.f32	s15, s15
 256              		.loc 1 242 8 view .LVU64
 257 0010 B6EE007A 		vmov.f32	s14, #5.0e-1
 258 0014 F4EEC77A 		vcmpe.f32	s15, s14
 259 0018 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 260 001c 02D4     		bmi	.L32
 243:App/Src/motor_control.c ****         // 根据角度位置计算补偿（上电机需要）
 244:App/Src/motor_control.c ****         float static_friction = 150.0f; // 150mA静摩擦补偿
 245:App/Src/motor_control.c ****         return (motor->total_angle > 0) ? static_friction : -static_friction;
 246:App/Src/motor_control.c ****     }
 247:App/Src/motor_control.c ****     return 0.0f;
 261              		.loc 1 247 12 view .LVU65
 262 001e 9FED080A 		vldr.32	s0, .L33
 248:App/Src/motor_control.c **** }
 263              		.loc 1 248 1 view .LVU66
 264 0022 7047     		bx	lr
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 10


 265              	.L32:
 266              	.LBB2:
 244:App/Src/motor_control.c ****         return (motor->total_angle > 0) ? static_friction : -static_friction;
 267              		.loc 1 244 9 is_stmt 1 view .LVU67
 268              	.LVL11:
 245:App/Src/motor_control.c ****     }
 269              		.loc 1 245 9 view .LVU68
 245:App/Src/motor_control.c ****     }
 270              		.loc 1 245 22 is_stmt 0 view .LVU69
 271 0024 D0ED047A 		vldr.32	s15, [r0, #16]
 245:App/Src/motor_control.c ****     }
 272              		.loc 1 245 59 view .LVU70
 273 0028 F5EEC07A 		vcmpe.f32	s15, #0
 274 002c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 275 0030 02DD     		ble	.L31
 245:App/Src/motor_control.c ****     }
 276              		.loc 1 245 59 discriminator 1 view .LVU71
 277 0032 9FED040A 		vldr.32	s0, .L33+4
 278 0036 7047     		bx	lr
 279              	.L31:
 245:App/Src/motor_control.c ****     }
 280              		.loc 1 245 59 discriminator 2 view .LVU72
 281 0038 9FED030A 		vldr.32	s0, .L33+8
 245:App/Src/motor_control.c ****     }
 282              		.loc 1 245 59 view .LVU73
 283 003c 7047     		bx	lr
 284              	.L34:
 285 003e 00BF     		.align	2
 286              	.L33:
 287 0040 00000000 		.word	0
 288 0044 00001643 		.word	1125515264
 289 0048 000016C3 		.word	-1021968384
 290              	.LBE2:
 291              		.cfi_endproc
 292              	.LFE143:
 294              		.section	.text.Motor_Calc_Gravity_FF,"ax",%progbits
 295              		.align	1
 296              		.syntax unified
 297              		.thumb
 298              		.thumb_func
 300              	Motor_Calc_Gravity_FF:
 301              	.LVL12:
 302              	.LFB135:
  25:App/Src/motor_control.c ****     if (motor->id == 4) {
 303              		.loc 1 25 61 is_stmt 1 view -0
 304              		.cfi_startproc
 305              		@ args = 0, pretend = 0, frame = 0
 306              		@ frame_needed = 0, uses_anonymous_args = 0
  25:App/Src/motor_control.c ****     if (motor->id == 4) {
 307              		.loc 1 25 61 is_stmt 0 view .LVU75
 308 0000 08B5     		push	{r3, lr}
 309              	.LCFI0:
 310              		.cfi_def_cfa_offset 8
 311              		.cfi_offset 3, -8
 312              		.cfi_offset 14, -4
 313 0002 2DED028B 		vpush.64	{d8}
 314              	.LCFI1:
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 11


 315              		.cfi_def_cfa_offset 16
 316              		.cfi_offset 80, -16
 317              		.cfi_offset 81, -12
  26:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
 318              		.loc 1 26 5 is_stmt 1 view .LVU76
  26:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
 319              		.loc 1 26 14 is_stmt 0 view .LVU77
 320 0006 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
  26:App/Src/motor_control.c ****         const float PITCH_GRAVITY_GAIN = 800.0f;
 321              		.loc 1 26 8 view .LVU78
 322 0008 042B     		cmp	r3, #4
 323 000a 1ED0     		beq	.L41
  30:App/Src/motor_control.c ****     int32_t ecd_diff = motor->ecd_raw - motor->horizon_ecd;
 324              		.loc 1 30 6 is_stmt 1 view .LVU79
  31:App/Src/motor_control.c ****     
 325              		.loc 1 31 5 view .LVU80
  31:App/Src/motor_control.c ****     
 326              		.loc 1 31 29 is_stmt 0 view .LVU81
 327 000c 4388     		ldrh	r3, [r0, #2]
  31:App/Src/motor_control.c ****     
 328              		.loc 1 31 46 view .LVU82
 329 000e B0F8EE20 		ldrh	r2, [r0, #238]
  31:App/Src/motor_control.c ****     
 330              		.loc 1 31 13 view .LVU83
 331 0012 9B1A     		subs	r3, r3, r2
 332              	.LVL13:
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 333              		.loc 1 33 5 is_stmt 1 view .LVU84
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 334              		.loc 1 33 8 is_stmt 0 view .LVU85
 335 0014 B3F5805F 		cmp	r3, #4096
 336 0018 2DDD     		ble	.L38
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 337              		.loc 1 33 27 is_stmt 1 discriminator 1 view .LVU86
  33:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 338              		.loc 1 33 36 is_stmt 0 discriminator 1 view .LVU87
 339 001a A3F50053 		sub	r3, r3, #8192
 340              	.LVL14:
  34:App/Src/motor_control.c **** 
 341              		.loc 1 34 5 is_stmt 1 view .LVU88
 342              	.L39:
  36:App/Src/motor_control.c ****     return (int16_t)(motor->gravity_gain * cosf(angle_rad));
 343              		.loc 1 36 5 view .LVU89
  36:App/Src/motor_control.c ****     return (int16_t)(motor->gravity_gain * cosf(angle_rad));
 344              		.loc 1 36 23 is_stmt 0 view .LVU90
 345 001e 07EE903A 		vmov	s15, r3	@ int
 346 0022 F8EEE77A 		vcvt.f32.s32	s15, s15
 347              	.LVL15:
  37:App/Src/motor_control.c **** }
 348              		.loc 1 37 5 is_stmt 1 view .LVU91
  37:App/Src/motor_control.c **** }
 349              		.loc 1 37 27 is_stmt 0 view .LVU92
 350 0026 90ED3C8A 		vldr.32	s16, [r0, #240]
  37:App/Src/motor_control.c **** }
 351              		.loc 1 37 44 view .LVU93
 352 002a 9FED160A 		vldr.32	s0, .L42
 353 002e 27EE800A 		vmul.f32	s0, s15, s0
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 12


 354              	.LVL16:
  37:App/Src/motor_control.c **** }
 355              		.loc 1 37 44 view .LVU94
 356 0032 FFF7FEFF 		bl	cosf
 357              	.LVL17:
  37:App/Src/motor_control.c **** }
 358              		.loc 1 37 42 discriminator 1 view .LVU95
 359 0036 28EE008A 		vmul.f32	s16, s16, s0
  37:App/Src/motor_control.c **** }
 360              		.loc 1 37 12 discriminator 1 view .LVU96
 361 003a BDEEC88A 		vcvt.s32.f32	s16, s16
 362 003e 18EE103A 		vmov	r3, s16	@ int
 363 0042 18B2     		sxth	r0, r3
 364              	.LVL18:
 365              	.L37:
  38:App/Src/motor_control.c **** 
 366              		.loc 1 38 1 view .LVU97
 367 0044 BDEC028B 		vldm	sp!, {d8}
 368              	.LCFI2:
 369              		.cfi_remember_state
 370              		.cfi_restore 80
 371              		.cfi_restore 81
 372              		.cfi_def_cfa_offset 8
 373 0048 08BD     		pop	{r3, pc}
 374              	.LVL19:
 375              	.L41:
 376              	.LCFI3:
 377              		.cfi_restore_state
 378              	.LBB3:
  27:App/Src/motor_control.c ****         return (int16_t)(PITCH_GRAVITY_GAIN * sinf(motor->total_angle * PI / 180.0f));
 379              		.loc 1 27 9 is_stmt 1 view .LVU98
  28:App/Src/motor_control.c ****     }
 380              		.loc 1 28 9 view .LVU99
  28:App/Src/motor_control.c ****     }
 381              		.loc 1 28 57 is_stmt 0 view .LVU100
 382 004a D0ED047A 		vldr.32	s15, [r0, #16]
  28:App/Src/motor_control.c ****     }
 383              		.loc 1 28 71 view .LVU101
 384 004e 9FED0E7A 		vldr.32	s14, .L42+4
 385 0052 67EE877A 		vmul.f32	s15, s15, s14
  28:App/Src/motor_control.c ****     }
 386              		.loc 1 28 47 view .LVU102
 387 0056 9FED0D0A 		vldr.32	s0, .L42+8
 388 005a 87EE800A 		vdiv.f32	s0, s15, s0
 389 005e FFF7FEFF 		bl	sinf
 390              	.LVL20:
  28:App/Src/motor_control.c ****     }
 391              		.loc 1 28 45 discriminator 1 view .LVU103
 392 0062 DFED0B7A 		vldr.32	s15, .L42+12
 393 0066 20EE270A 		vmul.f32	s0, s0, s15
  28:App/Src/motor_control.c ****     }
 394              		.loc 1 28 16 discriminator 1 view .LVU104
 395 006a BDEEC00A 		vcvt.s32.f32	s0, s0
 396 006e 10EE103A 		vmov	r3, s0	@ int
 397 0072 18B2     		sxth	r0, r3
  28:App/Src/motor_control.c ****     }
 398              		.loc 1 28 16 view .LVU105
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 13


 399 0074 E6E7     		b	.L37
 400              	.LVL21:
 401              	.L38:
  28:App/Src/motor_control.c ****     }
 402              		.loc 1 28 16 view .LVU106
 403              	.LBE3:
  34:App/Src/motor_control.c **** 
 404              		.loc 1 34 5 is_stmt 1 view .LVU107
  34:App/Src/motor_control.c **** 
 405              		.loc 1 34 8 is_stmt 0 view .LVU108
 406 0076 13F5805F 		cmn	r3, #4096
 407 007a D0DA     		bge	.L39
  34:App/Src/motor_control.c **** 
 408              		.loc 1 34 27 is_stmt 1 discriminator 1 view .LVU109
  34:App/Src/motor_control.c **** 
 409              		.loc 1 34 36 is_stmt 0 discriminator 1 view .LVU110
 410 007c 03F50053 		add	r3, r3, #8192
 411              	.LVL22:
  34:App/Src/motor_control.c **** 
 412              		.loc 1 34 36 discriminator 1 view .LVU111
 413 0080 CDE7     		b	.L39
 414              	.L43:
 415 0082 00BF     		.align	2
 416              	.L42:
 417 0084 DB0F493A 		.word	977866715
 418 0088 DB0F4940 		.word	1078530011
 419 008c 00003443 		.word	1127481344
 420 0090 00004844 		.word	1145569280
 421              		.cfi_endproc
 422              	.LFE135:
 424              		.section	.text.Motor_Clear_Stall,"ax",%progbits
 425              		.align	1
 426              		.global	Motor_Clear_Stall
 427              		.syntax unified
 428              		.thumb
 429              		.thumb_func
 431              	Motor_Clear_Stall:
 432              	.LVL23:
 433              	.LFB138:
  67:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 434              		.loc 1 67 36 is_stmt 1 view -0
 435              		.cfi_startproc
 436              		@ args = 0, pretend = 0, frame = 0
 437              		@ frame_needed = 0, uses_anonymous_args = 0
 438              		@ link register save eliminated.
  68:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
 439              		.loc 1 68 5 view .LVU113
  68:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
 440              		.loc 1 68 16 is_stmt 0 view .LVU114
 441 0000 431E     		subs	r3, r0, #1
 442 0002 DBB2     		uxtb	r3, r3
  68:App/Src/motor_control.c ****     // 直接使用数组，不需要中间变量
 443              		.loc 1 68 8 view .LVU115
 444 0004 032B     		cmp	r3, #3
 445 0006 0FD8     		bhi	.L44
  70:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
 446              		.loc 1 70 5 is_stmt 1 view .LVU116
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 14


  70:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
 447              		.loc 1 70 21 is_stmt 0 view .LVU117
 448 0008 0138     		subs	r0, r0, #1
 449              	.LVL24:
  70:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
 450              		.loc 1 70 36 view .LVU118
 451 000a 084A     		ldr	r2, .L46
 452 000c C0EB4013 		rsb	r3, r0, r0, lsl #5
 453 0010 02EBC303 		add	r3, r2, r3, lsl #3
 454 0014 0021     		movs	r1, #0
 455 0016 83F8EC10 		strb	r1, [r3, #236]
  71:App/Src/motor_control.c ****     gm6020_motors[id-1].mode = MOTOR_MODE_CURRENT_SPEED;
 456              		.loc 1 71 5 is_stmt 1 view .LVU119
  71:App/Src/motor_control.c ****     gm6020_motors[id-1].mode = MOTOR_MODE_CURRENT_SPEED;
 457              		.loc 1 71 35 is_stmt 0 view .LVU120
 458 001a C3F8E810 		str	r1, [r3, #232]
  72:App/Src/motor_control.c ****     gm6020_motors[id-1].target_val = 0;
 459              		.loc 1 72 5 is_stmt 1 view .LVU121
  72:App/Src/motor_control.c ****     gm6020_motors[id-1].target_val = 0;
 460              		.loc 1 72 30 is_stmt 0 view .LVU122
 461 001e 0121     		movs	r1, #1
 462 0020 5970     		strb	r1, [r3, #1]
  73:App/Src/motor_control.c **** }
 463              		.loc 1 73 5 is_stmt 1 view .LVU123
  73:App/Src/motor_control.c **** }
 464              		.loc 1 73 36 is_stmt 0 view .LVU124
 465 0022 1A46     		mov	r2, r3
 466 0024 0023     		movs	r3, #0
 467 0026 5361     		str	r3, [r2, #20]	@ float
 468              	.LVL25:
 469              	.L44:
  74:App/Src/motor_control.c **** 
 470              		.loc 1 74 1 view .LVU125
 471 0028 7047     		bx	lr
 472              	.L47:
 473 002a 00BF     		.align	2
 474              	.L46:
 475 002c 00000000 		.word	gm6020_motors
 476              		.cfi_endproc
 477              	.LFE138:
 479              		.section	.text.Motor_Init_All,"ax",%progbits
 480              		.align	1
 481              		.global	Motor_Init_All
 482              		.syntax unified
 483              		.thumb
 484              		.thumb_func
 486              	Motor_Init_All:
 487              	.LFB139:
  76:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 488              		.loc 1 76 27 is_stmt 1 view -0
 489              		.cfi_startproc
 490              		@ args = 0, pretend = 0, frame = 0
 491              		@ frame_needed = 0, uses_anonymous_args = 0
 492 0000 70B5     		push	{r4, r5, r6, lr}
 493              	.LCFI4:
 494              		.cfi_def_cfa_offset 16
 495              		.cfi_offset 4, -16
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 15


 496              		.cfi_offset 5, -12
 497              		.cfi_offset 6, -8
 498              		.cfi_offset 14, -4
 499 0002 2DED028B 		vpush.64	{d8}
 500              	.LCFI5:
 501              		.cfi_def_cfa_offset 24
 502              		.cfi_offset 80, -24
 503              		.cfi_offset 81, -20
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 504              		.loc 1 77 5 view .LVU127
 505              	.LBB4:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 506              		.loc 1 77 10 view .LVU128
 507              	.LVL26:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 508              		.loc 1 77 14 is_stmt 0 view .LVU129
 509 0006 0024     		movs	r4, #0
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 510              		.loc 1 77 5 view .LVU130
 511 0008 3EE0     		b	.L49
 512              	.LVL27:
 513              	.L55:
 514              	.LBB5:
  89:App/Src/motor_control.c ****         } else {
 515              		.loc 1 89 13 is_stmt 1 view .LVU131
  89:App/Src/motor_control.c ****         } else {
 516              		.loc 1 89 43 is_stmt 0 view .LVU132
 517 000a 0646     		mov	r6, r0
 518 000c 6501     		lsls	r5, r4, #5
 519 000e C4EB4412 		rsb	r2, r4, r4, lsl #5
 520 0012 D300     		lsls	r3, r2, #3
 521 0014 0344     		add	r3, r3, r0
 522 0016 9FED438A 		vldr.32	s16, .L56
 523 001a 83ED3C8A 		vstr.32	s16, [r3, #240]
  94:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
 524              		.loc 1 94 9 is_stmt 1 view .LVU133
 525              	.LVL28:
  95:App/Src/motor_control.c ****         
 526              		.loc 1 95 9 view .LVU134
  98:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 527              		.loc 1 98 9 view .LVU135
  99:App/Src/motor_control.c ****                      140.0f,   // Kp
 528              		.loc 1 99 13 view .LVU136
 529 001e D000     		lsls	r0, r2, #3
 530 0020 1830     		adds	r0, r0, #24
 531 0022 F7EE002A 		vmov.f32	s5, #1.0e+0
 532 0026 9FED402A 		vldr.32	s4, .L56+4
 533 002a DFED401A 		vldr.32	s3, .L56+8
 534 002e 9FED401A 		vldr.32	s2, .L56+12
 535 0032 F1EE040A 		vmov.f32	s1, #5.0e+0
 536 0036 9FED3F0A 		vldr.32	s0, .L56+16
 537 003a 3044     		add	r0, r0, r6
 538 003c FFF7FEFF 		bl	PID_Init
 539              	.LVL29:
 107:App/Src/motor_control.c ****                      7.0f,     // Kp
 540              		.loc 1 107 13 view .LVU137
 541 0040 2B1B     		subs	r3, r5, r4
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 16


 542 0042 D800     		lsls	r0, r3, #3
 543 0044 5830     		adds	r0, r0, #88
 544 0046 3044     		add	r0, r0, r6
 545 0048 F6EE002A 		vmov.f32	s5, #5.0e-1
 546 004c B0EE482A 		vmov.f32	s4, s16
 547 0050 DFED391A 		vldr.32	s3, .L56+20
 548 0054 B0EE481A 		vmov.f32	s2, s16
 549 0058 F0EE480A 		vmov.f32	s1, s16
 550 005c B1EE0C0A 		vmov.f32	s0, #7.0e+0
 551 0060 0430     		adds	r0, r0, #4
 552 0062 FFF7FEFF 		bl	PID_Init
 553              	.LVL30:
 554              	.L51:
 135:App/Src/motor_control.c ****         PID_Clear(&gm6020_motors[i].angle_pid);
 555              		.loc 1 135 9 view .LVU138
 556 0066 6501     		lsls	r5, r4, #5
 557 0068 C4EB4413 		rsb	r3, r4, r4, lsl #5
 558 006c D800     		lsls	r0, r3, #3
 559 006e 1830     		adds	r0, r0, #24
 560 0070 324E     		ldr	r6, .L56+24
 561 0072 3044     		add	r0, r0, r6
 562 0074 FFF7FEFF 		bl	PID_Clear
 563              	.LVL31:
 136:App/Src/motor_control.c ****     }
 564              		.loc 1 136 9 view .LVU139
 565 0078 2B1B     		subs	r3, r5, r4
 566 007a D800     		lsls	r0, r3, #3
 567 007c 5830     		adds	r0, r0, #88
 568 007e 3044     		add	r0, r0, r6
 569 0080 0430     		adds	r0, r0, #4
 570 0082 FFF7FEFF 		bl	PID_Clear
 571              	.LVL32:
 572              	.LBE5:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 573              		.loc 1 77 29 discriminator 2 view .LVU140
 574 0086 0134     		adds	r4, r4, #1
 575              	.LVL33:
 576              	.L49:
  77:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 577              		.loc 1 77 23 discriminator 1 view .LVU141
 578 0088 032C     		cmp	r4, #3
 579 008a 48DC     		bgt	.L54
 580              	.LBB6:
  78:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 581              		.loc 1 78 9 view .LVU142
  78:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 582              		.loc 1 78 33 is_stmt 0 view .LVU143
 583 008c 611C     		adds	r1, r4, #1
  78:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 584              		.loc 1 78 29 view .LVU144
 585 008e 2B48     		ldr	r0, .L56+24
 586 0090 C4EB4413 		rsb	r3, r4, r4, lsl #5
 587 0094 DA00     		lsls	r2, r3, #3
 588 0096 8318     		adds	r3, r0, r2
 589 0098 8154     		strb	r1, [r0, r2]
  79:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
 590              		.loc 1 79 9 is_stmt 1 view .LVU145
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 17


  79:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
 591              		.loc 1 79 31 is_stmt 0 view .LVU146
 592 009a 0122     		movs	r2, #1
 593 009c 5A70     		strb	r2, [r3, #1]
  80:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
 594              		.loc 1 80 9 is_stmt 1 view .LVU147
  80:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
 595              		.loc 1 80 37 is_stmt 0 view .LVU148
 596 009e 0022     		movs	r2, #0
 597 00a0 5A61     		str	r2, [r3, #20]	@ float
  81:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
 598              		.loc 1 81 9 is_stmt 1 view .LVU149
  81:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
 599              		.loc 1 81 36 is_stmt 0 view .LVU150
 600 00a2 0022     		movs	r2, #0
 601 00a4 DA60     		str	r2, [r3, #12]
  82:App/Src/motor_control.c ****         gm6020_motors[i].last_ecd = 0;
 602              		.loc 1 82 9 is_stmt 1 view .LVU151
  82:App/Src/motor_control.c ****         gm6020_motors[i].last_ecd = 0;
 603              		.loc 1 82 37 is_stmt 0 view .LVU152
 604 00a6 83F8EC20 		strb	r2, [r3, #236]
  83:App/Src/motor_control.c ****         gm6020_motors[i].feedforward = 0;
 605              		.loc 1 83 9 is_stmt 1 view .LVU153
  83:App/Src/motor_control.c ****         gm6020_motors[i].feedforward = 0;
 606              		.loc 1 83 35 is_stmt 0 view .LVU154
 607 00aa 9A80     		strh	r2, [r3, #4]	@ movhi
  84:App/Src/motor_control.c ****         gm6020_motors[i].horizon_ecd = 4096;
 608              		.loc 1 84 9 is_stmt 1 view .LVU155
  84:App/Src/motor_control.c ****         gm6020_motors[i].horizon_ecd = 4096;
 609              		.loc 1 84 38 is_stmt 0 view .LVU156
 610 00ac A3F8F420 		strh	r2, [r3, #244]	@ movhi
  85:App/Src/motor_control.c ****         
 611              		.loc 1 85 9 is_stmt 1 view .LVU157
  85:App/Src/motor_control.c ****         
 612              		.loc 1 85 38 is_stmt 0 view .LVU158
 613 00b0 4FF48052 		mov	r2, #4096
 614 00b4 A3F8EE20 		strh	r2, [r3, #238]	@ movhi
  88:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
 615              		.loc 1 88 9 is_stmt 1 view .LVU159
  88:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f;
 616              		.loc 1 88 12 is_stmt 0 view .LVU160
 617 00b8 032C     		cmp	r4, #3
 618 00ba A6D0     		beq	.L55
  91:App/Src/motor_control.c ****         }
 619              		.loc 1 91 13 is_stmt 1 view .LVU161
  91:App/Src/motor_control.c ****         }
 620              		.loc 1 91 43 is_stmt 0 view .LVU162
 621 00bc 1F4E     		ldr	r6, .L56+24
 622 00be 6501     		lsls	r5, r4, #5
 623 00c0 C4EB4412 		rsb	r2, r4, r4, lsl #5
 624 00c4 D300     		lsls	r3, r2, #3
 625 00c6 3344     		add	r3, r3, r6
 626 00c8 DFED168A 		vldr.32	s17, .L56
 627 00cc C3ED3C8A 		vstr.32	s17, [r3, #240]
  94:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
 628              		.loc 1 94 9 is_stmt 1 view .LVU163
 629              	.LVL34:
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 18


  95:App/Src/motor_control.c ****         
 630              		.loc 1 95 9 view .LVU164
  98:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 631              		.loc 1 98 9 view .LVU165
 117:App/Src/motor_control.c ****                      60.0f,    // Kp
 632              		.loc 1 117 13 view .LVU166
 633 00d0 9FED1B8A 		vldr.32	s16, .L56+28
 634 00d4 D000     		lsls	r0, r2, #3
 635 00d6 1830     		adds	r0, r0, #24
 636 00d8 F7EE082A 		vmov.f32	s5, #1.5e+0
 637 00dc 9FED122A 		vldr.32	s4, .L56+4
 638 00e0 DFED121A 		vldr.32	s3, .L56+8
 639 00e4 B0EE481A 		vmov.f32	s2, s16
 640 00e8 DFED160A 		vldr.32	s1, .L56+32
 641 00ec 9FED160A 		vldr.32	s0, .L56+36
 642 00f0 3044     		add	r0, r0, r6
 643 00f2 FFF7FEFF 		bl	PID_Init
 644              	.LVL35:
 125:App/Src/motor_control.c ****                      5.0f,     // Kp
 645              		.loc 1 125 13 view .LVU167
 646 00f6 2B1B     		subs	r3, r5, r4
 647 00f8 D800     		lsls	r0, r3, #3
 648 00fa 5830     		adds	r0, r0, #88
 649 00fc 3044     		add	r0, r0, r6
 650 00fe F7EE082A 		vmov.f32	s5, #1.5e+0
 651 0102 B0EE682A 		vmov.f32	s4, s17
 652 0106 DFED111A 		vldr.32	s3, .L56+40
 653 010a 9FED111A 		vldr.32	s2, .L56+44
 654 010e F0EE480A 		vmov.f32	s1, s16
 655 0112 B1EE040A 		vmov.f32	s0, #5.0e+0
 656 0116 0430     		adds	r0, r0, #4
 657 0118 FFF7FEFF 		bl	PID_Init
 658              	.LVL36:
 659 011c A3E7     		b	.L51
 660              	.LVL37:
 661              	.L54:
 125:App/Src/motor_control.c ****                      5.0f,     // Kp
 662              		.loc 1 125 13 is_stmt 0 view .LVU168
 663              	.LBE6:
 664              	.LBE4:
 138:App/Src/motor_control.c **** 
 665              		.loc 1 138 1 view .LVU169
 666 011e BDEC028B 		vldm	sp!, {d8}
 667              	.LCFI6:
 668              		.cfi_restore 80
 669              		.cfi_restore 81
 670              		.cfi_def_cfa_offset 16
 671 0122 70BD     		pop	{r4, r5, r6, pc}
 672              	.LVL38:
 673              	.L57:
 138:App/Src/motor_control.c **** 
 674              		.loc 1 138 1 view .LVU170
 675              		.align	2
 676              	.L56:
 677 0124 00000000 		.word	0
 678 0128 00409C45 		.word	1167867904
 679 012c 00008046 		.word	1182793728
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 19


 680 0130 CDCCCC3D 		.word	1036831949
 681 0134 00000C43 		.word	1124859904
 682 0138 0000C842 		.word	1120403456
 683 013c 00000000 		.word	gm6020_motors
 684 0140 0AD7A33C 		.word	1017370378
 685 0144 33331340 		.word	1075000115
 686 0148 00007042 		.word	1114636288
 687 014c 0000A043 		.word	1134559232
 688 0150 6F12033B 		.word	990057071
 689              		.cfi_endproc
 690              	.LFE139:
 692              		.section	.text.Motor_Update_Feedback,"ax",%progbits
 693              		.align	1
 694              		.global	Motor_Update_Feedback
 695              		.syntax unified
 696              		.thumb
 697              		.thumb_func
 699              	Motor_Update_Feedback:
 700              	.LVL39:
 701              	.LFB140:
 140:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 702              		.loc 1 140 58 is_stmt 1 view -0
 703              		.cfi_startproc
 704              		@ args = 0, pretend = 0, frame = 0
 705              		@ frame_needed = 0, uses_anonymous_args = 0
 140:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 706              		.loc 1 140 58 is_stmt 0 view .LVU172
 707 0000 08B5     		push	{r3, lr}
 708              	.LCFI7:
 709              		.cfi_def_cfa_offset 8
 710              		.cfi_offset 3, -8
 711              		.cfi_offset 14, -4
 141:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 712              		.loc 1 141 5 is_stmt 1 view .LVU173
 141:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 713              		.loc 1 141 16 is_stmt 0 view .LVU174
 714 0002 431E     		subs	r3, r0, #1
 715 0004 DBB2     		uxtb	r3, r3
 141:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 716              		.loc 1 141 8 view .LVU175
 717 0006 032B     		cmp	r3, #3
 718 0008 00D9     		bls	.L61
 719              	.LVL40:
 720              	.L58:
 150:App/Src/motor_control.c **** 
 721              		.loc 1 150 1 view .LVU176
 722 000a 08BD     		pop	{r3, pc}
 723              	.LVL41:
 724              	.L61:
 142:App/Src/motor_control.c ****     
 725              		.loc 1 142 5 is_stmt 1 view .LVU177
 142:App/Src/motor_control.c ****     
 726              		.loc 1 142 47 is_stmt 0 view .LVU178
 727 000c 431E     		subs	r3, r0, #1
 142:App/Src/motor_control.c ****     
 728              		.loc 1 142 21 view .LVU179
 729 000e C3EB4310 		rsb	r0, r3, r3, lsl #5
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 20


 730              	.LVL42:
 142:App/Src/motor_control.c ****     
 731              		.loc 1 142 21 view .LVU180
 732 0012 104A     		ldr	r2, .L62
 733 0014 02EBC000 		add	r0, r2, r0, lsl #3
 734              	.LVL43:
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 735              		.loc 1 144 5 is_stmt 1 view .LVU181
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 736              		.loc 1 144 30 is_stmt 0 view .LVU182
 737 0018 91F800E0 		ldrb	lr, [r1]	@ zero_extendqisi2
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 738              		.loc 1 144 49 view .LVU183
 739 001c 91F801C0 		ldrb	ip, [r1, #1]	@ zero_extendqisi2
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 740              		.loc 1 144 40 view .LVU184
 741 0020 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 144:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 742              		.loc 1 144 20 view .LVU185
 743 0024 A0F802C0 		strh	ip, [r0, #2]	@ movhi
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 744              		.loc 1 145 5 is_stmt 1 view .LVU186
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 745              		.loc 1 145 42 is_stmt 0 view .LVU187
 746 0028 91F802E0 		ldrb	lr, [r1, #2]	@ zero_extendqisi2
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 747              		.loc 1 145 61 view .LVU188
 748 002c 91F803C0 		ldrb	ip, [r1, #3]	@ zero_extendqisi2
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 749              		.loc 1 145 24 view .LVU189
 750 0030 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 145:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 751              		.loc 1 145 22 view .LVU190
 752 0034 A0F806C0 		strh	ip, [r0, #6]	@ movhi
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 753              		.loc 1 146 5 is_stmt 1 view .LVU191
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 754              		.loc 1 146 44 is_stmt 0 view .LVU192
 755 0038 91F804E0 		ldrb	lr, [r1, #4]	@ zero_extendqisi2
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 756              		.loc 1 146 63 view .LVU193
 757 003c 91F805C0 		ldrb	ip, [r1, #5]	@ zero_extendqisi2
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 758              		.loc 1 146 26 view .LVU194
 759 0040 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 146:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 760              		.loc 1 146 24 view .LVU195
 761 0044 A0F808C0 		strh	ip, [r0, #8]	@ movhi
 147:App/Src/motor_control.c ****     
 762              		.loc 1 147 5 is_stmt 1 view .LVU196
 147:App/Src/motor_control.c ****     
 763              		.loc 1 147 17 is_stmt 0 view .LVU197
 764 0048 8979     		ldrb	r1, [r1, #6]	@ zero_extendqisi2
 765              	.LVL44:
 147:App/Src/motor_control.c ****     
 766              		.loc 1 147 17 view .LVU198
 767 004a 8172     		strb	r1, [r0, #10]
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 21


 149:App/Src/motor_control.c **** }
 768              		.loc 1 149 5 is_stmt 1 view .LVU199
 769 004c FFF7FEFF 		bl	Motor_Process_Angle
 770              	.LVL45:
 149:App/Src/motor_control.c **** }
 771              		.loc 1 149 5 is_stmt 0 view .LVU200
 772 0050 DBE7     		b	.L58
 773              	.L63:
 774 0052 00BF     		.align	2
 775              	.L62:
 776 0054 00000000 		.word	gm6020_motors
 777              		.cfi_endproc
 778              	.LFE140:
 780              		.section	.text.Motor_Set_Target,"ax",%progbits
 781              		.align	1
 782              		.global	Motor_Set_Target
 783              		.syntax unified
 784              		.thumb
 785              		.thumb_func
 787              	Motor_Set_Target:
 788              	.LVL46:
 789              	.LFB141:
 152:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 790              		.loc 1 152 68 is_stmt 1 view -0
 791              		.cfi_startproc
 792              		@ args = 0, pretend = 0, frame = 0
 793              		@ frame_needed = 0, uses_anonymous_args = 0
 153:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 794              		.loc 1 153 5 view .LVU202
 153:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 795              		.loc 1 153 16 is_stmt 0 view .LVU203
 796 0000 431E     		subs	r3, r0, #1
 797 0002 DBB2     		uxtb	r3, r3
 153:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 798              		.loc 1 153 8 view .LVU204
 799 0004 032B     		cmp	r3, #3
 800 0006 24D8     		bhi	.L67
 152:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 801              		.loc 1 152 68 view .LVU205
 802 0008 70B5     		push	{r4, r5, r6, lr}
 803              	.LCFI8:
 804              		.cfi_def_cfa_offset 16
 805              		.cfi_offset 4, -16
 806              		.cfi_offset 5, -12
 807              		.cfi_offset 6, -8
 808              		.cfi_offset 14, -4
 154:App/Src/motor_control.c ****     
 809              		.loc 1 154 5 is_stmt 1 view .LVU206
 154:App/Src/motor_control.c ****     
 810              		.loc 1 154 47 is_stmt 0 view .LVU207
 811 000a 441E     		subs	r4, r0, #1
 812              	.LVL47:
 157:App/Src/motor_control.c ****         return;
 813              		.loc 1 157 5 is_stmt 1 view .LVU208
 157:App/Src/motor_control.c ****         return;
 814              		.loc 1 157 14 is_stmt 0 view .LVU209
 815 000c C4EB4412 		rsb	r2, r4, r4, lsl #5
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 22


 816 0010 104B     		ldr	r3, .L71
 817 0012 03EBC203 		add	r3, r3, r2, lsl #3
 818 0016 93F8EC30 		ldrb	r3, [r3, #236]	@ zero_extendqisi2
 157:App/Src/motor_control.c ****         return;
 819              		.loc 1 157 8 view .LVU210
 820 001a 43B9     		cbnz	r3, .L64
 161:App/Src/motor_control.c ****     motor->mode = mode;
 821              		.loc 1 161 5 is_stmt 1 view .LVU211
 161:App/Src/motor_control.c ****     motor->mode = mode;
 822              		.loc 1 161 18 is_stmt 0 view .LVU212
 823 001c 0D4B     		ldr	r3, .L71
 824 001e 03EBC203 		add	r3, r3, r2, lsl #3
 825 0022 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 826              	.LVL48:
 162:App/Src/motor_control.c ****     motor->target_val = target;
 827              		.loc 1 162 5 is_stmt 1 view .LVU213
 162:App/Src/motor_control.c ****     motor->target_val = target;
 828              		.loc 1 162 17 is_stmt 0 view .LVU214
 829 0024 5970     		strb	r1, [r3, #1]
 830              	.LVL49:
 163:App/Src/motor_control.c ****     
 831              		.loc 1 163 5 is_stmt 1 view .LVU215
 163:App/Src/motor_control.c ****     
 832              		.loc 1 163 23 is_stmt 0 view .LVU216
 833 0026 83ED050A 		vstr.32	s0, [r3, #20]
 166:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 834              		.loc 1 166 5 is_stmt 1 view .LVU217
 166:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 835              		.loc 1 166 8 is_stmt 0 view .LVU218
 836 002a 8A42     		cmp	r2, r1
 837 002c 00D1     		bne	.L70
 838              	.LVL50:
 839              	.L64:
 170:App/Src/motor_control.c **** 
 840              		.loc 1 170 1 view .LVU219
 841 002e 70BD     		pop	{r4, r5, r6, pc}
 842              	.LVL51:
 843              	.L70:
 167:App/Src/motor_control.c ****         PID_Clear(&motor->angle_pid);
 844              		.loc 1 167 9 is_stmt 1 view .LVU220
 845 0030 6501     		lsls	r5, r4, #5
 846 0032 C4EB4410 		rsb	r0, r4, r4, lsl #5
 847              	.LVL52:
 167:App/Src/motor_control.c ****         PID_Clear(&motor->angle_pid);
 848              		.loc 1 167 9 is_stmt 0 view .LVU221
 849 0036 C000     		lsls	r0, r0, #3
 850 0038 1830     		adds	r0, r0, #24
 851 003a 064E     		ldr	r6, .L71
 852 003c 3044     		add	r0, r0, r6
 853 003e FFF7FEFF 		bl	PID_Clear
 854              	.LVL53:
 168:App/Src/motor_control.c ****     }
 855              		.loc 1 168 9 is_stmt 1 view .LVU222
 856 0042 281B     		subs	r0, r5, r4
 857 0044 C000     		lsls	r0, r0, #3
 858 0046 5830     		adds	r0, r0, #88
 859 0048 3044     		add	r0, r0, r6
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 23


 860 004a 0430     		adds	r0, r0, #4
 861 004c FFF7FEFF 		bl	PID_Clear
 862              	.LVL54:
 863 0050 EDE7     		b	.L64
 864              	.LVL55:
 865              	.L67:
 866              	.LCFI9:
 867              		.cfi_def_cfa_offset 0
 868              		.cfi_restore 4
 869              		.cfi_restore 5
 870              		.cfi_restore 6
 871              		.cfi_restore 14
 168:App/Src/motor_control.c ****     }
 872              		.loc 1 168 9 is_stmt 0 view .LVU223
 873 0052 7047     		bx	lr
 874              	.L72:
 875              		.align	2
 876              	.L71:
 877 0054 00000000 		.word	gm6020_motors
 878              		.cfi_endproc
 879              	.LFE141:
 881              		.section	.text.Motor_Control_Loop,"ax",%progbits
 882              		.align	1
 883              		.global	Motor_Control_Loop
 884              		.syntax unified
 885              		.thumb
 886              		.thumb_func
 888              	Motor_Control_Loop:
 889              	.LFB142:
 172:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 890              		.loc 1 172 31 is_stmt 1 view -0
 891              		.cfi_startproc
 892              		@ args = 0, pretend = 0, frame = 0
 893              		@ frame_needed = 0, uses_anonymous_args = 0
 894 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 895              	.LCFI10:
 896              		.cfi_def_cfa_offset 24
 897              		.cfi_offset 3, -24
 898              		.cfi_offset 4, -20
 899              		.cfi_offset 5, -16
 900              		.cfi_offset 6, -12
 901              		.cfi_offset 7, -8
 902              		.cfi_offset 14, -4
 903 0002 2DED028B 		vpush.64	{d8}
 904              	.LCFI11:
 905              		.cfi_def_cfa_offset 32
 906              		.cfi_offset 80, -32
 907              		.cfi_offset 81, -28
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 908              		.loc 1 173 5 view .LVU225
 909              	.LBB7:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 910              		.loc 1 173 10 view .LVU226
 911              	.LVL56:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 912              		.loc 1 173 14 is_stmt 0 view .LVU227
 913 0006 0024     		movs	r4, #0
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 24


 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 914              		.loc 1 173 5 view .LVU228
 915 0008 4FE0     		b	.L74
 916              	.LVL57:
 917              	.L75:
 918              	.LBB8:
 180:App/Src/motor_control.c ****             motor_current_send_buf[i] = 0;
 919              		.loc 1 180 13 is_stmt 1 view .LVU229
 180:App/Src/motor_control.c ****             motor_current_send_buf[i] = 0;
 920              		.loc 1 180 35 is_stmt 0 view .LVU230
 921 000a C4EB4412 		rsb	r2, r4, r4, lsl #5
 922 000e 6A4B     		ldr	r3, .L99
 923 0010 03EBC203 		add	r3, r3, r2, lsl #3
 924 0014 0022     		movs	r2, #0
 925 0016 A3F8E420 		strh	r2, [r3, #228]	@ movhi
 181:App/Src/motor_control.c ****             continue;
 926              		.loc 1 181 13 is_stmt 1 view .LVU231
 181:App/Src/motor_control.c ****             continue;
 927              		.loc 1 181 39 is_stmt 0 view .LVU232
 928 001a 684B     		ldr	r3, .L99+4
 929 001c 23F81420 		strh	r2, [r3, r4, lsl #1]	@ movhi
 182:App/Src/motor_control.c ****         }
 930              		.loc 1 182 13 is_stmt 1 view .LVU233
 931 0020 42E0     		b	.L77
 932              	.LVL58:
 933              	.L97:
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 934              		.loc 1 185 46 is_stmt 0 discriminator 1 view .LVU234
 935 0022 012B     		cmp	r3, #1
 936 0024 5FD1     		bne	.L78
 176:App/Src/motor_control.c ****         
 937              		.loc 1 176 15 view .LVU235
 938 0026 9FED668A 		vldr.32	s16, .L99+8
 939 002a 15E0     		b	.L80
 940              	.L81:
 194:App/Src/motor_control.c ****                     break;
 941              		.loc 1 194 21 is_stmt 1 view .LVU236
 194:App/Src/motor_control.c ****                     break;
 942              		.loc 1 194 90 is_stmt 0 view .LVU237
 943 002c 6248     		ldr	r0, .L99
 944 002e C4EB4413 		rsb	r3, r4, r4, lsl #5
 945 0032 00EBC303 		add	r3, r0, r3, lsl #3
 946 0036 B3F90630 		ldrsh	r3, [r3, #6]
 947 003a 00EE903A 		vmov	s1, r3	@ int
 194:App/Src/motor_control.c ****                     break;
 948              		.loc 1 194 38 view .LVU238
 949 003e C4EB4413 		rsb	r3, r4, r4, lsl #5
 950 0042 DB00     		lsls	r3, r3, #3
 951 0044 1833     		adds	r3, r3, #24
 952 0046 F8EEE00A 		vcvt.f32.s32	s1, s1
 953 004a B0EE480A 		vmov.f32	s0, s16
 954 004e 1844     		add	r0, r0, r3
 955 0050 FFF7FEFF 		bl	PID_Calc
 956              	.LVL59:
 194:App/Src/motor_control.c ****                     break;
 957              		.loc 1 194 38 view .LVU239
 958 0054 B0EE408A 		vmov.f32	s16, s0
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 25


 959              	.LVL60:
 195:App/Src/motor_control.c ****                     
 960              		.loc 1 195 21 is_stmt 1 view .LVU240
 961              	.L80:
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 962              		.loc 1 217 9 view .LVU241
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 963              		.loc 1 217 18 is_stmt 0 view .LVU242
 964 0058 C4EB4413 		rsb	r3, r4, r4, lsl #5
 965 005c 564A     		ldr	r2, .L99
 966 005e 12F83330 		ldrb	r3, [r2, r3, lsl #3]	@ zero_extendqisi2
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 967              		.loc 1 217 12 view .LVU243
 968 0062 042B     		cmp	r3, #4
 969 0064 0AD0     		beq	.L85
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 970              		.loc 1 217 37 discriminator 1 view .LVU244
 971 0066 C4EB4412 		rsb	r2, r4, r4, lsl #5
 972 006a 534B     		ldr	r3, .L99
 973 006c 03EBC203 		add	r3, r3, r2, lsl #3
 974 0070 5B78     		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 975              		.loc 1 217 72 discriminator 1 view .LVU245
 976 0072 013B     		subs	r3, r3, #1
 977 0074 DBB2     		uxtb	r3, r3
 217:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE)) {
 978              		.loc 1 217 28 discriminator 1 view .LVU246
 979 0076 012B     		cmp	r3, #1
 980 0078 40F28180 		bls	.L94
 981              	.L85:
 223:App/Src/motor_control.c ****             current_target += Calculate_Static_Friction_Compensation(motor);
 982              		.loc 1 223 9 is_stmt 1 view .LVU247
 223:App/Src/motor_control.c ****             current_target += Calculate_Static_Friction_Compensation(motor);
 983              		.loc 1 223 12 is_stmt 0 view .LVU248
 984 007c 032C     		cmp	r4, #3
 985 007e 00F08F80 		beq	.L95
 986              	.L86:
 228:App/Src/motor_control.c ****         
 987              		.loc 1 228 9 is_stmt 1 view .LVU249
 228:App/Src/motor_control.c ****         
 988              		.loc 1 228 33 is_stmt 0 view .LVU250
 989 0082 B0EE480A 		vmov.f32	s0, s16
 990 0086 FFF7FEFF 		bl	limit_current
 991              	.LVL61:
 228:App/Src/motor_control.c ****         
 992              		.loc 1 228 31 discriminator 1 view .LVU251
 993 008a C4EB4413 		rsb	r3, r4, r4, lsl #5
 994 008e 4A4E     		ldr	r6, .L99
 995 0090 06EBC306 		add	r6, r6, r3, lsl #3
 996 0094 A6F8E400 		strh	r0, [r6, #228]	@ movhi
 231:App/Src/motor_control.c ****         
 997              		.loc 1 231 9 is_stmt 1 view .LVU252
 998 0098 2846     		mov	r0, r5
 999 009a FFF7FEFF 		bl	Motor_Check_Stall
 1000              	.LVL62:
 234:App/Src/motor_control.c ****     }
 1001              		.loc 1 234 9 view .LVU253
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 26


 234:App/Src/motor_control.c ****     }
 1002              		.loc 1 234 42 is_stmt 0 view .LVU254
 1003 009e B6F9E420 		ldrsh	r2, [r6, #228]
 234:App/Src/motor_control.c ****     }
 1004              		.loc 1 234 35 view .LVU255
 1005 00a2 464B     		ldr	r3, .L99+4
 1006 00a4 23F81420 		strh	r2, [r3, r4, lsl #1]	@ movhi
 1007              	.LVL63:
 1008              	.L77:
 234:App/Src/motor_control.c ****     }
 1009              		.loc 1 234 35 view .LVU256
 1010              	.LBE8:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 1011              		.loc 1 173 29 is_stmt 1 discriminator 2 view .LVU257
 1012 00a8 0134     		adds	r4, r4, #1
 1013              	.LVL64:
 1014              	.L74:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 1015              		.loc 1 173 23 discriminator 1 view .LVU258
 1016 00aa 032C     		cmp	r4, #3
 1017 00ac 7EDC     		bgt	.L96
 1018              	.LBB12:
 174:App/Src/motor_control.c ****         float speed_target = 0;
 1019              		.loc 1 174 9 view .LVU259
 174:App/Src/motor_control.c ****         float speed_target = 0;
 1020              		.loc 1 174 25 is_stmt 0 view .LVU260
 1021 00ae C4EB4413 		rsb	r3, r4, r4, lsl #5
 1022 00b2 414D     		ldr	r5, .L99
 1023 00b4 05EBC305 		add	r5, r5, r3, lsl #3
 1024              	.LVL65:
 175:App/Src/motor_control.c ****         float current_target = 0;
 1025              		.loc 1 175 9 is_stmt 1 view .LVU261
 176:App/Src/motor_control.c ****         
 1026              		.loc 1 176 9 view .LVU262
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1027              		.loc 1 179 9 view .LVU263
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1028              		.loc 1 179 18 is_stmt 0 view .LVU264
 1029 00b8 95F8EC30 		ldrb	r3, [r5, #236]	@ zero_extendqisi2
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1030              		.loc 1 179 12 view .LVU265
 1031 00bc 002B     		cmp	r3, #0
 1032 00be A4D1     		bne	.L75
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1033              		.loc 1 179 39 discriminator 2 view .LVU266
 1034 00c0 6B78     		ldrb	r3, [r5, #1]	@ zero_extendqisi2
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 1035              		.loc 1 179 31 discriminator 2 view .LVU267
 1036 00c2 032B     		cmp	r3, #3
 1037 00c4 A1D0     		beq	.L75
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1038              		.loc 1 185 10 is_stmt 1 view .LVU268
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1039              		.loc 1 185 25 is_stmt 0 view .LVU269
 1040 00c6 C4EB4411 		rsb	r1, r4, r4, lsl #5
 1041 00ca 3B4A     		ldr	r2, .L99
 1042 00cc 02EBC102 		add	r2, r2, r1, lsl #3
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 27


 1043 00d0 92ED058A 		vldr.32	s16, [r2, #20]
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1044              		.loc 1 185 14 view .LVU270
 1045 00d4 B0EEC87A 		vabs.f32	s14, s16
 185:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_SPEED) {
 1046              		.loc 1 185 13 view .LVU271
 1047 00d8 F7EE007A 		vmov.f32	s15, #1.0e+0
 1048 00dc B4EEE77A 		vcmpe.f32	s14, s15
 1049 00e0 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1050 00e4 9DD4     		bmi	.L97
 1051              	.L78:
 189:App/Src/motor_control.c ****                 case MOTOR_MODE_CURRENT_OPEN:
 1052              		.loc 1 189 13 is_stmt 1 view .LVU272
 1053 00e6 012B     		cmp	r3, #1
 1054 00e8 A0D0     		beq	.L81
 1055 00ea 022B     		cmp	r3, #2
 1056 00ec 04D0     		beq	.L82
 1057 00ee 002B     		cmp	r3, #0
 1058 00f0 B2D0     		beq	.L80
 1059 00f2 9FED338A 		vldr.32	s16, .L99+8
 1060 00f6 AFE7     		b	.L80
 1061              	.L82:
 1062              	.LBB9:
 199:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 1063              		.loc 1 199 21 view .LVU273
 199:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 1064              		.loc 1 199 66 is_stmt 0 view .LVU274
 1065 00f8 C4EB4412 		rsb	r2, r4, r4, lsl #5
 1066 00fc 2E4B     		ldr	r3, .L99
 1067 00fe 03EBC203 		add	r3, r3, r2, lsl #3
 1068 0102 D3ED040A 		vldr.32	s1, [r3, #16]
 199:App/Src/motor_control.c ****                     if (fabsf(angle_error) < 1.0f) {
 1069              		.loc 1 199 27 view .LVU275
 1070 0106 78EE607A 		vsub.f32	s15, s16, s1
 1071              	.LVL66:
 200:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 1072              		.loc 1 200 21 is_stmt 1 view .LVU276
 200:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 1073              		.loc 1 200 25 is_stmt 0 view .LVU277
 1074 010a F0EEE77A 		vabs.f32	s15, s15
 1075              	.LVL67:
 200:App/Src/motor_control.c ****                         // 接近目标位置，降低速度
 1076              		.loc 1 200 24 view .LVU278
 1077 010e B7EE007A 		vmov.f32	s14, #1.0e+0
 1078 0112 F4EEC77A 		vcmpe.f32	s15, s14
 1079 0116 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1080 011a 1DD4     		bmi	.L98
 1081              	.LBB10:
 205:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 1082              		.loc 1 205 25 is_stmt 1 view .LVU279
 205:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 1083              		.loc 1 205 46 is_stmt 0 view .LVU280
 1084 011c 6601     		lsls	r6, r4, #5
 1085 011e C4EB4410 		rsb	r0, r4, r4, lsl #5
 1086 0122 C000     		lsls	r0, r0, #3
 1087 0124 5830     		adds	r0, r0, #88
 1088 0126 244F     		ldr	r7, .L99
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 28


 1089 0128 3844     		add	r0, r0, r7
 1090 012a B0EE480A 		vmov.f32	s0, s16
 1091 012e 0430     		adds	r0, r0, #4
 1092 0130 FFF7FEFF 		bl	PID_Calc
 1093              	.LVL68:
 206:App/Src/motor_control.c ****                     }
 1094              		.loc 1 206 25 is_stmt 1 view .LVU281
 206:App/Src/motor_control.c ****                     }
 1095              		.loc 1 206 89 is_stmt 0 view .LVU282
 1096 0134 321B     		subs	r2, r6, r4
 1097 0136 07EBC202 		add	r2, r7, r2, lsl #3
 1098 013a B2F90620 		ldrsh	r2, [r2, #6]
 1099 013e 00EE902A 		vmov	s1, r2	@ int
 206:App/Src/motor_control.c ****                     }
 1100              		.loc 1 206 42 view .LVU283
 1101 0142 301B     		subs	r0, r6, r4
 1102 0144 C000     		lsls	r0, r0, #3
 1103 0146 1830     		adds	r0, r0, #24
 1104 0148 F8EEE00A 		vcvt.f32.s32	s1, s1
 1105 014c 3844     		add	r0, r0, r7
 1106 014e FFF7FEFF 		bl	PID_Calc
 1107              	.LVL69:
 206:App/Src/motor_control.c ****                     }
 1108              		.loc 1 206 42 view .LVU284
 1109 0152 B0EE408A 		vmov.f32	s16, s0
 1110              	.LVL70:
 206:App/Src/motor_control.c ****                     }
 1111              		.loc 1 206 42 view .LVU285
 1112 0156 7FE7     		b	.L80
 1113              	.LVL71:
 1114              	.L98:
 206:App/Src/motor_control.c ****                     }
 1115              		.loc 1 206 42 view .LVU286
 1116              	.LBE10:
 1117              	.LBB11:
 202:App/Src/motor_control.c ****                         current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm
 1118              		.loc 1 202 25 is_stmt 1 view .LVU287
 203:App/Src/motor_control.c ****                     } else {
 1119              		.loc 1 203 25 view .LVU288
 203:App/Src/motor_control.c ****                     } else {
 1120              		.loc 1 203 89 is_stmt 0 view .LVU289
 1121 0158 1748     		ldr	r0, .L99
 1122 015a 00EBC203 		add	r3, r0, r2, lsl #3
 1123 015e B3F90630 		ldrsh	r3, [r3, #6]
 1124 0162 00EE903A 		vmov	s1, r3	@ int
 1125              	.LVL72:
 203:App/Src/motor_control.c ****                     } else {
 1126              		.loc 1 203 42 view .LVU290
 1127 0166 D300     		lsls	r3, r2, #3
 1128 0168 1833     		adds	r3, r3, #24
 1129 016a F8EEE00A 		vcvt.f32.s32	s1, s1
 1130 016e 9FED140A 		vldr.32	s0, .L99+8
 1131 0172 1844     		add	r0, r0, r3
 1132              	.LVL73:
 203:App/Src/motor_control.c ****                     } else {
 1133              		.loc 1 203 42 view .LVU291
 1134 0174 FFF7FEFF 		bl	PID_Calc
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 29


 1135              	.LVL74:
 203:App/Src/motor_control.c ****                     } else {
 1136              		.loc 1 203 42 view .LVU292
 1137 0178 B0EE408A 		vmov.f32	s16, s0
 1138              	.LVL75:
 203:App/Src/motor_control.c ****                     } else {
 1139              		.loc 1 203 42 view .LVU293
 1140              	.LBE11:
 1141 017c 6CE7     		b	.L80
 1142              	.LVL76:
 1143              	.L94:
 203:App/Src/motor_control.c ****                     } else {
 1144              		.loc 1 203 42 view .LVU294
 1145              	.LBE9:
 220:App/Src/motor_control.c ****             current_target += motor->feedforward;
 1146              		.loc 1 220 13 is_stmt 1 view .LVU295
 220:App/Src/motor_control.c ****             current_target += motor->feedforward;
 1147              		.loc 1 220 34 is_stmt 0 view .LVU296
 1148 017e 2846     		mov	r0, r5
 1149 0180 FFF7FEFF 		bl	Motor_Calc_Gravity_FF
 1150              	.LVL77:
 220:App/Src/motor_control.c ****             current_target += motor->feedforward;
 1151              		.loc 1 220 32 discriminator 1 view .LVU297
 1152 0184 C4EB4412 		rsb	r2, r4, r4, lsl #5
 1153 0188 0B4B     		ldr	r3, .L99
 1154 018a 03EBC203 		add	r3, r3, r2, lsl #3
 1155 018e A3F8F400 		strh	r0, [r3, #244]	@ movhi
 221:App/Src/motor_control.c ****         }
 1156              		.loc 1 221 13 is_stmt 1 view .LVU298
 221:App/Src/motor_control.c ****         }
 1157              		.loc 1 221 28 is_stmt 0 view .LVU299
 1158 0192 07EE900A 		vmov	s15, r0	@ int
 1159 0196 F8EEE77A 		vcvt.f32.s32	s15, s15
 1160 019a 38EE278A 		vadd.f32	s16, s16, s15
 1161              	.LVL78:
 221:App/Src/motor_control.c ****         }
 1162              		.loc 1 221 28 view .LVU300
 1163 019e 6DE7     		b	.L85
 1164              	.L95:
 224:App/Src/motor_control.c ****         }
 1165              		.loc 1 224 13 is_stmt 1 view .LVU301
 224:App/Src/motor_control.c ****         }
 1166              		.loc 1 224 31 is_stmt 0 view .LVU302
 1167 01a0 2846     		mov	r0, r5
 1168 01a2 FFF7FEFF 		bl	Calculate_Static_Friction_Compensation
 1169              	.LVL79:
 224:App/Src/motor_control.c ****         }
 1170              		.loc 1 224 28 discriminator 1 view .LVU303
 1171 01a6 38EE008A 		vadd.f32	s16, s16, s0
 1172              	.LVL80:
 224:App/Src/motor_control.c ****         }
 1173              		.loc 1 224 28 discriminator 1 view .LVU304
 1174 01aa 6AE7     		b	.L86
 1175              	.LVL81:
 1176              	.L96:
 224:App/Src/motor_control.c ****         }
 1177              		.loc 1 224 28 discriminator 1 view .LVU305
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 30


 1178              	.LBE12:
 1179              	.LBE7:
 238:App/Src/motor_control.c **** }
 1180              		.loc 1 238 5 is_stmt 1 view .LVU306
 1181 01ac FFF7FEFF 		bl	BSP_CAN_Send_Current_Cmd
 1182              	.LVL82:
 239:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor) {
 1183              		.loc 1 239 1 is_stmt 0 view .LVU307
 1184 01b0 BDEC028B 		vldm	sp!, {d8}
 1185              	.LCFI12:
 1186              		.cfi_restore 80
 1187              		.cfi_restore 81
 1188              		.cfi_def_cfa_offset 24
 1189 01b4 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1190              	.LVL83:
 1191              	.L100:
 239:App/Src/motor_control.c **** static float Calculate_Static_Friction_Compensation(GM6020_TypeDef *motor) {
 1192              		.loc 1 239 1 view .LVU308
 1193 01b6 00BF     		.align	2
 1194              	.L99:
 1195 01b8 00000000 		.word	gm6020_motors
 1196 01bc 00000000 		.word	motor_current_send_buf
 1197 01c0 00000000 		.word	0
 1198              		.cfi_endproc
 1199              	.LFE142:
 1201              		.section	.text.Motor_Set_Dual_Target,"ax",%progbits
 1202              		.align	1
 1203              		.global	Motor_Set_Dual_Target
 1204              		.syntax unified
 1205              		.thumb
 1206              		.thumb_func
 1208              	Motor_Set_Dual_Target:
 1209              	.LVL84:
 1210              	.LFB145:
 249:App/Src/motor_control.c **** 
 250:App/Src/motor_control.c **** // ✅ 新增：静止电机处理
 251:App/Src/motor_control.c **** static float Handle_Static_Motor(GM6020_TypeDef *motor) {
 252:App/Src/motor_control.c ****     // 智能静止保持：根据历史电流调整
 253:App/Src/motor_control.c ****     static float last_current[4] = {0};
 254:App/Src/motor_control.c ****     uint8_t idx = motor->id - 1;
 255:App/Src/motor_control.c ****     
 256:App/Src/motor_control.c ****     if (fabsf(motor->speed_rpm) < 0.3f) {
 257:App/Src/motor_control.c ****         // 保持之前的电流，但逐渐衰减
 258:App/Src/motor_control.c ****         return last_current[idx] * 0.98f;
 259:App/Src/motor_control.c ****     } else {
 260:App/Src/motor_control.c ****         // 有微小速度，使用小比例控制
 261:App/Src/motor_control.c ****         float small_kp = 20.0f; // 小比例系数
 262:App/Src/motor_control.c ****         return small_kp * (-motor->speed_rpm);
 263:App/Src/motor_control.c ****     }
 264:App/Src/motor_control.c **** }
 265:App/Src/motor_control.c **** void Motor_Set_Dual_Target(uint8_t id1, Motor_Mode_e mode1, float target1,
 266:App/Src/motor_control.c ****                            uint8_t id2, Motor_Mode_e mode2, float target2) {
 1211              		.loc 1 266 76 is_stmt 1 view -0
 1212              		.cfi_startproc
 1213              		@ args = 0, pretend = 0, frame = 0
 1214              		@ frame_needed = 0, uses_anonymous_args = 0
 1215              		.loc 1 266 76 is_stmt 0 view .LVU310
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 31


 1216 0000 38B5     		push	{r3, r4, r5, lr}
 1217              	.LCFI13:
 1218              		.cfi_def_cfa_offset 16
 1219              		.cfi_offset 3, -16
 1220              		.cfi_offset 4, -12
 1221              		.cfi_offset 5, -8
 1222              		.cfi_offset 14, -4
 1223 0002 2DED028B 		vpush.64	{d8}
 1224              	.LCFI14:
 1225              		.cfi_def_cfa_offset 24
 1226              		.cfi_offset 80, -24
 1227              		.cfi_offset 81, -20
 1228 0006 1446     		mov	r4, r2
 1229 0008 1D46     		mov	r5, r3
 1230 000a B0EE608A 		vmov.f32	s16, s1
 267:App/Src/motor_control.c ****     Motor_Set_Target(id1, mode1, target1);
 1231              		.loc 1 267 5 is_stmt 1 view .LVU311
 1232 000e FFF7FEFF 		bl	Motor_Set_Target
 1233              	.LVL85:
 268:App/Src/motor_control.c ****     Motor_Set_Target(id2, mode2, target2);
 1234              		.loc 1 268 5 view .LVU312
 1235 0012 B0EE480A 		vmov.f32	s0, s16
 1236 0016 2946     		mov	r1, r5
 1237 0018 2046     		mov	r0, r4
 1238 001a FFF7FEFF 		bl	Motor_Set_Target
 1239              	.LVL86:
 269:App/Src/motor_control.c **** }...
 1240              		.loc 1 269 1 is_stmt 0 view .LVU313
 1241 001e BDEC028B 		vldm	sp!, {d8}
 1242              	.LCFI15:
 1243              		.cfi_restore 80
 1244              		.cfi_restore 81
 1245              		.cfi_def_cfa_offset 16
 1246              	.LVL87:
 1247              		.loc 1 269 1 view .LVU314
 1248 0022 38BD     		pop	{r3, r4, r5, pc}
 1249              		.loc 1 269 1 view .LVU315
 1250              		.cfi_endproc
 1251              	.LFE145:
 1253              		.global	gm6020_motors
 1254              		.section	.bss.gm6020_motors,"aw",%nobits
 1255              		.align	2
 1258              	gm6020_motors:
 1259 0000 00000000 		.space	992
 1259      00000000 
 1259      00000000 
 1259      00000000 
 1259      00000000 
 1260              		.text
 1261              	.Letext0:
 1262              		.file 2 "C:/msys64/mingw64/arm-none-eabi/include/machine/_default_types.h"
 1263              		.file 3 "C:/msys64/mingw64/arm-none-eabi/include/sys/_stdint.h"
 1264              		.file 4 "App/Inc/pid.h"
 1265              		.file 5 "App/Inc/motor_control.h"
 1266              		.file 6 "C:/msys64/mingw64/arm-none-eabi/include/math.h"
 1267              		.file 7 "App/Inc/can_bsp.h"
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s 			page 32


DEFINED SYMBOLS
                            *ABS*:00000000 motor_control.c
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:21     .text.Motor_Process_Angle:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:26     .text.Motor_Process_Angle:00000000 Motor_Process_Angle
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:94     .text.Motor_Process_Angle:00000050 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:100    .text.limit_current:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:105    .text.limit_current:00000000 limit_current
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:146    .text.limit_current:00000034 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:153    .text.Motor_Check_Stall:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:158    .text.Motor_Check_Stall:00000000 Motor_Check_Stall
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:230    .text.Motor_Check_Stall:00000070 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:236    .text.Calculate_Static_Friction_Compensation:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:241    .text.Calculate_Static_Friction_Compensation:00000000 Calculate_Static_Friction_Compensation
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:287    .text.Calculate_Static_Friction_Compensation:00000040 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:295    .text.Motor_Calc_Gravity_FF:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:300    .text.Motor_Calc_Gravity_FF:00000000 Motor_Calc_Gravity_FF
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:417    .text.Motor_Calc_Gravity_FF:00000084 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:425    .text.Motor_Clear_Stall:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:431    .text.Motor_Clear_Stall:00000000 Motor_Clear_Stall
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:475    .text.Motor_Clear_Stall:0000002c $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:1258   .bss.gm6020_motors:00000000 gm6020_motors
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:480    .text.Motor_Init_All:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:486    .text.Motor_Init_All:00000000 Motor_Init_All
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:677    .text.Motor_Init_All:00000124 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:693    .text.Motor_Update_Feedback:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:699    .text.Motor_Update_Feedback:00000000 Motor_Update_Feedback
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:776    .text.Motor_Update_Feedback:00000054 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:781    .text.Motor_Set_Target:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:787    .text.Motor_Set_Target:00000000 Motor_Set_Target
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:877    .text.Motor_Set_Target:00000054 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:882    .text.Motor_Control_Loop:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:888    .text.Motor_Control_Loop:00000000 Motor_Control_Loop
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:1195   .text.Motor_Control_Loop:000001b8 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:1202   .text.Motor_Set_Dual_Target:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:1208   .text.Motor_Set_Dual_Target:00000000 Motor_Set_Dual_Target
C:\Users\wxwsyzh\AppData\Local\Temp\ccvN2F3f.s:1255   .bss.gm6020_motors:00000000 $d

UNDEFINED SYMBOLS
cosf
sinf
PID_Init
PID_Clear
PID_Calc
BSP_CAN_Send_Current_Cmd
motor_current_send_buf
