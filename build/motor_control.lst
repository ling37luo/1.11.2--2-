ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"motor_control.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "App/Src/motor_control.c"
  20              		.section	.text.limit_current,"ax",%progbits
  21              		.align	1
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	limit_current:
  27              	.LVL0:
  28              	.LFB135:
   1:App/Src/motor_control.c **** #include "motor_control.h"
   2:App/Src/motor_control.c **** #include "can_bsp.h"
   3:App/Src/motor_control.c **** #include <math.h>
   4:App/Src/motor_control.c **** 
   5:App/Src/motor_control.c **** GM6020_TypeDef gm6020_motors[4];
   6:App/Src/motor_control.c **** 
   7:App/Src/motor_control.c **** #define PI 3.1415926535f
   8:App/Src/motor_control.c **** 
   9:App/Src/motor_control.c **** /**
  10:App/Src/motor_control.c ****  * @brief 计算重力前馈
  11:App/Src/motor_control.c ****  * @note  逻辑：水平时输出最大(Gain)，垂直时输出0
  12:App/Src/motor_control.c ****  */
  13:App/Src/motor_control.c **** static int16_t Motor_Calc_Gravity_FF(GM6020_TypeDef *motor) {
  14:App/Src/motor_control.c ****     // 1. 计算当前角度与水平零点的偏差 (转换为弧度)
  15:App/Src/motor_control.c ****     // GM6020 一圈是 0-8191
  16:App/Src/motor_control.c ****     if (motor->id == 4) {
  17:App/Src/motor_control.c ****         return 0;
  18:App/Src/motor_control.c ****     }
  19:App/Src/motor_control.c ****     int32_t ecd_diff = motor->ecd_raw - motor->horizon_ecd;
  20:App/Src/motor_control.c ****     
  21:App/Src/motor_control.c ****     // 处理过零点问题 (例如从 8190 到 10)
  22:App/Src/motor_control.c ****     if (ecd_diff > 4096)  ecd_diff -= 8192;
  23:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
  24:App/Src/motor_control.c **** 
  25:App/Src/motor_control.c ****     // 转换为弧度: (diff / 8192) * 2PI
  26:App/Src/motor_control.c ****     float angle_rad = (float)ecd_diff * (2.0f * PI / 8192.0f);
  27:App/Src/motor_control.c **** 
  28:App/Src/motor_control.c ****     // 2. 计算前馈值
  29:App/Src/motor_control.c ****     // 使用 cos：当 angle_rad = 0 (水平) 时，cos=1，输出最大 Gain
  30:App/Src/motor_control.c ****     // 当 angle_rad = PI/2 (垂直) 时，cos=0，输出 0
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 2


  31:App/Src/motor_control.c ****     // 注意：根据电机安装方向，可能需要改为 -motor->gravity_gain
  32:App/Src/motor_control.c ****     return (int16_t)(motor->gravity_gain * cosf(angle_rad));
  33:App/Src/motor_control.c **** }
  34:App/Src/motor_control.c **** 
  35:App/Src/motor_control.c **** // 辅助函数：限制电流范围
  36:App/Src/motor_control.c **** static int16_t limit_current(float val) {
  29              		.loc 1 36 41 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
  37:App/Src/motor_control.c ****     if (val > GM6020_MAX_CURRENT) return (int16_t)GM6020_MAX_CURRENT;
  34              		.loc 1 37 5 view .LVU1
  35              		.loc 1 37 8 is_stmt 0 view .LVU2
  36 0000 DFED0C7A 		vldr.32	s15, .L5
  37 0004 B4EEE70A 		vcmpe.f32	s0, s15
  38 0008 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
  39 000c 0CDC     		bgt	.L3
  38:App/Src/motor_control.c ****     if (val < -GM6020_MAX_CURRENT) return (int16_t)-GM6020_MAX_CURRENT;
  40              		.loc 1 38 5 is_stmt 1 view .LVU3
  41              		.loc 1 38 8 is_stmt 0 view .LVU4
  42 000e DFED0A7A 		vldr.32	s15, .L5+4
  43 0012 B4EEE70A 		vcmpe.f32	s0, s15
  44 0016 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
  45 001a 08D4     		bmi	.L4
  39:App/Src/motor_control.c ****     return (int16_t)val;
  46              		.loc 1 39 5 is_stmt 1 view .LVU5
  47              		.loc 1 39 12 is_stmt 0 view .LVU6
  48 001c BDEEC00A 		vcvt.s32.f32	s0, s0
  49              	.LVL1:
  50              		.loc 1 39 12 view .LVU7
  51 0020 10EE103A 		vmov	r3, s0	@ int
  52 0024 18B2     		sxth	r0, r3
  53 0026 7047     		bx	lr
  54              	.LVL2:
  55              	.L3:
  37:App/Src/motor_control.c ****     if (val > GM6020_MAX_CURRENT) return (int16_t)GM6020_MAX_CURRENT;
  56              		.loc 1 37 42 discriminator 1 view .LVU8
  57 0028 4FF48040 		mov	r0, #16384
  58 002c 7047     		bx	lr
  59              	.L4:
  38:App/Src/motor_control.c ****     if (val < -GM6020_MAX_CURRENT) return (int16_t)-GM6020_MAX_CURRENT;
  60              		.loc 1 38 43 discriminator 1 view .LVU9
  61 002e 0348     		ldr	r0, .L5+8
  40:App/Src/motor_control.c **** }
  62              		.loc 1 40 1 view .LVU10
  63 0030 7047     		bx	lr
  64              	.L6:
  65 0032 00BF     		.align	2
  66              	.L5:
  67 0034 00008046 		.word	1182793728
  68 0038 000080C6 		.word	-964689920
  69 003c 00C0FFFF 		.word	-16384
  70              		.cfi_endproc
  71              	.LFE135:
  73              		.section	.text.Motor_Process_Angle,"ax",%progbits
  74              		.align	1
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 3


  75              		.syntax unified
  76              		.thumb
  77              		.thumb_func
  79              	Motor_Process_Angle:
  80              	.LVL3:
  81              	.LFB136:
  41:App/Src/motor_control.c **** 
  42:App/Src/motor_control.c **** // 角度处理 (保持不变)
  43:App/Src/motor_control.c **** static void Motor_Process_Angle(GM6020_TypeDef *motor) {
  82              		.loc 1 43 56 is_stmt 1 view -0
  83              		.cfi_startproc
  84              		@ args = 0, pretend = 0, frame = 0
  85              		@ frame_needed = 0, uses_anonymous_args = 0
  86              		@ link register save eliminated.
  44:App/Src/motor_control.c ****     int diff = motor->ecd_raw - motor->last_ecd;
  87              		.loc 1 44 5 view .LVU12
  88              		.loc 1 44 21 is_stmt 0 view .LVU13
  89 0000 4288     		ldrh	r2, [r0, #2]
  90              		.loc 1 44 38 view .LVU14
  91 0002 8388     		ldrh	r3, [r0, #4]
  92              		.loc 1 44 9 view .LVU15
  93 0004 D31A     		subs	r3, r2, r3
  94              	.LVL4:
  45:App/Src/motor_control.c ****     if (diff > 4096) motor->round_cnt--;
  95              		.loc 1 45 5 is_stmt 1 view .LVU16
  96              		.loc 1 45 8 is_stmt 0 view .LVU17
  97 0006 B3F5805F 		cmp	r3, #4096
  98 000a 1ADD     		ble	.L8
  99              		.loc 1 45 22 is_stmt 1 discriminator 1 view .LVU18
 100              		.loc 1 45 27 is_stmt 0 discriminator 1 view .LVU19
 101 000c C368     		ldr	r3, [r0, #12]
 102              	.LVL5:
 103              		.loc 1 45 38 discriminator 1 view .LVU20
 104 000e 013B     		subs	r3, r3, #1
 105 0010 C360     		str	r3, [r0, #12]
 106              	.L9:
  46:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
  47:App/Src/motor_control.c ****     motor->total_angle = motor->round_cnt * 360.0f + (motor->ecd_raw / 8192.0f * 360.0f);
 107              		.loc 1 47 5 is_stmt 1 view .LVU21
 108              		.loc 1 47 43 is_stmt 0 view .LVU22
 109 0012 D0ED037A 		vldr.32	s15, [r0, #12]	@ int
 110 0016 F8EEE77A 		vcvt.f32.s32	s15, s15
 111 001a DFED0D6A 		vldr.32	s13, .L10
 112 001e 67EEA67A 		vmul.f32	s15, s15, s13
 113              		.loc 1 47 70 view .LVU23
 114 0022 07EE102A 		vmov	s14, r2	@ int
 115 0026 B8EEC77A 		vcvt.f32.s32	s14, s14
 116 002a 9FED0A6A 		vldr.32	s12, .L10+4
 117 002e 27EE067A 		vmul.f32	s14, s14, s12
 118              		.loc 1 47 80 view .LVU24
 119 0032 27EE267A 		vmul.f32	s14, s14, s13
 120              		.loc 1 47 52 view .LVU25
 121 0036 77EE877A 		vadd.f32	s15, s15, s14
 122              		.loc 1 47 24 view .LVU26
 123 003a C0ED047A 		vstr.32	s15, [r0, #16]
  48:App/Src/motor_control.c ****     motor->last_ecd = motor->ecd_raw;
 124              		.loc 1 48 5 is_stmt 1 view .LVU27
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 4


 125              		.loc 1 48 21 is_stmt 0 view .LVU28
 126 003e 8280     		strh	r2, [r0, #4]	@ movhi
 127              	.LVL6:
  49:App/Src/motor_control.c **** }
 128              		.loc 1 49 1 view .LVU29
 129 0040 7047     		bx	lr
 130              	.LVL7:
 131              	.L8:
  46:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
 132              		.loc 1 46 10 is_stmt 1 view .LVU30
  46:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
 133              		.loc 1 46 13 is_stmt 0 view .LVU31
 134 0042 13F5805F 		cmn	r3, #4096
 135 0046 E4DA     		bge	.L9
  46:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
 136              		.loc 1 46 28 is_stmt 1 discriminator 1 view .LVU32
  46:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
 137              		.loc 1 46 33 is_stmt 0 discriminator 1 view .LVU33
 138 0048 C368     		ldr	r3, [r0, #12]
 139              	.LVL8:
  46:App/Src/motor_control.c ****     else if (diff < -4096) motor->round_cnt++;
 140              		.loc 1 46 44 discriminator 1 view .LVU34
 141 004a 0133     		adds	r3, r3, #1
 142 004c C360     		str	r3, [r0, #12]
 143 004e E0E7     		b	.L9
 144              	.L11:
 145              		.align	2
 146              	.L10:
 147 0050 0000B443 		.word	1135869952
 148 0054 00000039 		.word	956301312
 149              		.cfi_endproc
 150              	.LFE136:
 152              		.section	.text.Motor_Check_Stall,"ax",%progbits
 153              		.align	1
 154              		.syntax unified
 155              		.thumb
 156              		.thumb_func
 158              	Motor_Check_Stall:
 159              	.LVL9:
 160              	.LFB137:
  50:App/Src/motor_control.c **** 
  51:App/Src/motor_control.c **** // 堵转检测逻辑
  52:App/Src/motor_control.c **** static void Motor_Check_Stall(GM6020_TypeDef *motor) {
 161              		.loc 1 52 54 is_stmt 1 view -0
 162              		.cfi_startproc
 163              		@ args = 0, pretend = 0, frame = 0
 164              		@ frame_needed = 0, uses_anonymous_args = 0
 165              		@ link register save eliminated.
  53:App/Src/motor_control.c ****     // 如果处于停止模式或已经堵转，不重复检测
  54:App/Src/motor_control.c ****     if (motor->mode == MOTOR_MODE_STOP || motor->is_stalled) return;
 166              		.loc 1 54 5 view .LVU36
 167              		.loc 1 54 14 is_stmt 0 view .LVU37
 168 0000 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
 169              		.loc 1 54 8 view .LVU38
 170 0002 032B     		cmp	r3, #3
 171 0004 32D0     		beq	.L12
 172              		.loc 1 54 48 discriminator 2 view .LVU39
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 5


 173 0006 90F8EC30 		ldrb	r3, [r0, #236]	@ zero_extendqisi2
 174              		.loc 1 54 40 discriminator 2 view .LVU40
 175 000a 7BBB     		cbnz	r3, .L12
  55:App/Src/motor_control.c **** 
  56:App/Src/motor_control.c ****     // 逻辑：输出电流绝对值 > 阈值  且  实际转速绝对值 < 阈值
  57:App/Src/motor_control.c ****     if (fabsf(motor->output_current) > STALL_CURRENT_THRESH && 
 176              		.loc 1 57 5 is_stmt 1 view .LVU41
 177              		.loc 1 57 20 is_stmt 0 view .LVU42
 178 000c B0F9E430 		ldrsh	r3, [r0, #228]
 179 0010 07EE903A 		vmov	s15, r3	@ int
 180              		.loc 1 57 9 view .LVU43
 181 0014 F8EEE77A 		vcvt.f32.s32	s15, s15
 182 0018 F0EEE77A 		vabs.f32	s15, s15
 183              		.loc 1 57 8 view .LVU44
 184 001c 9FED147A 		vldr.32	s14, .L19
 185 0020 F4EEC77A 		vcmpe.f32	s15, s14
 186 0024 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 187 0028 1DDD     		ble	.L14
  58:App/Src/motor_control.c ****         fabsf(motor->speed_rpm) < STALL_SPEED_THRESH) {
 188              		.loc 1 58 20 view .LVU45
 189 002a B0F90630 		ldrsh	r3, [r0, #6]
 190 002e 07EE903A 		vmov	s15, r3	@ int
 191              		.loc 1 58 9 view .LVU46
 192 0032 F8EEE77A 		vcvt.f32.s32	s15, s15
 193 0036 F0EEE77A 		vabs.f32	s15, s15
  57:App/Src/motor_control.c ****         fabsf(motor->speed_rpm) < STALL_SPEED_THRESH) {
 194              		.loc 1 57 61 discriminator 1 view .LVU47
 195 003a 9FED0E7A 		vldr.32	s14, .L19+4
 196 003e F4EEC77A 		vcmpe.f32	s15, s14
 197 0042 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 198 0046 0ED5     		bpl	.L14
  59:App/Src/motor_control.c ****         
  60:App/Src/motor_control.c ****         motor->stall_cnt++;
 199              		.loc 1 60 9 is_stmt 1 view .LVU48
 200              		.loc 1 60 14 is_stmt 0 view .LVU49
 201 0048 D0F8E830 		ldr	r3, [r0, #232]
 202              		.loc 1 60 25 view .LVU50
 203 004c 0133     		adds	r3, r3, #1
 204 004e C0F8E830 		str	r3, [r0, #232]
  61:App/Src/motor_control.c ****         if (motor->stall_cnt > STALL_TIME_MS) {
 205              		.loc 1 61 9 is_stmt 1 view .LVU51
 206              		.loc 1 61 12 is_stmt 0 view .LVU52
 207 0052 40F2DC52 		movw	r2, #1500
 208 0056 9342     		cmp	r3, r2
 209 0058 08D9     		bls	.L12
  62:App/Src/motor_control.c ****             motor->is_stalled = 1; // 标记堵转
 210              		.loc 1 62 13 is_stmt 1 view .LVU53
 211              		.loc 1 62 31 is_stmt 0 view .LVU54
 212 005a 0123     		movs	r3, #1
 213 005c 80F8EC30 		strb	r3, [r0, #236]
  63:App/Src/motor_control.c ****             motor->mode = MOTOR_MODE_STOP; // 强制切换到停止模式保护电机
 214              		.loc 1 63 13 is_stmt 1 view .LVU55
 215              		.loc 1 63 25 is_stmt 0 view .LVU56
 216 0060 0323     		movs	r3, #3
 217 0062 4370     		strb	r3, [r0, #1]
 218 0064 7047     		bx	lr
 219              	.L14:
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 6


  64:App/Src/motor_control.c ****         }
  65:App/Src/motor_control.c ****     } else {
  66:App/Src/motor_control.c ****         motor->stall_cnt = 0; // 计数清零
 220              		.loc 1 66 9 is_stmt 1 view .LVU57
 221              		.loc 1 66 26 is_stmt 0 view .LVU58
 222 0066 0023     		movs	r3, #0
 223 0068 C0F8E830 		str	r3, [r0, #232]
 224              	.L12:
  67:App/Src/motor_control.c ****     }
  68:App/Src/motor_control.c **** }
 225              		.loc 1 68 1 view .LVU59
 226 006c 7047     		bx	lr
 227              	.L20:
 228 006e 00BF     		.align	2
 229              	.L19:
 230 0070 00803B46 		.word	1178304512
 231 0074 0000C842 		.word	1120403456
 232              		.cfi_endproc
 233              	.LFE137:
 235              		.section	.text.Motor_Calc_Gravity_FF,"ax",%progbits
 236              		.align	1
 237              		.syntax unified
 238              		.thumb
 239              		.thumb_func
 241              	Motor_Calc_Gravity_FF:
 242              	.LVL10:
 243              	.LFB134:
  13:App/Src/motor_control.c ****     // 1. 计算当前角度与水平零点的偏差 (转换为弧度)
 244              		.loc 1 13 61 is_stmt 1 view -0
 245              		.cfi_startproc
 246              		@ args = 0, pretend = 0, frame = 0
 247              		@ frame_needed = 0, uses_anonymous_args = 0
  13:App/Src/motor_control.c ****     // 1. 计算当前角度与水平零点的偏差 (转换为弧度)
 248              		.loc 1 13 61 is_stmt 0 view .LVU61
 249 0000 08B5     		push	{r3, lr}
 250              	.LCFI0:
 251              		.cfi_def_cfa_offset 8
 252              		.cfi_offset 3, -8
 253              		.cfi_offset 14, -4
 254 0002 2DED028B 		vpush.64	{d8}
 255              	.LCFI1:
 256              		.cfi_def_cfa_offset 16
 257              		.cfi_offset 80, -16
 258              		.cfi_offset 81, -12
  16:App/Src/motor_control.c ****         return 0;
 259              		.loc 1 16 5 is_stmt 1 view .LVU62
  16:App/Src/motor_control.c ****         return 0;
 260              		.loc 1 16 14 is_stmt 0 view .LVU63
 261 0006 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
  16:App/Src/motor_control.c ****         return 0;
 262              		.loc 1 16 8 view .LVU64
 263 0008 042B     		cmp	r3, #4
 264 000a 24D0     		beq	.L25
  19:App/Src/motor_control.c ****     
 265              		.loc 1 19 5 is_stmt 1 view .LVU65
  19:App/Src/motor_control.c ****     
 266              		.loc 1 19 29 is_stmt 0 view .LVU66
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 7


 267 000c 4388     		ldrh	r3, [r0, #2]
  19:App/Src/motor_control.c ****     
 268              		.loc 1 19 46 view .LVU67
 269 000e B0F8EE20 		ldrh	r2, [r0, #238]
  19:App/Src/motor_control.c ****     
 270              		.loc 1 19 13 view .LVU68
 271 0012 9B1A     		subs	r3, r3, r2
 272              	.LVL11:
  22:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 273              		.loc 1 22 5 is_stmt 1 view .LVU69
  22:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 274              		.loc 1 22 8 is_stmt 0 view .LVU70
 275 0014 B3F5805F 		cmp	r3, #4096
 276 0018 17DD     		ble	.L23
  22:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 277              		.loc 1 22 27 is_stmt 1 discriminator 1 view .LVU71
  22:App/Src/motor_control.c ****     if (ecd_diff < -4096) ecd_diff += 8192;
 278              		.loc 1 22 36 is_stmt 0 discriminator 1 view .LVU72
 279 001a A3F50053 		sub	r3, r3, #8192
 280              	.LVL12:
  23:App/Src/motor_control.c **** 
 281              		.loc 1 23 5 is_stmt 1 view .LVU73
 282              	.L24:
  26:App/Src/motor_control.c **** 
 283              		.loc 1 26 5 view .LVU74
  26:App/Src/motor_control.c **** 
 284              		.loc 1 26 23 is_stmt 0 view .LVU75
 285 001e 07EE903A 		vmov	s15, r3	@ int
 286 0022 F8EEE77A 		vcvt.f32.s32	s15, s15
 287              	.LVL13:
  32:App/Src/motor_control.c **** }
 288              		.loc 1 32 5 is_stmt 1 view .LVU76
  32:App/Src/motor_control.c **** }
 289              		.loc 1 32 27 is_stmt 0 view .LVU77
 290 0026 90ED3C8A 		vldr.32	s16, [r0, #240]
  32:App/Src/motor_control.c **** }
 291              		.loc 1 32 44 view .LVU78
 292 002a 9FED0C0A 		vldr.32	s0, .L27
 293 002e 27EE800A 		vmul.f32	s0, s15, s0
 294              	.LVL14:
  32:App/Src/motor_control.c **** }
 295              		.loc 1 32 44 view .LVU79
 296 0032 FFF7FEFF 		bl	cosf
 297              	.LVL15:
  32:App/Src/motor_control.c **** }
 298              		.loc 1 32 42 discriminator 1 view .LVU80
 299 0036 28EE008A 		vmul.f32	s16, s16, s0
  32:App/Src/motor_control.c **** }
 300              		.loc 1 32 12 discriminator 1 view .LVU81
 301 003a BDEEC88A 		vcvt.s32.f32	s16, s16
 302 003e 18EE103A 		vmov	r3, s16	@ int
 303 0042 18B2     		sxth	r0, r3
 304              	.LVL16:
 305              	.L22:
  33:App/Src/motor_control.c **** 
 306              		.loc 1 33 1 view .LVU82
 307 0044 BDEC028B 		vldm	sp!, {d8}
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 8


 308              	.LCFI2:
 309              		.cfi_remember_state
 310              		.cfi_restore 80
 311              		.cfi_restore 81
 312              		.cfi_def_cfa_offset 8
 313 0048 08BD     		pop	{r3, pc}
 314              	.LVL17:
 315              	.L23:
 316              	.LCFI3:
 317              		.cfi_restore_state
  23:App/Src/motor_control.c **** 
 318              		.loc 1 23 5 is_stmt 1 view .LVU83
  23:App/Src/motor_control.c **** 
 319              		.loc 1 23 8 is_stmt 0 view .LVU84
 320 004a 13F5805F 		cmn	r3, #4096
 321 004e E6DA     		bge	.L24
  23:App/Src/motor_control.c **** 
 322              		.loc 1 23 27 is_stmt 1 discriminator 1 view .LVU85
  23:App/Src/motor_control.c **** 
 323              		.loc 1 23 36 is_stmt 0 discriminator 1 view .LVU86
 324 0050 03F50053 		add	r3, r3, #8192
 325              	.LVL18:
  23:App/Src/motor_control.c **** 
 326              		.loc 1 23 36 discriminator 1 view .LVU87
 327 0054 E3E7     		b	.L24
 328              	.LVL19:
 329              	.L25:
  17:App/Src/motor_control.c ****     }
 330              		.loc 1 17 16 view .LVU88
 331 0056 0020     		movs	r0, #0
 332              	.LVL20:
  17:App/Src/motor_control.c ****     }
 333              		.loc 1 17 16 view .LVU89
 334 0058 F4E7     		b	.L22
 335              	.L28:
 336 005a 00BF     		.align	2
 337              	.L27:
 338 005c DB0F493A 		.word	977866715
 339              		.cfi_endproc
 340              	.LFE134:
 342              		.section	.text.Motor_Clear_Stall,"ax",%progbits
 343              		.align	1
 344              		.global	Motor_Clear_Stall
 345              		.syntax unified
 346              		.thumb
 347              		.thumb_func
 349              	Motor_Clear_Stall:
 350              	.LVL21:
 351              	.LFB138:
  69:App/Src/motor_control.c **** 
  70:App/Src/motor_control.c **** // 清除堵转状态
  71:App/Src/motor_control.c **** void Motor_Clear_Stall(uint8_t id) {
 352              		.loc 1 71 36 is_stmt 1 view -0
 353              		.cfi_startproc
 354              		@ args = 0, pretend = 0, frame = 0
 355              		@ frame_needed = 0, uses_anonymous_args = 0
 356              		@ link register save eliminated.
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 9


  72:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 357              		.loc 1 72 5 view .LVU91
 358              		.loc 1 72 16 is_stmt 0 view .LVU92
 359 0000 431E     		subs	r3, r0, #1
 360 0002 DBB2     		uxtb	r3, r3
 361              		.loc 1 72 8 view .LVU93
 362 0004 032B     		cmp	r3, #3
 363 0006 0FD8     		bhi	.L29
  73:App/Src/motor_control.c ****     gm6020_motors[id-1].is_stalled = 0;
 364              		.loc 1 73 5 is_stmt 1 view .LVU94
 365              		.loc 1 73 21 is_stmt 0 view .LVU95
 366 0008 0138     		subs	r0, r0, #1
 367              	.LVL22:
 368              		.loc 1 73 36 view .LVU96
 369 000a 084A     		ldr	r2, .L31
 370 000c C0EB4013 		rsb	r3, r0, r0, lsl #5
 371 0010 02EBC303 		add	r3, r2, r3, lsl #3
 372 0014 0021     		movs	r1, #0
 373 0016 83F8EC10 		strb	r1, [r3, #236]
  74:App/Src/motor_control.c ****     gm6020_motors[id-1].stall_cnt = 0;
 374              		.loc 1 74 5 is_stmt 1 view .LVU97
 375              		.loc 1 74 35 is_stmt 0 view .LVU98
 376 001a C3F8E810 		str	r1, [r3, #232]
  75:App/Src/motor_control.c ****     gm6020_motors[id-1].mode = MOTOR_MODE_CURRENT_SPEED; // 恢复到默认安全模式
 377              		.loc 1 75 5 is_stmt 1 view .LVU99
 378              		.loc 1 75 30 is_stmt 0 view .LVU100
 379 001e 0121     		movs	r1, #1
 380 0020 5970     		strb	r1, [r3, #1]
  76:App/Src/motor_control.c ****     gm6020_motors[id-1].target_val = 0;
 381              		.loc 1 76 5 is_stmt 1 view .LVU101
 382              		.loc 1 76 36 is_stmt 0 view .LVU102
 383 0022 1A46     		mov	r2, r3
 384 0024 0023     		movs	r3, #0
 385 0026 5361     		str	r3, [r2, #20]	@ float
 386              	.LVL23:
 387              	.L29:
  77:App/Src/motor_control.c **** }
 388              		.loc 1 77 1 view .LVU103
 389 0028 7047     		bx	lr
 390              	.L32:
 391 002a 00BF     		.align	2
 392              	.L31:
 393 002c 00000000 		.word	gm6020_motors
 394              		.cfi_endproc
 395              	.LFE138:
 397              		.section	.text.Motor_Init_All,"ax",%progbits
 398              		.align	1
 399              		.global	Motor_Init_All
 400              		.syntax unified
 401              		.thumb
 402              		.thumb_func
 404              	Motor_Init_All:
 405              	.LFB139:
  78:App/Src/motor_control.c **** 
  79:App/Src/motor_control.c **** void Motor_Init_All(void) {
 406              		.loc 1 79 27 is_stmt 1 view -0
 407              		.cfi_startproc
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 10


 408              		@ args = 0, pretend = 0, frame = 0
 409              		@ frame_needed = 0, uses_anonymous_args = 0
 410 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 411              	.LCFI4:
 412              		.cfi_def_cfa_offset 24
 413              		.cfi_offset 4, -24
 414              		.cfi_offset 5, -20
 415              		.cfi_offset 6, -16
 416              		.cfi_offset 7, -12
 417              		.cfi_offset 8, -8
 418              		.cfi_offset 14, -4
 419 0004 2DED028B 		vpush.64	{d8}
 420              	.LCFI5:
 421              		.cfi_def_cfa_offset 32
 422              		.cfi_offset 80, -32
 423              		.cfi_offset 81, -28
  80:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 424              		.loc 1 80 5 view .LVU105
 425              	.LBB2:
 426              		.loc 1 80 10 view .LVU106
 427              	.LVL24:
 428              		.loc 1 80 14 is_stmt 0 view .LVU107
 429 0008 0024     		movs	r4, #0
 430              		.loc 1 80 5 view .LVU108
 431 000a 1EE0     		b	.L34
 432              	.LVL25:
 433              	.L35:
 434              	.LBB3:
  81:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
  82:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
  83:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
  84:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
  85:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
  86:App/Src/motor_control.c ****         
  87:App/Src/motor_control.c ****         // === 1. 速度环 PID (内环) ===
  88:App/Src/motor_control.c ****         // 输入：RPM 误差
  89:App/Src/motor_control.c ****         // 输出：目标电流值 (-16384 ~ 16384) -> 直接发给电机
  90:App/Src/motor_control.c ****         PID_Init(&gm6020_motors[i].speed_pid, 
  91:App/Src/motor_control.c ****                  60.0f,    // Kp: 建议从 50-100 开始调试
  92:App/Src/motor_control.c ****                  3.3f,      // Ki: 必须有，用于消除静差
  93:App/Src/motor_control.c ****                  0.005f,      // Kd: 速度环通常设为 0，防止噪声放大导致抖动
  94:App/Src/motor_control.c ****                  GM6020_MAX_CURRENT, // MaxOut: 16384
  95:App/Src/motor_control.c ****                  5000.0f,1.0f);           // MaxIOut: 积分限幅不要太大，5000足够
  96:App/Src/motor_control.c ****         
  97:App/Src/motor_control.c ****         // === 2. 位置环 PID (外环) ===
  98:App/Src/motor_control.c ****         // 输入：角度误差
  99:App/Src/motor_control.c ****         // 输出：目标 RPM
 100:App/Src/motor_control.c ****         PID_Init(&gm6020_motors[i].angle_pid, 
 101:App/Src/motor_control.c ****                  5.0f,    // Kp: 1度误差 -> 10 RPM
 102:App/Src/motor_control.c ****                  0.0f,     // Ki: 位置环通常不需要 I
 103:App/Src/motor_control.c ****                  0.0f,     // Kd: 位置环 D 给 0 或极小
 104:App/Src/motor_control.c ****                  GM6020_MAX_SPEED,   // MaxOut: 限制最大转速 320
 105:App/Src/motor_control.c ****                  0.0f,1.0f);    // MaxIOut
 106:App/Src/motor_control.c ****         gm6020_motors[i].horizon_ecd = 4096;    // 默认水平位置
 107:App/Src/motor_control.c ****         gm6020_motors[i].gravity_gain = 0.0f;    // 默认关闭
 108:App/Src/motor_control.c ****         
 109:App/Src/motor_control.c ****         //  上电机特殊处理
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 11


 110:App/Src/motor_control.c ****         if (i == 3) { // ID=4
 111:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f; // 强制禁用
 435              		.loc 1 111 13 is_stmt 1 view .LVU109
 112:App/Src/motor_control.c ****         }
 113:App/Src/motor_control.c ****         
 114:App/Src/motor_control.c ****         float speed_dead_zone = 1.0f;  // 速度环死区：1 RPM
 436              		.loc 1 114 9 view .LVU110
 115:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
 437              		.loc 1 115 9 view .LVU111
 116:App/Src/motor_control.c ****         //  优化PID参数（上电机）
 117:App/Src/motor_control.c ****         if (i == 3) { // ID=4
 438              		.loc 1 117 9 view .LVU112
 118:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 439              		.loc 1 118 13 view .LVU113
 440 000c F7EE002A 		vmov.f32	s5, #1.0e+0
 441 0010 9FED3B2A 		vldr.32	s4, .L40
 442 0014 DFED3B1A 		vldr.32	s3, .L40+4
 443 0018 9FED3B1A 		vldr.32	s2, .L40+8
 444 001c F1EE040A 		vmov.f32	s1, #5.0e+0
 445 0020 9FED3A0A 		vldr.32	s0, .L40+12
 446 0024 3046     		mov	r0, r6
 447 0026 FFF7FEFF 		bl	PID_Init
 448              	.LVL26:
 119:App/Src/motor_control.c ****                      140.0f,   // Kp: 80→50（降低增益）
 120:App/Src/motor_control.c ****                      5.0f,    // Ki: 3.0→2.0（减少积分）
 121:App/Src/motor_control.c ****                      0.1f,   // Kd: 0.2→0.05（避免过大）
 122:App/Src/motor_control.c ****                      GM6020_MAX_CURRENT,
 123:App/Src/motor_control.c ****                      5000.0f, // 积分限幅
 124:App/Src/motor_control.c ****                      speed_dead_zone); // ✅ 设置死区
 125:App/Src/motor_control.c ****             
 126:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].angle_pid, 
 449              		.loc 1 126 13 view .LVU114
 450 002a DFED390A 		vldr.32	s1, .L40+16
 451 002e F6EE002A 		vmov.f32	s5, #5.0e-1
 452 0032 B0EE602A 		vmov.f32	s4, s1
 453 0036 DFED371A 		vldr.32	s3, .L40+20
 454 003a B0EE601A 		vmov.f32	s2, s1
 455 003e B1EE0C0A 		vmov.f32	s0, #7.0e+0
 456 0042 2846     		mov	r0, r5
 457 0044 FFF7FEFF 		bl	PID_Init
 458              	.LVL27:
 459              	.L36:
 460              	.LBE3:
  80:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 461              		.loc 1 80 29 discriminator 2 view .LVU115
 462 0048 0134     		adds	r4, r4, #1
 463              	.LVL28:
 464              	.L34:
  80:App/Src/motor_control.c ****         gm6020_motors[i].id = i + 1;
 465              		.loc 1 80 23 discriminator 1 view .LVU116
 466 004a 032C     		cmp	r4, #3
 467 004c 53DC     		bgt	.L39
 468              	.LBB4:
  81:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 469              		.loc 1 81 9 view .LVU117
  81:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 470              		.loc 1 81 33 is_stmt 0 view .LVU118
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 12


 471 004e 621C     		adds	r2, r4, #1
  81:App/Src/motor_control.c ****         gm6020_motors[i].mode = MOTOR_MODE_CURRENT_SPEED;
 472              		.loc 1 81 29 view .LVU119
 473 0050 DFF8D080 		ldr	r8, .L40+36
 474 0054 6501     		lsls	r5, r4, #5
 475 0056 C4EB4411 		rsb	r1, r4, r4, lsl #5
 476 005a CB00     		lsls	r3, r1, #3
 477 005c 08EB0307 		add	r7, r8, r3
 478 0060 08F80320 		strb	r2, [r8, r3]
  82:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
 479              		.loc 1 82 9 is_stmt 1 view .LVU120
  82:App/Src/motor_control.c ****         gm6020_motors[i].target_val = 0;
 480              		.loc 1 82 31 is_stmt 0 view .LVU121
 481 0064 0123     		movs	r3, #1
 482 0066 7B70     		strb	r3, [r7, #1]
  83:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
 483              		.loc 1 83 9 is_stmt 1 view .LVU122
  83:App/Src/motor_control.c ****         gm6020_motors[i].round_cnt = 0;
 484              		.loc 1 83 37 is_stmt 0 view .LVU123
 485 0068 9FED298A 		vldr.32	s16, .L40+16
 486 006c 87ED058A 		vstr.32	s16, [r7, #20]
  84:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
 487              		.loc 1 84 9 is_stmt 1 view .LVU124
  84:App/Src/motor_control.c ****         gm6020_motors[i].is_stalled = 0;
 488              		.loc 1 84 36 is_stmt 0 view .LVU125
 489 0070 0023     		movs	r3, #0
 490 0072 FB60     		str	r3, [r7, #12]
  85:App/Src/motor_control.c ****         
 491              		.loc 1 85 9 is_stmt 1 view .LVU126
  85:App/Src/motor_control.c ****         
 492              		.loc 1 85 37 is_stmt 0 view .LVU127
 493 0074 87F8EC30 		strb	r3, [r7, #236]
  90:App/Src/motor_control.c ****                  60.0f,    // Kp: 建议从 50-100 开始调试
 494              		.loc 1 90 9 is_stmt 1 view .LVU128
 495 0078 CE00     		lsls	r6, r1, #3
 496 007a 1836     		adds	r6, r6, #24
 497 007c 4644     		add	r6, r6, r8
 498 007e F7EE002A 		vmov.f32	s5, #1.0e+0
 499 0082 9FED1F2A 		vldr.32	s4, .L40
 500 0086 DFED1F1A 		vldr.32	s3, .L40+4
 501 008a 9FED231A 		vldr.32	s2, .L40+24
 502 008e DFED230A 		vldr.32	s1, .L40+28
 503 0092 9FED230A 		vldr.32	s0, .L40+32
 504 0096 3046     		mov	r0, r6
 505 0098 FFF7FEFF 		bl	PID_Init
 506              	.LVL29:
 100:App/Src/motor_control.c ****                  5.0f,    // Kp: 1度误差 -> 10 RPM
 507              		.loc 1 100 9 view .LVU129
 508 009c 2A1B     		subs	r2, r5, r4
 509 009e D300     		lsls	r3, r2, #3
 510 00a0 03F15805 		add	r5, r3, #88
 511 00a4 4544     		add	r5, r5, r8
 512 00a6 0435     		adds	r5, r5, #4
 513 00a8 F7EE002A 		vmov.f32	s5, #1.0e+0
 514 00ac B0EE482A 		vmov.f32	s4, s16
 515 00b0 DFED181A 		vldr.32	s3, .L40+20
 516 00b4 B0EE481A 		vmov.f32	s2, s16
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 13


 517 00b8 F0EE480A 		vmov.f32	s1, s16
 518 00bc B1EE040A 		vmov.f32	s0, #5.0e+0
 519 00c0 2846     		mov	r0, r5
 520 00c2 FFF7FEFF 		bl	PID_Init
 521              	.LVL30:
 106:App/Src/motor_control.c ****         gm6020_motors[i].gravity_gain = 0.0f;    // 默认关闭
 522              		.loc 1 106 9 view .LVU130
 106:App/Src/motor_control.c ****         gm6020_motors[i].gravity_gain = 0.0f;    // 默认关闭
 523              		.loc 1 106 38 is_stmt 0 view .LVU131
 524 00c6 4FF48053 		mov	r3, #4096
 525 00ca A7F8EE30 		strh	r3, [r7, #238]	@ movhi
 107:App/Src/motor_control.c ****         
 526              		.loc 1 107 9 is_stmt 1 view .LVU132
 107:App/Src/motor_control.c ****         
 527              		.loc 1 107 39 is_stmt 0 view .LVU133
 528 00ce 87ED3C8A 		vstr.32	s16, [r7, #240]
 110:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f; // 强制禁用
 529              		.loc 1 110 9 is_stmt 1 view .LVU134
 110:App/Src/motor_control.c ****             gm6020_motors[i].gravity_gain = 0.0f; // 强制禁用
 530              		.loc 1 110 12 is_stmt 0 view .LVU135
 531 00d2 032C     		cmp	r4, #3
 532 00d4 9AD0     		beq	.L35
 114:App/Src/motor_control.c ****         float angle_dead_zone = 0.5f; 
 533              		.loc 1 114 9 is_stmt 1 view .LVU136
 534              	.LVL31:
 115:App/Src/motor_control.c ****         //  优化PID参数（上电机）
 535              		.loc 1 115 9 view .LVU137
 117:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 
 536              		.loc 1 117 9 view .LVU138
 127:App/Src/motor_control.c ****                      7.0f,    // Kp: 5.0→3.0
 128:App/Src/motor_control.c ****                      0.0f,    
 129:App/Src/motor_control.c ****                      0.0f,
 130:App/Src/motor_control.c ****                      320.0f,  // MaxOut: 320→100 RPM（限制最大速度）
 131:App/Src/motor_control.c ****                      0.0f,
 132:App/Src/motor_control.c ****                      angle_dead_zone); // ✅ 设置死区
 133:App/Src/motor_control.c ****         } 
 134:App/Src/motor_control.c ****         // 下电机保持原有参数
 135:App/Src/motor_control.c ****         else {
 136:App/Src/motor_control.c ****             PID_Init(&gm6020_motors[i].speed_pid, 60.0f, 3.3f, 0.005f, GM6020_MAX_CURRENT, 5000.0f,
 537              		.loc 1 136 13 view .LVU139
 538 00d6 F0EE482A 		vmov.f32	s5, s16
 539 00da 9FED092A 		vldr.32	s4, .L40
 540 00de DFED091A 		vldr.32	s3, .L40+4
 541 00e2 9FED0D1A 		vldr.32	s2, .L40+24
 542 00e6 DFED0D0A 		vldr.32	s1, .L40+28
 543 00ea 9FED0D0A 		vldr.32	s0, .L40+32
 544 00ee 3046     		mov	r0, r6
 545 00f0 FFF7FEFF 		bl	PID_Init
 546              	.LVL32:
 547 00f4 A8E7     		b	.L36
 548              	.LVL33:
 549              	.L39:
 550              		.loc 1 136 13 is_stmt 0 view .LVU140
 551              	.LBE4:
 552              	.LBE2:
 137:App/Src/motor_control.c ****         }
 138:App/Src/motor_control.c ****         // [删除] 绝对不要初始化 current_pid
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 14


 139:App/Src/motor_control.c ****     }
 140:App/Src/motor_control.c **** }
 553              		.loc 1 140 1 view .LVU141
 554 00f6 BDEC028B 		vldm	sp!, {d8}
 555              	.LCFI6:
 556              		.cfi_restore 80
 557              		.cfi_restore 81
 558              		.cfi_def_cfa_offset 24
 559 00fa BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 560              	.LVL34:
 561              	.L41:
 562              		.loc 1 140 1 view .LVU142
 563 00fe 00BF     		.align	2
 564              	.L40:
 565 0100 00409C45 		.word	1167867904
 566 0104 00008046 		.word	1182793728
 567 0108 CDCCCC3D 		.word	1036831949
 568 010c 00000C43 		.word	1124859904
 569 0110 00000000 		.word	0
 570 0114 0000A043 		.word	1134559232
 571 0118 0AD7A33B 		.word	1000593162
 572 011c 33335340 		.word	1079194419
 573 0120 00007042 		.word	1114636288
 574 0124 00000000 		.word	gm6020_motors
 575              		.cfi_endproc
 576              	.LFE139:
 578              		.section	.text.Motor_Update_Feedback,"ax",%progbits
 579              		.align	1
 580              		.global	Motor_Update_Feedback
 581              		.syntax unified
 582              		.thumb
 583              		.thumb_func
 585              	Motor_Update_Feedback:
 586              	.LVL35:
 587              	.LFB140:
 141:App/Src/motor_control.c **** 
 142:App/Src/motor_control.c **** void Motor_Update_Feedback(uint8_t id, uint8_t *rx_data) {
 588              		.loc 1 142 58 is_stmt 1 view -0
 589              		.cfi_startproc
 590              		@ args = 0, pretend = 0, frame = 0
 591              		@ frame_needed = 0, uses_anonymous_args = 0
 592              		.loc 1 142 58 is_stmt 0 view .LVU144
 593 0000 08B5     		push	{r3, lr}
 594              	.LCFI7:
 595              		.cfi_def_cfa_offset 8
 596              		.cfi_offset 3, -8
 597              		.cfi_offset 14, -4
 143:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 598              		.loc 1 143 5 is_stmt 1 view .LVU145
 599              		.loc 1 143 16 is_stmt 0 view .LVU146
 600 0002 431E     		subs	r3, r0, #1
 601 0004 DBB2     		uxtb	r3, r3
 602              		.loc 1 143 8 view .LVU147
 603 0006 032B     		cmp	r3, #3
 604 0008 00D9     		bls	.L45
 605              	.LVL36:
 606              	.L42:
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 15


 144:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 145:App/Src/motor_control.c ****     
 146:App/Src/motor_control.c ****     motor->ecd_raw = (rx_data[0] << 8) | rx_data[1];
 147:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 148:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 149:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 150:App/Src/motor_control.c ****     
 151:App/Src/motor_control.c ****     Motor_Process_Angle(motor);
 152:App/Src/motor_control.c **** }
 607              		.loc 1 152 1 view .LVU148
 608 000a 08BD     		pop	{r3, pc}
 609              	.LVL37:
 610              	.L45:
 144:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 611              		.loc 1 144 5 is_stmt 1 view .LVU149
 144:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 612              		.loc 1 144 47 is_stmt 0 view .LVU150
 613 000c 431E     		subs	r3, r0, #1
 144:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 614              		.loc 1 144 21 view .LVU151
 615 000e C3EB4310 		rsb	r0, r3, r3, lsl #5
 616              	.LVL38:
 144:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 617              		.loc 1 144 21 view .LVU152
 618 0012 104A     		ldr	r2, .L46
 619 0014 02EBC000 		add	r0, r2, r0, lsl #3
 620              	.LVL39:
 146:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 621              		.loc 1 146 5 is_stmt 1 view .LVU153
 146:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 622              		.loc 1 146 30 is_stmt 0 view .LVU154
 623 0018 91F800E0 		ldrb	lr, [r1]	@ zero_extendqisi2
 146:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 624              		.loc 1 146 49 view .LVU155
 625 001c 91F801C0 		ldrb	ip, [r1, #1]	@ zero_extendqisi2
 146:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 626              		.loc 1 146 40 view .LVU156
 627 0020 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 146:App/Src/motor_control.c ****     motor->speed_rpm = (int16_t)((rx_data[2] << 8) | rx_data[3]);
 628              		.loc 1 146 20 view .LVU157
 629 0024 A0F802C0 		strh	ip, [r0, #2]	@ movhi
 147:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 630              		.loc 1 147 5 is_stmt 1 view .LVU158
 147:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 631              		.loc 1 147 42 is_stmt 0 view .LVU159
 632 0028 91F802E0 		ldrb	lr, [r1, #2]	@ zero_extendqisi2
 147:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 633              		.loc 1 147 61 view .LVU160
 634 002c 91F803C0 		ldrb	ip, [r1, #3]	@ zero_extendqisi2
 147:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 635              		.loc 1 147 24 view .LVU161
 636 0030 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 147:App/Src/motor_control.c ****     motor->current_raw = (int16_t)((rx_data[4] << 8) | rx_data[5]);
 637              		.loc 1 147 22 view .LVU162
 638 0034 A0F806C0 		strh	ip, [r0, #6]	@ movhi
 148:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 639              		.loc 1 148 5 is_stmt 1 view .LVU163
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 16


 148:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 640              		.loc 1 148 44 is_stmt 0 view .LVU164
 641 0038 91F804E0 		ldrb	lr, [r1, #4]	@ zero_extendqisi2
 148:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 642              		.loc 1 148 63 view .LVU165
 643 003c 91F805C0 		ldrb	ip, [r1, #5]	@ zero_extendqisi2
 148:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 644              		.loc 1 148 26 view .LVU166
 645 0040 4CEA0E2C 		orr	ip, ip, lr, lsl #8
 148:App/Src/motor_control.c ****     motor->temp = rx_data[6];
 646              		.loc 1 148 24 view .LVU167
 647 0044 A0F808C0 		strh	ip, [r0, #8]	@ movhi
 149:App/Src/motor_control.c ****     
 648              		.loc 1 149 5 is_stmt 1 view .LVU168
 149:App/Src/motor_control.c ****     
 649              		.loc 1 149 17 is_stmt 0 view .LVU169
 650 0048 8979     		ldrb	r1, [r1, #6]	@ zero_extendqisi2
 651              	.LVL40:
 149:App/Src/motor_control.c ****     
 652              		.loc 1 149 17 view .LVU170
 653 004a 8172     		strb	r1, [r0, #10]
 151:App/Src/motor_control.c **** }
 654              		.loc 1 151 5 is_stmt 1 view .LVU171
 655 004c FFF7FEFF 		bl	Motor_Process_Angle
 656              	.LVL41:
 151:App/Src/motor_control.c **** }
 657              		.loc 1 151 5 is_stmt 0 view .LVU172
 658 0050 DBE7     		b	.L42
 659              	.L47:
 660 0052 00BF     		.align	2
 661              	.L46:
 662 0054 00000000 		.word	gm6020_motors
 663              		.cfi_endproc
 664              	.LFE140:
 666              		.section	.text.Motor_Set_Target,"ax",%progbits
 667              		.align	1
 668              		.global	Motor_Set_Target
 669              		.syntax unified
 670              		.thumb
 671              		.thumb_func
 673              	Motor_Set_Target:
 674              	.LVL42:
 675              	.LFB141:
 153:App/Src/motor_control.c **** 
 154:App/Src/motor_control.c **** void Motor_Set_Target(uint8_t id, Motor_Mode_e mode, float target) {
 676              		.loc 1 154 68 is_stmt 1 view -0
 677              		.cfi_startproc
 678              		@ args = 0, pretend = 0, frame = 0
 679              		@ frame_needed = 0, uses_anonymous_args = 0
 155:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 680              		.loc 1 155 5 view .LVU174
 681              		.loc 1 155 16 is_stmt 0 view .LVU175
 682 0000 431E     		subs	r3, r0, #1
 683 0002 DBB2     		uxtb	r3, r3
 684              		.loc 1 155 8 view .LVU176
 685 0004 032B     		cmp	r3, #3
 686 0006 1ED8     		bhi	.L51
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 17


 154:App/Src/motor_control.c ****     if (id < 1 || id > 4) return;
 687              		.loc 1 154 68 view .LVU177
 688 0008 70B5     		push	{r4, r5, r6, lr}
 689              	.LCFI8:
 690              		.cfi_def_cfa_offset 16
 691              		.cfi_offset 4, -16
 692              		.cfi_offset 5, -12
 693              		.cfi_offset 6, -8
 694              		.cfi_offset 14, -4
 156:App/Src/motor_control.c ****     GM6020_TypeDef *motor = &gm6020_motors[id - 1];
 695              		.loc 1 156 5 is_stmt 1 view .LVU178
 696              		.loc 1 156 47 is_stmt 0 view .LVU179
 697 000a 441E     		subs	r4, r0, #1
 698              	.LVL43:
 157:App/Src/motor_control.c ****     
 158:App/Src/motor_control.c ****     // 如果处于堵转保护状态，拒绝新的控制指令，除非手动清除
 159:App/Src/motor_control.c ****     //if (motor->is_stalled) return; 
 160:App/Src/motor_control.c ****     Motor_Mode_e old_mode = motor->mode;
 699              		.loc 1 160 5 is_stmt 1 view .LVU180
 700              		.loc 1 160 18 is_stmt 0 view .LVU181
 701 000c C4EB4412 		rsb	r2, r4, r4, lsl #5
 702 0010 0D4B     		ldr	r3, .L55
 703 0012 03EBC203 		add	r3, r3, r2, lsl #3
 704 0016 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 705              	.LVL44:
 161:App/Src/motor_control.c ****     motor->mode = mode;
 706              		.loc 1 161 5 is_stmt 1 view .LVU182
 707              		.loc 1 161 17 is_stmt 0 view .LVU183
 708 0018 5970     		strb	r1, [r3, #1]
 709              	.LVL45:
 162:App/Src/motor_control.c ****     motor->target_val = target;
 710              		.loc 1 162 5 is_stmt 1 view .LVU184
 711              		.loc 1 162 23 is_stmt 0 view .LVU185
 712 001a 83ED050A 		vstr.32	s0, [r3, #20]
 163:App/Src/motor_control.c ****     
 164:App/Src/motor_control.c ****     // 切换模式时清除 PID 积分，防止飞车
 165:App/Src/motor_control.c ****     if (old_mode != mode) {
 713              		.loc 1 165 5 is_stmt 1 view .LVU186
 714              		.loc 1 165 8 is_stmt 0 view .LVU187
 715 001e 8A42     		cmp	r2, r1
 716 0020 00D1     		bne	.L54
 717              	.LVL46:
 718              	.L48:
 166:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 167:App/Src/motor_control.c ****         PID_Clear(&motor->angle_pid);
 168:App/Src/motor_control.c ****     }
 169:App/Src/motor_control.c **** }
 719              		.loc 1 169 1 view .LVU188
 720 0022 70BD     		pop	{r4, r5, r6, pc}
 721              	.LVL47:
 722              	.L54:
 166:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
 723              		.loc 1 166 9 is_stmt 1 view .LVU189
 724 0024 6501     		lsls	r5, r4, #5
 725 0026 C4EB4410 		rsb	r0, r4, r4, lsl #5
 726              	.LVL48:
 166:App/Src/motor_control.c ****         PID_Clear(&motor->speed_pid);
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 18


 727              		.loc 1 166 9 is_stmt 0 view .LVU190
 728 002a C000     		lsls	r0, r0, #3
 729 002c 1830     		adds	r0, r0, #24
 730 002e 064E     		ldr	r6, .L55
 731 0030 3044     		add	r0, r0, r6
 732 0032 FFF7FEFF 		bl	PID_Clear
 733              	.LVL49:
 167:App/Src/motor_control.c ****     }
 734              		.loc 1 167 9 is_stmt 1 view .LVU191
 735 0036 281B     		subs	r0, r5, r4
 736 0038 C000     		lsls	r0, r0, #3
 737 003a 5830     		adds	r0, r0, #88
 738 003c 3044     		add	r0, r0, r6
 739 003e 0430     		adds	r0, r0, #4
 740 0040 FFF7FEFF 		bl	PID_Clear
 741              	.LVL50:
 742 0044 EDE7     		b	.L48
 743              	.LVL51:
 744              	.L51:
 745              	.LCFI9:
 746              		.cfi_def_cfa_offset 0
 747              		.cfi_restore 4
 748              		.cfi_restore 5
 749              		.cfi_restore 6
 750              		.cfi_restore 14
 167:App/Src/motor_control.c ****     }
 751              		.loc 1 167 9 is_stmt 0 view .LVU192
 752 0046 7047     		bx	lr
 753              	.L56:
 754              		.align	2
 755              	.L55:
 756 0048 00000000 		.word	gm6020_motors
 757              		.cfi_endproc
 758              	.LFE141:
 760              		.section	.text.Motor_Control_Loop,"ax",%progbits
 761              		.align	1
 762              		.global	Motor_Control_Loop
 763              		.syntax unified
 764              		.thumb
 765              		.thumb_func
 767              	Motor_Control_Loop:
 768              	.LFB142:
 170:App/Src/motor_control.c **** 
 171:App/Src/motor_control.c **** void Motor_Control_Loop(void) {
 769              		.loc 1 171 31 is_stmt 1 view -0
 770              		.cfi_startproc
 771              		@ args = 0, pretend = 0, frame = 0
 772              		@ frame_needed = 0, uses_anonymous_args = 0
 773 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 774              	.LCFI10:
 775              		.cfi_def_cfa_offset 24
 776              		.cfi_offset 4, -24
 777              		.cfi_offset 5, -20
 778              		.cfi_offset 6, -16
 779              		.cfi_offset 7, -12
 780              		.cfi_offset 8, -8
 781              		.cfi_offset 14, -4
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 19


 782 0004 2DED028B 		vpush.64	{d8}
 783              	.LCFI11:
 784              		.cfi_def_cfa_offset 32
 785              		.cfi_offset 80, -32
 786              		.cfi_offset 81, -28
 172:App/Src/motor_control.c ****     for (int i = 0; i < 4; i++) {
 787              		.loc 1 172 5 view .LVU194
 788              	.LBB5:
 789              		.loc 1 172 10 view .LVU195
 790              	.LVL52:
 791              		.loc 1 172 14 is_stmt 0 view .LVU196
 792 0008 0024     		movs	r4, #0
 793              		.loc 1 172 5 view .LVU197
 794 000a 3FE0     		b	.L58
 795              	.LVL53:
 796              	.L59:
 797              	.LBB6:
 173:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 174:App/Src/motor_control.c ****         float speed_target = 0;
 175:App/Src/motor_control.c ****         float current_target = 0; // 这是最终要发给电机的电流值
 176:App/Src/motor_control.c ****         
 177:App/Src/motor_control.c ****         // 堵转保护
 178:App/Src/motor_control.c ****         if (motor->is_stalled || motor->mode == MOTOR_MODE_STOP) {
 179:App/Src/motor_control.c ****             motor->output_current = 0;
 798              		.loc 1 179 13 is_stmt 1 view .LVU198
 799              		.loc 1 179 35 is_stmt 0 view .LVU199
 800 000c C4EB4412 		rsb	r2, r4, r4, lsl #5
 801 0010 494B     		ldr	r3, .L71
 802 0012 03EBC203 		add	r3, r3, r2, lsl #3
 803 0016 0022     		movs	r2, #0
 804 0018 A3F8E420 		strh	r2, [r3, #228]	@ movhi
 180:App/Src/motor_control.c ****             motor_current_send_buf[i] = 0;
 805              		.loc 1 180 13 is_stmt 1 view .LVU200
 806              		.loc 1 180 39 is_stmt 0 view .LVU201
 807 001c 474B     		ldr	r3, .L71+4
 808 001e 23F81420 		strh	r2, [r3, r4, lsl #1]	@ movhi
 181:App/Src/motor_control.c ****             continue;
 809              		.loc 1 181 13 is_stmt 1 view .LVU202
 810 0022 32E0     		b	.L61
 811              	.L62:
 182:App/Src/motor_control.c ****         }
 183:App/Src/motor_control.c **** 
 184:App/Src/motor_control.c ****         switch (motor->mode) {
 185:App/Src/motor_control.c ****             case MOTOR_MODE_CURRENT_OPEN:
 186:App/Src/motor_control.c ****                 // 模式0：电流开环
 187:App/Src/motor_control.c ****                 current_target = motor->target_val;
 188:App/Src/motor_control.c ****                 break;
 189:App/Src/motor_control.c ****                 
 190:App/Src/motor_control.c ****             case MOTOR_MODE_CURRENT_SPEED:
 191:App/Src/motor_control.c ****                 // 模式1：速度闭环
 192:App/Src/motor_control.c ****                 // 速度环 PID 输出的直接就是目标电流
 193:App/Src/motor_control.c ****                 current_target = PID_Calc(&motor->speed_pid, motor->target_val, motor->speed_rpm);
 812              		.loc 1 193 17 view .LVU203
 813              		.loc 1 193 86 is_stmt 0 view .LVU204
 814 0024 4448     		ldr	r0, .L71
 815 0026 C4EB4412 		rsb	r2, r4, r4, lsl #5
 816 002a 00EBC202 		add	r2, r0, r2, lsl #3
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 20


 817 002e B2F90630 		ldrsh	r3, [r2, #6]
 818 0032 00EE903A 		vmov	s1, r3	@ int
 819              		.loc 1 193 34 view .LVU205
 820 0036 C4EB4413 		rsb	r3, r4, r4, lsl #5
 821 003a DB00     		lsls	r3, r3, #3
 822 003c 1833     		adds	r3, r3, #24
 823 003e F8EEE00A 		vcvt.f32.s32	s1, s1
 824 0042 92ED050A 		vldr.32	s0, [r2, #20]
 825 0046 1844     		add	r0, r0, r3
 826 0048 FFF7FEFF 		bl	PID_Calc
 827              	.LVL54:
 828 004c B0EE408A 		vmov.f32	s16, s0
 829              	.LVL55:
 194:App/Src/motor_control.c ****                 // [删除] 不要再过 current_pid
 195:App/Src/motor_control.c ****                 break;
 830              		.loc 1 195 17 is_stmt 1 view .LVU206
 831              	.L64:
 196:App/Src/motor_control.c ****                 
 197:App/Src/motor_control.c ****             case MOTOR_MODE_CURRENT_POS_CASCADE:
 198:App/Src/motor_control.c ****                 // 模式2：串级闭环
 199:App/Src/motor_control.c ****                 // 外环：位置 -> 速度
 200:App/Src/motor_control.c ****                 speed_target = PID_Calc(&motor->angle_pid, motor->target_val, motor->total_angle);
 201:App/Src/motor_control.c ****                 // 内环：速度 -> 电流
 202:App/Src/motor_control.c ****                 current_target = PID_Calc(&motor->speed_pid, speed_target, motor->speed_rpm);
 203:App/Src/motor_control.c ****                 // [删除] 不要再过 current_pid
 204:App/Src/motor_control.c ****                 break;
 205:App/Src/motor_control.c ****                 
 206:App/Src/motor_control.c ****             default:
 207:App/Src/motor_control.c ****                 current_target = 0;
 208:App/Src/motor_control.c ****                 break;
 209:App/Src/motor_control.c ****         }
 210:App/Src/motor_control.c **** 
 211:App/Src/motor_control.c ****          if (motor->mode == MOTOR_MODE_CURRENT_SPEED || 
 832              		.loc 1 211 10 view .LVU207
 833              		.loc 1 211 19 is_stmt 0 view .LVU208
 834 0050 C4EB4412 		rsb	r2, r4, r4, lsl #5
 835 0054 384B     		ldr	r3, .L71
 836 0056 03EBC203 		add	r3, r3, r2, lsl #3
 837 005a 5B78     		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 838              		.loc 1 211 54 view .LVU209
 839 005c 013B     		subs	r3, r3, #1
 840 005e DBB2     		uxtb	r3, r3
 841              		.loc 1 211 13 view .LVU210
 842 0060 012B     		cmp	r3, #1
 843 0062 52D9     		bls	.L69
 844              	.L65:
 212:App/Src/motor_control.c ****             motor->mode == MOTOR_MODE_CURRENT_POS_CASCADE) {
 213:App/Src/motor_control.c ****             
 214:App/Src/motor_control.c ****             motor->feedforward = Motor_Calc_Gravity_FF(motor);
 215:App/Src/motor_control.c ****             current_target += motor->feedforward;
 216:App/Src/motor_control.c ****         }
 217:App/Src/motor_control.c **** 
 218:App/Src/motor_control.c ****         // 1. 限制电流范围
 219:App/Src/motor_control.c ****         motor->output_current = limit_current(current_target);
 845              		.loc 1 219 9 is_stmt 1 view .LVU211
 846              		.loc 1 219 33 is_stmt 0 view .LVU212
 847 0064 B0EE480A 		vmov.f32	s0, s16
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 21


 848 0068 FFF7FEFF 		bl	limit_current
 849              	.LVL56:
 850              		.loc 1 219 31 discriminator 1 view .LVU213
 851 006c C4EB4413 		rsb	r3, r4, r4, lsl #5
 852 0070 314E     		ldr	r6, .L71
 853 0072 06EBC306 		add	r6, r6, r3, lsl #3
 854 0076 A6F8E400 		strh	r0, [r6, #228]	@ movhi
 220:App/Src/motor_control.c ****         
 221:App/Src/motor_control.c ****         // 2. 执行堵转检测
 222:App/Src/motor_control.c ****         Motor_Check_Stall(motor);
 855              		.loc 1 222 9 is_stmt 1 view .LVU214
 856 007a 2846     		mov	r0, r5
 857 007c FFF7FEFF 		bl	Motor_Check_Stall
 858              	.LVL57:
 223:App/Src/motor_control.c ****         
 224:App/Src/motor_control.c ****         // 3. 填入发送缓冲区
 225:App/Src/motor_control.c ****         motor_current_send_buf[i] = motor->output_current;
 859              		.loc 1 225 9 view .LVU215
 860              		.loc 1 225 42 is_stmt 0 view .LVU216
 861 0080 B6F9E420 		ldrsh	r2, [r6, #228]
 862              		.loc 1 225 35 view .LVU217
 863 0084 2D4B     		ldr	r3, .L71+4
 864 0086 23F81420 		strh	r2, [r3, r4, lsl #1]	@ movhi
 865              	.LVL58:
 866              	.L61:
 867              		.loc 1 225 35 view .LVU218
 868              	.LBE6:
 172:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 869              		.loc 1 172 29 is_stmt 1 discriminator 2 view .LVU219
 870 008a 0134     		adds	r4, r4, #1
 871              	.LVL59:
 872              	.L58:
 172:App/Src/motor_control.c ****         GM6020_TypeDef *motor = &gm6020_motors[i];
 873              		.loc 1 172 23 discriminator 1 view .LVU220
 874 008c 032C     		cmp	r4, #3
 875 008e 4DDC     		bgt	.L70
 876              	.LBB7:
 173:App/Src/motor_control.c ****         float speed_target = 0;
 877              		.loc 1 173 9 view .LVU221
 173:App/Src/motor_control.c ****         float speed_target = 0;
 878              		.loc 1 173 25 is_stmt 0 view .LVU222
 879 0090 C4EB4413 		rsb	r3, r4, r4, lsl #5
 880 0094 284D     		ldr	r5, .L71
 881 0096 05EBC305 		add	r5, r5, r3, lsl #3
 882              	.LVL60:
 174:App/Src/motor_control.c ****         float current_target = 0; // 这是最终要发给电机的电流值
 883              		.loc 1 174 9 is_stmt 1 view .LVU223
 175:App/Src/motor_control.c ****         
 884              		.loc 1 175 9 view .LVU224
 178:App/Src/motor_control.c ****             motor->output_current = 0;
 885              		.loc 1 178 9 view .LVU225
 178:App/Src/motor_control.c ****             motor->output_current = 0;
 886              		.loc 1 178 18 is_stmt 0 view .LVU226
 887 009a 95F8EC30 		ldrb	r3, [r5, #236]	@ zero_extendqisi2
 178:App/Src/motor_control.c ****             motor->output_current = 0;
 888              		.loc 1 178 12 view .LVU227
 889 009e 002B     		cmp	r3, #0
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 22


 890 00a0 B4D1     		bne	.L59
 178:App/Src/motor_control.c ****             motor->output_current = 0;
 891              		.loc 1 178 39 discriminator 2 view .LVU228
 892 00a2 6B78     		ldrb	r3, [r5, #1]	@ zero_extendqisi2
 178:App/Src/motor_control.c ****             motor->output_current = 0;
 893              		.loc 1 178 31 discriminator 2 view .LVU229
 894 00a4 032B     		cmp	r3, #3
 895 00a6 B1D0     		beq	.L59
 184:App/Src/motor_control.c ****             case MOTOR_MODE_CURRENT_OPEN:
 896              		.loc 1 184 9 is_stmt 1 view .LVU230
 897 00a8 012B     		cmp	r3, #1
 898 00aa BBD0     		beq	.L62
 899 00ac 022B     		cmp	r3, #2
 900 00ae 08D0     		beq	.L63
 901 00b0 43BB     		cbnz	r3, .L67
 187:App/Src/motor_control.c ****                 break;
 902              		.loc 1 187 17 view .LVU231
 187:App/Src/motor_control.c ****                 break;
 903              		.loc 1 187 32 is_stmt 0 view .LVU232
 904 00b2 C4EB4412 		rsb	r2, r4, r4, lsl #5
 905 00b6 204B     		ldr	r3, .L71
 906 00b8 03EBC203 		add	r3, r3, r2, lsl #3
 907 00bc 93ED058A 		vldr.32	s16, [r3, #20]
 908              	.LVL61:
 188:App/Src/motor_control.c ****                 
 909              		.loc 1 188 17 is_stmt 1 view .LVU233
 910 00c0 C6E7     		b	.L64
 911              	.LVL62:
 912              	.L63:
 200:App/Src/motor_control.c ****                 // 内环：速度 -> 电流
 913              		.loc 1 200 17 view .LVU234
 200:App/Src/motor_control.c ****                 // 内环：速度 -> 电流
 914              		.loc 1 200 32 is_stmt 0 view .LVU235
 915 00c2 1D4F     		ldr	r7, .L71
 916 00c4 6601     		lsls	r6, r4, #5
 917 00c6 C4EB4418 		rsb	r8, r4, r4, lsl #5
 918 00ca 07EBC808 		add	r8, r7, r8, lsl #3
 919 00ce C4EB4410 		rsb	r0, r4, r4, lsl #5
 920 00d2 C000     		lsls	r0, r0, #3
 921 00d4 5830     		adds	r0, r0, #88
 922 00d6 3844     		add	r0, r0, r7
 923 00d8 D8ED040A 		vldr.32	s1, [r8, #16]
 924 00dc 98ED050A 		vldr.32	s0, [r8, #20]
 925 00e0 0430     		adds	r0, r0, #4
 926 00e2 FFF7FEFF 		bl	PID_Calc
 927              	.LVL63:
 202:App/Src/motor_control.c ****                 // [删除] 不要再过 current_pid
 928              		.loc 1 202 17 is_stmt 1 view .LVU236
 202:App/Src/motor_control.c ****                 // [删除] 不要再过 current_pid
 929              		.loc 1 202 81 is_stmt 0 view .LVU237
 930 00e6 B8F90630 		ldrsh	r3, [r8, #6]
 931 00ea 00EE903A 		vmov	s1, r3	@ int
 202:App/Src/motor_control.c ****                 // [删除] 不要再过 current_pid
 932              		.loc 1 202 34 view .LVU238
 933 00ee 301B     		subs	r0, r6, r4
 934 00f0 C000     		lsls	r0, r0, #3
 935 00f2 1830     		adds	r0, r0, #24
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 23


 936 00f4 F8EEE00A 		vcvt.f32.s32	s1, s1
 937 00f8 3844     		add	r0, r0, r7
 938 00fa FFF7FEFF 		bl	PID_Calc
 939              	.LVL64:
 202:App/Src/motor_control.c ****                 // [删除] 不要再过 current_pid
 940              		.loc 1 202 34 view .LVU239
 941 00fe B0EE408A 		vmov.f32	s16, s0
 942              	.LVL65:
 204:App/Src/motor_control.c ****                 
 943              		.loc 1 204 17 is_stmt 1 view .LVU240
 944 0102 A5E7     		b	.L64
 945              	.LVL66:
 946              	.L67:
 184:App/Src/motor_control.c ****             case MOTOR_MODE_CURRENT_OPEN:
 947              		.loc 1 184 9 is_stmt 0 view .LVU241
 948 0104 9FED0E8A 		vldr.32	s16, .L71+8
 949 0108 A2E7     		b	.L64
 950              	.LVL67:
 951              	.L69:
 214:App/Src/motor_control.c ****             current_target += motor->feedforward;
 952              		.loc 1 214 13 is_stmt 1 view .LVU242
 214:App/Src/motor_control.c ****             current_target += motor->feedforward;
 953              		.loc 1 214 34 is_stmt 0 view .LVU243
 954 010a 2846     		mov	r0, r5
 955 010c FFF7FEFF 		bl	Motor_Calc_Gravity_FF
 956              	.LVL68:
 214:App/Src/motor_control.c ****             current_target += motor->feedforward;
 957              		.loc 1 214 32 discriminator 1 view .LVU244
 958 0110 C4EB4412 		rsb	r2, r4, r4, lsl #5
 959 0114 084B     		ldr	r3, .L71
 960 0116 03EBC203 		add	r3, r3, r2, lsl #3
 961 011a A3F8F400 		strh	r0, [r3, #244]	@ movhi
 215:App/Src/motor_control.c ****         }
 962              		.loc 1 215 13 is_stmt 1 view .LVU245
 215:App/Src/motor_control.c ****         }
 963              		.loc 1 215 28 is_stmt 0 view .LVU246
 964 011e 07EE900A 		vmov	s15, r0	@ int
 965 0122 F8EEE77A 		vcvt.f32.s32	s15, s15
 966 0126 38EE278A 		vadd.f32	s16, s16, s15
 967              	.LVL69:
 215:App/Src/motor_control.c ****         }
 968              		.loc 1 215 28 view .LVU247
 969 012a 9BE7     		b	.L65
 970              	.LVL70:
 971              	.L70:
 215:App/Src/motor_control.c ****         }
 972              		.loc 1 215 28 view .LVU248
 973              	.LBE7:
 974              	.LBE5:
 226:App/Src/motor_control.c ****     }
 227:App/Src/motor_control.c ****     
 228:App/Src/motor_control.c ****     // 发送 ID 0x1FE
 229:App/Src/motor_control.c ****     BSP_CAN_Send_Current_Cmd();
 975              		.loc 1 229 5 is_stmt 1 view .LVU249
 976 012c FFF7FEFF 		bl	BSP_CAN_Send_Current_Cmd
 977              	.LVL71:
 230:App/Src/motor_control.c **** }
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 24


 978              		.loc 1 230 1 is_stmt 0 view .LVU250
 979 0130 BDEC028B 		vldm	sp!, {d8}
 980              	.LCFI12:
 981              		.cfi_restore 80
 982              		.cfi_restore 81
 983              		.cfi_def_cfa_offset 24
 984 0134 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 985              	.LVL72:
 986              	.L72:
 987              		.loc 1 230 1 view .LVU251
 988              		.align	2
 989              	.L71:
 990 0138 00000000 		.word	gm6020_motors
 991 013c 00000000 		.word	motor_current_send_buf
 992 0140 00000000 		.word	0
 993              		.cfi_endproc
 994              	.LFE142:
 996              		.section	.text.Motor_Set_Dual_Target,"ax",%progbits
 997              		.align	1
 998              		.global	Motor_Set_Dual_Target
 999              		.syntax unified
 1000              		.thumb
 1001              		.thumb_func
 1003              	Motor_Set_Dual_Target:
 1004              	.LVL73:
 1005              	.LFB143:
 231:App/Src/motor_control.c **** 
 232:App/Src/motor_control.c **** void Motor_Set_Dual_Target(uint8_t id1, Motor_Mode_e mode1, float target1,
 233:App/Src/motor_control.c ****                            uint8_t id2, Motor_Mode_e mode2, float target2) {
 1006              		.loc 1 233 76 is_stmt 1 view -0
 1007              		.cfi_startproc
 1008              		@ args = 0, pretend = 0, frame = 0
 1009              		@ frame_needed = 0, uses_anonymous_args = 0
 1010              		.loc 1 233 76 is_stmt 0 view .LVU253
 1011 0000 38B5     		push	{r3, r4, r5, lr}
 1012              	.LCFI13:
 1013              		.cfi_def_cfa_offset 16
 1014              		.cfi_offset 3, -16
 1015              		.cfi_offset 4, -12
 1016              		.cfi_offset 5, -8
 1017              		.cfi_offset 14, -4
 1018 0002 2DED028B 		vpush.64	{d8}
 1019              	.LCFI14:
 1020              		.cfi_def_cfa_offset 24
 1021              		.cfi_offset 80, -24
 1022              		.cfi_offset 81, -20
 1023 0006 1446     		mov	r4, r2
 1024 0008 1D46     		mov	r5, r3
 1025 000a B0EE608A 		vmov.f32	s16, s1
 234:App/Src/motor_control.c ****     Motor_Set_Target(id1, mode1, target1);
 1026              		.loc 1 234 5 is_stmt 1 view .LVU254
 1027 000e FFF7FEFF 		bl	Motor_Set_Target
 1028              	.LVL74:
 235:App/Src/motor_control.c ****     Motor_Set_Target(id2, mode2, target2);
 1029              		.loc 1 235 5 view .LVU255
 1030 0012 B0EE480A 		vmov.f32	s0, s16
 1031 0016 2946     		mov	r1, r5
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 25


 1032 0018 2046     		mov	r0, r4
 1033 001a FFF7FEFF 		bl	Motor_Set_Target
 1034              	.LVL75:
 236:App/Src/motor_control.c **** }...
 1035              		.loc 1 236 1 is_stmt 0 view .LVU256
 1036 001e BDEC028B 		vldm	sp!, {d8}
 1037              	.LCFI15:
 1038              		.cfi_restore 80
 1039              		.cfi_restore 81
 1040              		.cfi_def_cfa_offset 16
 1041              	.LVL76:
 1042              		.loc 1 236 1 view .LVU257
 1043 0022 38BD     		pop	{r3, r4, r5, pc}
 1044              		.loc 1 236 1 view .LVU258
 1045              		.cfi_endproc
 1046              	.LFE143:
 1048              		.global	gm6020_motors
 1049              		.section	.bss.gm6020_motors,"aw",%nobits
 1050              		.align	2
 1053              	gm6020_motors:
 1054 0000 00000000 		.space	992
 1054      00000000 
 1054      00000000 
 1054      00000000 
 1054      00000000 
 1055              		.text
 1056              	.Letext0:
 1057              		.file 2 "C:/msys64/mingw64/arm-none-eabi/include/machine/_default_types.h"
 1058              		.file 3 "C:/msys64/mingw64/arm-none-eabi/include/sys/_stdint.h"
 1059              		.file 4 "App/Inc/pid.h"
 1060              		.file 5 "App/Inc/motor_control.h"
 1061              		.file 6 "C:/msys64/mingw64/arm-none-eabi/include/math.h"
ARM GAS  C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s 			page 26


DEFINED SYMBOLS
                            *ABS*:00000000 motor_control.c
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:21     .text.limit_current:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:26     .text.limit_current:00000000 limit_current
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:67     .text.limit_current:00000034 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:74     .text.Motor_Process_Angle:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:79     .text.Motor_Process_Angle:00000000 Motor_Process_Angle
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:147    .text.Motor_Process_Angle:00000050 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:153    .text.Motor_Check_Stall:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:158    .text.Motor_Check_Stall:00000000 Motor_Check_Stall
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:230    .text.Motor_Check_Stall:00000070 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:236    .text.Motor_Calc_Gravity_FF:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:241    .text.Motor_Calc_Gravity_FF:00000000 Motor_Calc_Gravity_FF
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:338    .text.Motor_Calc_Gravity_FF:0000005c $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:343    .text.Motor_Clear_Stall:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:349    .text.Motor_Clear_Stall:00000000 Motor_Clear_Stall
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:393    .text.Motor_Clear_Stall:0000002c $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:1053   .bss.gm6020_motors:00000000 gm6020_motors
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:398    .text.Motor_Init_All:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:404    .text.Motor_Init_All:00000000 Motor_Init_All
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:565    .text.Motor_Init_All:00000100 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:579    .text.Motor_Update_Feedback:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:585    .text.Motor_Update_Feedback:00000000 Motor_Update_Feedback
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:662    .text.Motor_Update_Feedback:00000054 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:667    .text.Motor_Set_Target:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:673    .text.Motor_Set_Target:00000000 Motor_Set_Target
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:756    .text.Motor_Set_Target:00000048 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:761    .text.Motor_Control_Loop:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:767    .text.Motor_Control_Loop:00000000 Motor_Control_Loop
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:990    .text.Motor_Control_Loop:00000138 $d
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:997    .text.Motor_Set_Dual_Target:00000000 $t
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:1003   .text.Motor_Set_Dual_Target:00000000 Motor_Set_Dual_Target
C:\Users\wxwsyzh\AppData\Local\Temp\ccUX61DO.s:1050   .bss.gm6020_motors:00000000 $d

UNDEFINED SYMBOLS
cosf
PID_Init
PID_Clear
PID_Calc
BSP_CAN_Send_Current_Cmd
motor_current_send_buf
